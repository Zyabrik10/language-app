let e,t,n,r,i,s;var a,o,l,u,h,c,d,f,p,g,m,y,v,w,b,E,T,_,I,S=globalThis;class C{constructor(e){this.storageName=e}getItem(e){let t=localStorage.getItem(this.storageName);return!t&&e&&this.setItem(e),null===t?null:JSON.parse(t)}setItem(e){localStorage.setItem(this.storageName,JSON.stringify(e))}}class A{constructor(e,t="favorite"){this.types=["favorite"],this.types_expression=[t],this.d=e.map(e=>(this.hasType(e.type)||(this.types.push(e.type),this.types_expression.push(e.type_expression)),e.favorite)?e:{...e,favorite:!1})}setFavoriteById(e,t){let n=this.getById(e);n&&(n.favorite=t)}setFavorites(e,...t){t.forEach(t=>{this.setFavoriteById(t,e)})}getFavorites(e=this.d,t=!0){return e.filter(({favorite:e})=>t===e)}getById(e,t=this.d){return t.find(({id:t})=>t===e)}hasType(e){return!!this.types.find(t=>t===e)}getWordsByType(e,t=this.d){return this.hasType(e)?t.filter(({type:t})=>t===e):[]}getWordsByTypes(e=this.d,...t){let n=[];return t.forEach(t=>{let r=this.getWordsByType(t,e);0!==r.length&&n.push(...r)}),n}getWordsByPart(e,t=this.d){if(!e)return[...t];let n=[];return t.forEach(t=>{t.expression.toLowerCase().includes(e.toLowerCase())&&n.push(t)}),n}getSorted(e=this.d.map(e=>e),t=!0){return e.sort((e,n)=>t?e.expression.localeCompare(n.expression):n.expression.localeCompare(e.expression)),e}add({word:e,translate:t,type:n,description:r}){return this.hasType(n)||this.types.push(n),this.d.push({id:String(this.d.length),word:e,translate:t,type:n,description:r}),this}removeById(e){return this.d=this.d.filter(({id:t})=>e!==t),this}}class x{constructor(e,t){if(this.mw=document.querySelector(e),!this.mw)throw Error(`No ${e} element was found`);if(this.closeModalWindowButton=this.mw.querySelector(t),!this.closeModalWindowButton)throw Error(`No ${t} element was found`);if(this.closeModalWindowButton.addEventListener("click",this.hideModalWindow.bind(this,()=>{})),!this.mw.querySelector(".content"))throw Error("No .content inside modal was found");this.mw.addEventListener("mousedown",({target:e,currentTarget:t})=>{e===t&&this.hideModalWindow()}),this.hideModalWindowOnEscapeEnv=this.hideModalWindowOnEscape.bind(this)}hideModalWindow(e){this.mw.classList.remove("active"),window.removeEventListener("keydown",this.hideModalWindowOnEscapeEnv),document.documentElement.style.overflow="auto",e?.()}hideModalWindowOnEscape({key:e}){"Escape"===e&&this.hideModalWindow()}showModalWindow(e=()=>{}){this.mw.classList.add("active"),window.addEventListener("keydown",this.hideModalWindowOnEscapeEnv),document.documentElement.style.overflow="hidden",e?.()}}const D={},k={},N=()=>void 0,L=function(e){let t=[],n=0;for(let r=0;r<e.length;r++){let i=e.charCodeAt(r);i<128?t[n++]=i:(i<2048?t[n++]=i>>6|192:((64512&i)==55296&&r+1<e.length&&(64512&e.charCodeAt(r+1))==56320?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++r)),t[n++]=i>>18|240,t[n++]=i>>12&63|128):t[n++]=i>>12|224,t[n++]=i>>6&63|128),t[n++]=63&i|128)}return t},R=function(e){let t=[],n=0,r=0;for(;n<e.length;){let i=e[n++];if(i<128)t[r++]=String.fromCharCode(i);else if(i>191&&i<224){let s=e[n++];t[r++]=String.fromCharCode((31&i)<<6|63&s)}else if(i>239&&i<365){let s=e[n++],a=((7&i)<<18|(63&s)<<12|(63&e[n++])<<6|63&e[n++])-65536;t[r++]=String.fromCharCode(55296+(a>>10)),t[r++]=String.fromCharCode(56320+(1023&a))}else{let s=e[n++],a=e[n++];t[r++]=String.fromCharCode((15&i)<<12|(63&s)<<6|63&a)}}return t.join("")},O={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();let n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let t=0;t<e.length;t+=3){let i=e[t],s=t+1<e.length,a=s?e[t+1]:0,o=t+2<e.length,l=o?e[t+2]:0,u=i>>2,h=(3&i)<<4|a>>4,c=(15&a)<<2|l>>6,d=63&l;!o&&(d=64,s||(c=64)),r.push(n[u],n[h],n[c],n[d])}return r.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(L(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):R(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();let n=t?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let t=0;t<e.length;){let i=n[e.charAt(t++)],s=t<e.length?n[e.charAt(t)]:0,a=++t<e.length?n[e.charAt(t)]:64,o=++t<e.length?n[e.charAt(t)]:64;if(++t,null==i||null==s||null==a||null==o)throw new M;let l=i<<2|s>>4;if(r.push(l),64!==a){let e=s<<4&240|a>>2;if(r.push(e),64!==o){let e=a<<6&192|o;r.push(e)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class M extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const P=function(e){let t=L(e);return O.encodeByteArray(t,!0)},F=function(e){return P(e).replace(/\./g,"")},V=function(e){try{return O.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null},B=()=>(function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==S)return S;throw Error("Unable to locate global object.")})().__FIREBASE_DEFAULTS__,U=()=>{},j=()=>{let e;if("undefined"==typeof document)return;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(e){return}let t=e&&V(e[1]);return t&&JSON.parse(t)},$=()=>{try{return N()||B()||U()||j()}catch(e){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`);return}},q=e=>{var t,n;return null==(n=null==(t=$())?void 0:t.emulatorHosts)?void 0:n[e]},z=e=>{let t=q(e);if(!t)return;let n=t.lastIndexOf(":");if(n<=0||n+1===t.length)throw Error(`Invalid host ${t} with no separate hostname and port!`);let r=parseInt(t.substring(n+1),10);return"["===t[0]?[t.substring(1,n-1),r]:[t.substring(0,n),r]},W=()=>{var e;return null==(e=$())?void 0:e.config};class H{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),"function"==typeof e&&(this.promise.catch(()=>{}),1===e.length?e(t):e(t,n))}}}function G(e){try{return(e.startsWith("http://")||e.startsWith("https://")?new URL(e).hostname:e).endsWith(".cloudworkstations.dev")}catch(e){return!1}}async function K(e){return(await fetch(e,{credentials:"include"})).ok}const Q={};let X=!1;class Y extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,Y.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,J.prototype.create)}}class J{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){var n,r;let i=t[0]||{},s=`${this.service}/${e}`,a=this.errors[e],o=a?(n=a,r=i,n.replace(Z,(e,t)=>{let n=r[t];return null!=n?String(n):`<${t}?>`})):"Error",l=`${this.serviceName}: ${o} (${s}).`;return new Y(s,l,i)}}const Z=/\{\$([^}]+)}/g;function ee(e,t){if(e===t)return!0;let n=Object.keys(e),r=Object.keys(t);for(let i of n){if(!r.includes(i))return!1;let n=e[i],s=t[i];if(et(n)&&et(s)){if(!ee(n,s))return!1}else if(n!==s)return!1}for(let e of r)if(!n.includes(e))return!1;return!0}function et(e){return null!==e&&"object"==typeof e}function en(e){return e&&e._delegate?e._delegate:e}class er{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const ei="[DEFAULT]";class es{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){let t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){let e=new H;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{let n=this.getOrInitializeService({instanceIdentifier:t});n&&e.resolve(n)}catch(e){}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;let n=this.normalizeInstanceIdentifier(null==e?void 0:e.identifier),r=null!=(t=null==e?void 0:e.optional)&&t;if(this.isInitialized(n)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:n})}catch(e){if(r)return null;throw e}if(r)return null;throw Error(`Service ${this.name} is not available`)}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if("EAGER"===e.instantiationMode)try{this.getOrInitializeService({instanceIdentifier:ei})}catch(e){}for(let[e,t]of this.instancesDeferred.entries()){let n=this.normalizeInstanceIdentifier(e);try{let e=this.getOrInitializeService({instanceIdentifier:n});t.resolve(e)}catch(e){}}}}clearInstance(e=ei){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){let e=Array.from(this.instances.values());await Promise.all([...e.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...e.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return null!=this.component}isInitialized(e=ei){return this.instances.has(e)}getOptions(e=ei){return this.instancesOptions.get(e)||{}}initialize(e={}){let{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);let r=this.getOrInitializeService({instanceIdentifier:n,options:t});for(let[e,t]of this.instancesDeferred.entries())n===this.normalizeInstanceIdentifier(e)&&t.resolve(r);return r}onInit(e,t){var n;let r=this.normalizeInstanceIdentifier(t),i=null!=(n=this.onInitCallbacks.get(r))?n:new Set;i.add(e),this.onInitCallbacks.set(r,i);let s=this.instances.get(r);return s&&e(s,r),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){let n=this.onInitCallbacks.get(t);if(n)for(let r of n)try{r(e,t)}catch(e){}}getOrInitializeService({instanceIdentifier:e,options:t={}}){var n;let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:(n=e)===ei?void 0:n,options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch(e){}return r||null}normalizeInstanceIdentifier(e=ei){return this.component?this.component.multipleInstances?e:ei:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class ea{constructor(e){this.name=e,this.providers=new Map}addComponent(e){let t=this.getProvider(e.name);if(t.isComponentSet())throw Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);let t=new es(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}const eo=[];(a=o||(o={}))[a.DEBUG=0]="DEBUG",a[a.VERBOSE=1]="VERBOSE",a[a.INFO=2]="INFO",a[a.WARN=3]="WARN",a[a.ERROR=4]="ERROR",a[a.SILENT=5]="SILENT";const el={debug:o.DEBUG,verbose:o.VERBOSE,info:o.INFO,warn:o.WARN,error:o.ERROR,silent:o.SILENT},eu=o.INFO,eh={[o.DEBUG]:"log",[o.VERBOSE]:"log",[o.INFO]:"info",[o.WARN]:"warn",[o.ERROR]:"error"},ec=(e,t,...n)=>{if(t<e.logLevel)return;let r=new Date().toISOString(),i=eh[t];if(i)console[i](`[${r}]  ${e.name}:`,...n);else throw Error(`Attempted to log a message with an invalid logType (value: ${t})`)};class ed{constructor(e){this.name=e,this._logLevel=eu,this._logHandler=ec,this._userLogHandler=null,eo.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in o))throw TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?el[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,o.DEBUG,...e),this._logHandler(this,o.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,o.VERBOSE,...e),this._logHandler(this,o.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,o.INFO,...e),this._logHandler(this,o.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,o.WARN,...e),this._logHandler(this,o.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,o.ERROR,...e),this._logHandler(this,o.ERROR,...e)}}const ef=(e,t)=>t.some(t=>e instanceof t),ep=new WeakMap,eg=new WeakMap,em=new WeakMap,ey=new WeakMap,ev=new WeakMap;let ew={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return eg.get(e);if("objectStoreNames"===t)return e.objectStoreNames||em.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return eb(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function eb(n){if(n instanceof IDBRequest){let e=new Promise((e,t)=>{let r=()=>{n.removeEventListener("success",i),n.removeEventListener("error",s)},i=()=>{e(eb(n.result)),r()},s=()=>{t(n.error),r()};n.addEventListener("success",i),n.addEventListener("error",s)});return e.then(e=>{e instanceof IDBCursor&&ep.set(e,n)}).catch(()=>{}),ev.set(e,n),e}if(ey.has(n))return ey.get(n);let r=function(n){if("function"==typeof n)return n!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(t||(t=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(n)?function(...e){return n.apply(eE(this),e),eb(ep.get(this))}:function(...e){return eb(n.apply(eE(this),e))}:function(e,...t){let r=n.call(eE(this),e,...t);return em.set(r,e.sort?e.sort():[e]),eb(r)};return(n instanceof IDBTransaction&&function(e){if(eg.has(e))return;let t=new Promise((t,n)=>{let r=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",s),e.removeEventListener("abort",s)},i=()=>{t(),r()},s=()=>{n(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",i),e.addEventListener("error",s),e.addEventListener("abort",s)});eg.set(e,t)}(n),ef(n,e||(e=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])))?new Proxy(n,ew):n}(n);return r!==n&&(ey.set(n,r),ev.set(r,n)),r}const eE=e=>ev.get(e),eT=["get","getKey","getAll","getAllKeys","count"],e_=["put","add","delete","clear"],eI=new Map;function eS(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&"string"==typeof t))return;if(eI.get(t))return eI.get(t);let n=t.replace(/FromIndex$/,""),r=t!==n,i=e_.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(i||eT.includes(n)))return;let s=async function(e,...t){let s=this.transaction(e,i?"readwrite":"readonly"),a=s.store;return r&&(a=a.index(t.shift())),(await Promise.all([a[n](...t),i&&s.done]))[0]};return eI.set(t,s),s}ew={...s=ew,get:(e,t,n)=>eS(e,t)||s.get(e,t,n),has:(e,t)=>!!eS(e,t)||s.has(e,t)};class eC{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(e=>{if(!function(e){let t=e.getComponent();return(null==t?void 0:t.type)==="VERSION"}(e))return null;{let t=e.getImmediate();return`${t.library}/${t.version}`}}).filter(e=>e).join(" ")}}const eA="@firebase/app",ex="0.13.2",eD=new ed("@firebase/app"),ek="[DEFAULT]",eN={[eA]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/data-connect":"fire-data-connect","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","@firebase/ai":"fire-vertex","fire-js":"fire-js",firebase:"fire-js-all"},eL=new Map,eR=new Map,eO=new Map;function eM(e,t){try{e.container.addComponent(t)}catch(n){eD.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,n)}}function eP(e){let t=e.name;if(eO.has(t))return eD.debug(`There were multiple attempts to register component ${t}.`),!1;for(let n of(eO.set(t,e),eL.values()))eM(n,e);for(let t of eR.values())eM(t,e);return!0}const eF=new J("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});class eV{constructor(e,t,n){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new er("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw eF.create("app-deleted",{appName:this._name})}}function eB(e,t={}){let n=e;"object"!=typeof t&&(t={name:t});let r=Object.assign({name:ek,automaticDataCollectionEnabled:!0},t),i=r.name;if("string"!=typeof i||!i)throw eF.create("bad-app-name",{appName:String(i)});if(n||(n=W()),!n)throw eF.create("no-options");let s=eL.get(i);if(s)if(ee(n,s.options)&&ee(r,s.config))return s;else throw eF.create("duplicate-app",{appName:i});let a=new ea(i);for(let e of eO.values())a.addComponent(e);let o=new eV(n,r,a);return eL.set(i,o),o}function eU(e,t,n){var r;let i=null!=(r=eN[e])?r:e;n&&(i+=`-${n}`);let s=i.match(/\s|\//),a=t.match(/\s|\//);if(s||a){let e=[`Unable to register library "${i}" with version "${t}":`];s&&e.push(`library name "${i}" contains illegal characters (whitespace or "/")`),s&&a&&e.push("and"),a&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),eD.warn(e.join(" "));return}eP(new er(`${i}-version`,()=>({library:i,version:t}),"VERSION"))}const ej="firebase-heartbeat-store";let e$=null;function eq(){return e$||(e$=(function(e,t,{blocked:n,upgrade:r,blocking:i,terminated:s}={}){let a=indexedDB.open(e,1),o=eb(a);return r&&a.addEventListener("upgradeneeded",e=>{r(eb(a.result),e.oldVersion,e.newVersion,eb(a.transaction),e)}),n&&a.addEventListener("blocked",e=>n(e.oldVersion,e.newVersion,e)),o.then(e=>{s&&e.addEventListener("close",()=>s()),i&&e.addEventListener("versionchange",e=>i(e.oldVersion,e.newVersion,e))}).catch(()=>{}),o})("firebase-heartbeat-database",0,{upgrade:(e,t)=>{if(0===t)try{e.createObjectStore(ej)}catch(e){console.warn(e)}}}).catch(e=>{throw eF.create("idb-open",{originalErrorMessage:e.message})})),e$}async function ez(e){try{let t=(await eq()).transaction(ej),n=await t.objectStore(ej).get(eH(e));return await t.done,n}catch(e){if(e instanceof Y)eD.warn(e.message);else{let t=eF.create("idb-get",{originalErrorMessage:null==e?void 0:e.message});eD.warn(t.message)}}}async function eW(e,t){try{let n=(await eq()).transaction(ej,"readwrite"),r=n.objectStore(ej);await r.put(t,eH(e)),await n.done}catch(e){if(e instanceof Y)eD.warn(e.message);else{let t=eF.create("idb-set",{originalErrorMessage:null==e?void 0:e.message});eD.warn(t.message)}}}function eH(e){return`${e.name}!${e.options.appId}`}class eG{constructor(e){this.container=e,this._heartbeatsCache=null;let t=this.container.getProvider("app").getImmediate();this._storage=new eQ(t),this._heartbeatsCachePromise=this._storage.read().then(e=>(this._heartbeatsCache=e,e))}async triggerHeartbeat(){var e,t;try{let n=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=eK();if((null==(e=this._heartbeatsCache)?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,(null==(t=this._heartbeatsCache)?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some(e=>e.date===r))return;if(this._heartbeatsCache.heartbeats.push({date:r,agent:n}),this._heartbeatsCache.heartbeats.length>30){let e=function(e){if(0===e.length)return -1;let t=0,n=e[0].date;for(let r=1;r<e.length;r++)e[r].date<n&&(n=e[r].date,t=r);return t}(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(e,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){eD.warn(e)}}async getHeartbeatsHeader(){var e;try{if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,(null==(e=this._heartbeatsCache)?void 0:e.heartbeats)==null||0===this._heartbeatsCache.heartbeats.length)return"";let t=eK(),{heartbeatsToSend:n,unsentEntries:r}=function(e,t=1024){let n=[],r=e.slice();for(let i of e){let e=n.find(e=>e.agent===i.agent);if(e){if(e.dates.push(i.date),eX(n)>t){e.dates.pop();break}}else if(n.push({agent:i.agent,dates:[i.date]}),eX(n)>t){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}(this._heartbeatsCache.heartbeats),i=F(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=t,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(e){return eD.warn(e),""}}}function eK(){return new Date().toISOString().substring(0,10)}class eQ{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!function(){try{return"object"==typeof indexedDB}catch(e){return!1}}()&&new Promise((e,t)=>{try{let n=!0,r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),n||self.indexedDB.deleteDatabase(r),e(!0)},i.onupgradeneeded=()=>{n=!1},i.onerror=()=>{var e;t((null==(e=i.error)?void 0:e.message)||"")}}catch(e){t(e)}}).then(()=>!0).catch(()=>!1)}async read(){if(!await this._canUseIndexedDBPromise)return{heartbeats:[]};{let e=await ez(this.app);return(null==e?void 0:e.heartbeats)?e:{heartbeats:[]}}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){let n=await this.read();return eW(this.app,{lastSentHeartbeatDate:null!=(t=e.lastSentHeartbeatDate)?t:n.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){var t;if(await this._canUseIndexedDBPromise){let n=await this.read();return eW(this.app,{lastSentHeartbeatDate:null!=(t=e.lastSentHeartbeatDate)?t:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...e.heartbeats]})}}}function eX(e){return F(JSON.stringify({version:2,heartbeats:e})).length}eP(new er("platform-logger",e=>new eC(e),"PRIVATE")),eP(new er("heartbeat",e=>new eG(e),"PRIVATE")),eU(eA,ex,""),eU(eA,ex,"esm2017"),eU("fire-js",""),eU("firebase","11.10.0","app");var eY="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==S?S:"undefined"!=typeof self?self:{},eJ={};(function(){function e(){this.blockSize=-1,this.blockSize=64,this.g=[,,,,],this.B=Array(this.blockSize),this.o=this.h=0,this.s()}var t=function(){this.blockSize=-1};function n(){}function r(e,t,n){n||(n=0);var r=Array(16);if("string"==typeof t)for(var i=0;16>i;++i)r[i]=t.charCodeAt(n++)|t.charCodeAt(n++)<<8|t.charCodeAt(n++)<<16|t.charCodeAt(n++)<<24;else for(i=0;16>i;++i)r[i]=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24;t=e.g[0],n=e.g[1],i=e.g[2];var s=e.g[3],a=t+(s^n&(i^s))+r[0]+0xd76aa478|0;a=s+(i^(t=n+(a<<7|a>>>25))&(n^i))+r[1]+0xe8c7b756|0,a=i+(n^(s=t+(a<<12|a>>>20))&(t^n))+r[2]+0x242070db|0,a=n+(t^(i=s+(a<<17|a>>>15))&(s^t))+r[3]+0xc1bdceee|0,a=t+(s^(n=i+(a<<22|a>>>10))&(i^s))+r[4]+0xf57c0faf|0,a=s+(i^(t=n+(a<<7|a>>>25))&(n^i))+r[5]+0x4787c62a|0,a=i+(n^(s=t+(a<<12|a>>>20))&(t^n))+r[6]+0xa8304613|0,a=n+(t^(i=s+(a<<17|a>>>15))&(s^t))+r[7]+0xfd469501|0,a=t+(s^(n=i+(a<<22|a>>>10))&(i^s))+r[8]+0x698098d8|0,a=s+(i^(t=n+(a<<7|a>>>25))&(n^i))+r[9]+0x8b44f7af|0,a=i+(n^(s=t+(a<<12|a>>>20))&(t^n))+r[10]+0xffff5bb1|0,a=n+(t^(i=s+(a<<17|a>>>15))&(s^t))+r[11]+0x895cd7be|0,a=t+(s^(n=i+(a<<22|a>>>10))&(i^s))+r[12]+0x6b901122|0,a=s+(i^(t=n+(a<<7|a>>>25))&(n^i))+r[13]+0xfd987193|0,a=i+(n^(s=t+(a<<12|a>>>20))&(t^n))+r[14]+0xa679438e|0,a=n+(t^(i=s+(a<<17|a>>>15))&(s^t))+r[15]+0x49b40821|0,n=i+(a<<22|a>>>10),a=t+(i^s&(n^i))+r[1]+0xf61e2562|0,t=n+(a<<5|a>>>27),a=s+(n^i&(t^n))+r[6]+0xc040b340|0,s=t+(a<<9|a>>>23),a=i+(t^n&(s^t))+r[11]+0x265e5a51|0,i=s+(a<<14|a>>>18),a=n+(s^t&(i^s))+r[0]+0xe9b6c7aa|0,n=i+(a<<20|a>>>12),a=t+(i^s&(n^i))+r[5]+0xd62f105d|0,t=n+(a<<5|a>>>27),a=s+(n^i&(t^n))+r[10]+0x2441453|0,s=t+(a<<9|a>>>23),a=i+(t^n&(s^t))+r[15]+0xd8a1e681|0,i=s+(a<<14|a>>>18),a=n+(s^t&(i^s))+r[4]+0xe7d3fbc8|0,n=i+(a<<20|a>>>12),a=t+(i^s&(n^i))+r[9]+0x21e1cde6|0,t=n+(a<<5|a>>>27),a=s+(n^i&(t^n))+r[14]+0xc33707d6|0,s=t+(a<<9|a>>>23),a=i+(t^n&(s^t))+r[3]+0xf4d50d87|0,i=s+(a<<14|a>>>18),a=n+(s^t&(i^s))+r[8]+0x455a14ed|0,n=i+(a<<20|a>>>12),a=t+(i^s&(n^i))+r[13]+0xa9e3e905|0,t=n+(a<<5|a>>>27),a=s+(n^i&(t^n))+r[2]+0xfcefa3f8|0,s=t+(a<<9|a>>>23),a=i+(t^n&(s^t))+r[7]+0x676f02d9|0,i=s+(a<<14|a>>>18),a=n+(s^t&(i^s))+r[12]+0x8d2a4c8a|0,a=t+((n=i+(a<<20|a>>>12))^i^s)+r[5]+0xfffa3942|0,a=s+((t=n+(a<<4|a>>>28))^n^i)+r[8]+0x8771f681|0,a=i+((s=t+(a<<11|a>>>21))^t^n)+r[11]+0x6d9d6122|0,a=n+((i=s+(a<<16|a>>>16))^s^t)+r[14]+0xfde5380c|0,a=t+((n=i+(a<<23|a>>>9))^i^s)+r[1]+0xa4beea44|0,a=s+((t=n+(a<<4|a>>>28))^n^i)+r[4]+0x4bdecfa9|0,a=i+((s=t+(a<<11|a>>>21))^t^n)+r[7]+0xf6bb4b60|0,a=n+((i=s+(a<<16|a>>>16))^s^t)+r[10]+0xbebfbc70|0,a=t+((n=i+(a<<23|a>>>9))^i^s)+r[13]+0x289b7ec6|0,a=s+((t=n+(a<<4|a>>>28))^n^i)+r[0]+0xeaa127fa|0,a=i+((s=t+(a<<11|a>>>21))^t^n)+r[3]+0xd4ef3085|0,a=n+((i=s+(a<<16|a>>>16))^s^t)+r[6]+0x4881d05|0,a=t+((n=i+(a<<23|a>>>9))^i^s)+r[9]+0xd9d4d039|0,a=s+((t=n+(a<<4|a>>>28))^n^i)+r[12]+0xe6db99e5|0,a=i+((s=t+(a<<11|a>>>21))^t^n)+r[15]+0x1fa27cf8|0,a=n+((i=s+(a<<16|a>>>16))^s^t)+r[2]+0xc4ac5665|0,n=i+(a<<23|a>>>9),a=t+(i^(n|~s))+r[0]+0xf4292244|0,t=n+(a<<6|a>>>26),a=s+(n^(t|~i))+r[7]+0x432aff97|0,s=t+(a<<10|a>>>22),a=i+(t^(s|~n))+r[14]+0xab9423a7|0,i=s+(a<<15|a>>>17),a=n+(s^(i|~t))+r[5]+0xfc93a039|0,n=i+(a<<21|a>>>11),a=t+(i^(n|~s))+r[12]+0x655b59c3|0,t=n+(a<<6|a>>>26),a=s+(n^(t|~i))+r[3]+0x8f0ccc92|0,s=t+(a<<10|a>>>22),a=i+(t^(s|~n))+r[10]+0xffeff47d|0,i=s+(a<<15|a>>>17),a=n+(s^(i|~t))+r[1]+0x85845dd1|0,n=i+(a<<21|a>>>11),a=t+(i^(n|~s))+r[8]+0x6fa87e4f|0,t=n+(a<<6|a>>>26),a=s+(n^(t|~i))+r[15]+0xfe2ce6e0|0,s=t+(a<<10|a>>>22),a=i+(t^(s|~n))+r[6]+0xa3014314|0,i=s+(a<<15|a>>>17),a=n+(s^(i|~t))+r[13]+0x4e0811a1|0,n=i+(a<<21|a>>>11),a=t+(i^(n|~s))+r[4]+0xf7537e82|0,t=n+(a<<6|a>>>26),a=s+(n^(t|~i))+r[11]+0xbd3af235|0,s=t+(a<<10|a>>>22),a=i+(t^(s|~n))+r[2]+0x2ad7d2bb|0,i=s+(a<<15|a>>>17),a=n+(s^(i|~t))+r[9]+0xeb86d391|0,e.g[0]=e.g[0]+t|0,e.g[1]=e.g[1]+(i+(a<<21|a>>>11))|0,e.g[2]=e.g[2]+i|0,e.g[3]=e.g[3]+s|0}function i(e,t){this.h=t;for(var n=[],r=!0,i=e.length-1;0<=i;i--){var s=0|e[i];r&&s==t||(n[i]=s,r=!1)}this.g=n}n.prototype=t.prototype,e.D=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.C=function(e,n,r){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return t.prototype[n].apply(e,i)},e.prototype.s=function(){this.g[0]=0x67452301,this.g[1]=0xefcdab89,this.g[2]=0x98badcfe,this.g[3]=0x10325476,this.o=this.h=0},e.prototype.u=function(e,t){void 0===t&&(t=e.length);for(var n=t-this.blockSize,i=this.B,s=this.h,a=0;a<t;){if(0==s)for(;a<=n;)r(this,e,a),a+=this.blockSize;if("string"==typeof e){for(;a<t;)if(i[s++]=e.charCodeAt(a++),s==this.blockSize){r(this,i),s=0;break}}else for(;a<t;)if(i[s++]=e[a++],s==this.blockSize){r(this,i),s=0;break}}this.h=s,this.o+=t},e.prototype.v=function(){var e=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;var n=8*this.o;for(t=e.length-8;t<e.length;++t)e[t]=255&n,n/=256;for(this.u(e),e=Array(16),t=n=0;4>t;++t)for(var r=0;32>r;r+=8)e[n++]=this.g[t]>>>r&255;return e};var s,a={};function o(e){var t;return -128<=e&&128>e?(t=function(e){return new i([0|e],0>e?-1:0)},Object.prototype.hasOwnProperty.call(a,e)?a[e]:a[e]=t(e)):new i([0|e],0>e?-1:0)}function h(e){if(isNaN(e)||!isFinite(e))return c;if(0>e)return m(h(-e));for(var t=[],n=1,r=0;e>=n;r++)t[r]=e/n|0,n*=0x100000000;return new i(t,0)}var c=o(0),d=o(1),f=o(0x1000000);function p(e){if(0!=e.h)return!1;for(var t=0;t<e.g.length;t++)if(0!=e.g[t])return!1;return!0}function g(e){return -1==e.h}function m(e){for(var t=e.g.length,n=[],r=0;r<t;r++)n[r]=~e.g[r];return new i(n,~e.h).add(d)}function y(e,t){return e.add(m(t))}function v(e,t){for(;(65535&e[t])!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function w(e,t){this.g=e,this.h=t}function b(e,t){if(p(t))throw Error("division by zero");if(p(e))return new w(c,c);if(g(e))return t=b(m(e),t),new w(m(t.g),m(t.h));if(g(t))return t=b(e,m(t)),new w(m(t.g),t.h);if(30<e.g.length){if(g(e)||g(t))throw Error("slowDivide_ only works with positive integers.");for(var n=d,r=t;0>=r.l(e);)n=E(n),r=E(r);var i=T(n,1),s=T(r,1);for(r=T(r,2),n=T(n,2);!p(r);){var a=s.add(r);0>=a.l(e)&&(i=i.add(n),s=a),r=T(r,1),n=T(n,1)}return t=y(e,i.j(t)),new w(i,t)}for(i=c;0<=e.l(t);){for(r=48>=(r=Math.ceil(Math.log(n=Math.max(1,Math.floor(e.m()/t.m())))/Math.LN2))?1:Math.pow(2,r-48),a=(s=h(n)).j(t);g(a)||0<a.l(e);)n-=r,a=(s=h(n)).j(t);p(s)&&(s=d),i=i.add(s),e=y(e,a)}return new w(i,e)}function E(e){for(var t=e.g.length+1,n=[],r=0;r<t;r++)n[r]=e.i(r)<<1|e.i(r-1)>>>31;return new i(n,e.h)}function T(e,t){var n=t>>5;t%=32;for(var r=e.g.length-n,s=[],a=0;a<r;a++)s[a]=0<t?e.i(a+n)>>>t|e.i(a+n+1)<<32-t:e.i(a+n);return new i(s,e.h)}(s=i.prototype).m=function(){if(g(this))return-m(this).m();for(var e=0,t=1,n=0;n<this.g.length;n++){var r=this.i(n);e+=(0<=r?r:0x100000000+r)*t,t*=0x100000000}return e},s.toString=function(e){if(2>(e=e||10)||36<e)throw Error("radix out of range: "+e);if(p(this))return"0";if(g(this))return"-"+m(this).toString(e);for(var t=h(Math.pow(e,6)),n=this,r="";;){var i=b(n,t).g,s=((0<(n=y(n,i.j(t))).g.length?n.g[0]:n.h)>>>0).toString(e);if(p(n=i))return s+r;for(;6>s.length;)s="0"+s;r=s+r}},s.i=function(e){return 0>e?0:e<this.g.length?this.g[e]:this.h},s.l=function(e){return g(e=y(this,e))?-1:+!p(e)},s.abs=function(){return g(this)?m(this):this},s.add=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0,s=0;s<=t;s++){var a=r+(65535&this.i(s))+(65535&e.i(s)),o=(a>>>16)+(this.i(s)>>>16)+(e.i(s)>>>16);r=o>>>16,a&=65535,o&=65535,n[s]=o<<16|a}return new i(n,-0x80000000&n[n.length-1]?-1:0)},s.j=function(e){if(p(this)||p(e))return c;if(g(this))return g(e)?m(this).j(m(e)):m(m(this).j(e));if(g(e))return m(this.j(m(e)));if(0>this.l(f)&&0>e.l(f))return h(this.m()*e.m());for(var t=this.g.length+e.g.length,n=[],r=0;r<2*t;r++)n[r]=0;for(r=0;r<this.g.length;r++)for(var s=0;s<e.g.length;s++){var a=this.i(r)>>>16,o=65535&this.i(r),l=e.i(s)>>>16,u=65535&e.i(s);n[2*r+2*s]+=o*u,v(n,2*r+2*s),n[2*r+2*s+1]+=a*u,v(n,2*r+2*s+1),n[2*r+2*s+1]+=o*l,v(n,2*r+2*s+1),n[2*r+2*s+2]+=a*l,v(n,2*r+2*s+2)}for(r=0;r<t;r++)n[r]=n[2*r+1]<<16|n[2*r];for(r=t;r<2*t;r++)n[r]=0;return new i(n,0)},s.A=function(e){return b(this,e).h},s.and=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.i(r)&e.i(r);return new i(n,this.h&e.h)},s.or=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.i(r)|e.i(r);return new i(n,this.h|e.h)},s.xor=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.i(r)^e.i(r);return new i(n,this.h^e.h)},e.prototype.digest=e.prototype.v,e.prototype.reset=e.prototype.s,e.prototype.update=e.prototype.u,u=eJ.Md5=e,i.prototype.add=i.prototype.add,i.prototype.multiply=i.prototype.j,i.prototype.modulo=i.prototype.A,i.prototype.compare=i.prototype.l,i.prototype.toNumber=i.prototype.m,i.prototype.toString=i.prototype.toString,i.prototype.getBits=i.prototype.i,i.fromNumber=h,i.fromString=function e(t,n){if(0==t.length)throw Error("number format error: empty string");if(2>(n=n||10)||36<n)throw Error("radix out of range: "+n);if("-"==t.charAt(0))return m(e(t.substring(1),n));if(0<=t.indexOf("-"))throw Error('number format error: interior "-" character');for(var r=h(Math.pow(n,8)),i=c,s=0;s<t.length;s+=8){var a=Math.min(8,t.length-s),o=parseInt(t.substring(s,s+a),n);8>a?(a=h(Math.pow(n,a)),i=i.j(a).add(h(o))):i=(i=i.j(r)).add(h(o))}return i},l=eJ.Integer=i}).apply(void 0!==eY?eY:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});var eZ="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==S?S:"undefined"!=typeof self?self:{},e0={};(function(){var e,t,n,r="function"==typeof Object.defineProperties?Object.defineProperty:function(e,t,n){return e==Array.prototype||e==Object.prototype||(e[t]=n.value),e},i=function(e){e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof eZ&&eZ];for(var t=0;t<e.length;++t){var n=e[t];if(n&&n.Math==Math)return n}throw Error("Cannot find global object")}(this);!function(e,t){if(t)e:{var n=i;e=e.split(".");for(var s=0;s<e.length-1;s++){var a=e[s];if(!(a in n))break e;n=n[a]}(t=t(s=n[e=e[e.length-1]]))!=s&&null!=t&&r(n,e,{configurable:!0,writable:!0,value:t})}}("Array.prototype.values",function(e){return e||function(){var e,t,n,r,i;return e=this,t=function(e,t){return t},e instanceof String&&(e+=""),n=0,r=!1,(i={next:function(){if(!r&&n<e.length){var i=n++;return{value:t(i,e[i]),done:!1}}return r=!0,{done:!0,value:void 0}}})[Symbol.iterator]=function(){return i},i}});var s=s||{},a=this||self;function o(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function l(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}function u(e,t,n){return e.call.apply(e.bind,arguments)}function v(e,t,n){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),e.apply(t,n)}}return function(){return e.apply(t,arguments)}}function w(e,t,n){return(w=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?u:v).apply(null,arguments)}function b(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function E(e,t){function n(){}n.prototype=t.prototype,e.aa=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.Qb=function(e,n,r){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return t.prototype[n].apply(e,i)}}function T(e){let t=e.length;if(0<t){let n=Array(t);for(let r=0;r<t;r++)n[r]=e[r];return n}return[]}function _(e,t){for(let t=1;t<arguments.length;t++){let n=arguments[t];if(o(n)){let t=e.length||0,r=n.length||0;e.length=t+r;for(let i=0;i<r;i++)e[t+i]=n[i]}else e.push(n)}}function I(e){return/^[\s\xa0]*$/.test(e)}function S(){var e=a.navigator;return e&&(e=e.userAgent)?e:""}function C(e){return C[" "](e),e}C[" "]=function(){};var A=-1!=S().indexOf("Gecko")&&(-1==S().toLowerCase().indexOf("webkit")||-1!=S().indexOf("Edge"))&&-1==S().indexOf("Trident")&&-1==S().indexOf("MSIE")&&-1==S().indexOf("Edge");function x(e,t,n){for(let r in e)t.call(n,e[r],r,e)}function D(e){let t={};for(let n in e)t[n]=e[n];return t}let k="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function N(e,t){let n,r;for(let t=1;t<arguments.length;t++){for(n in r=arguments[t])e[n]=r[n];for(let t=0;t<k.length;t++)n=k[t],Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}}var L=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}(()=>new R,e=>e.reset());class R{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}let O,M=!1,P=new class{constructor(){this.h=this.g=null}add(e,t){let n=L.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}},F=()=>{let e=a.Promise.resolve(void 0);O=()=>{e.then(V)}};var V=()=>{let e;for(var t;e=null,P.g&&(e=P.g,P.g=P.g.next,P.g||(P.h=null),e.next=null),t=e;){try{t.h.call(t.g)}catch(e){!function(e){a.setTimeout(()=>{throw e},0)}(e)}L.j(t),100>L.h&&(L.h++,t.next=L.g,L.g=t)}M=!1};function B(){this.s=this.s,this.C=this.C}function U(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}B.prototype.s=!1,B.prototype.ma=function(){this.s||(this.s=!0,this.N())},B.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()},U.prototype.h=function(){this.defaultPrevented=!0};var j=function(){if(!a.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{let e=()=>{};a.addEventListener("test",e,t),a.removeEventListener("test",e,t)}catch(e){}return e}();function $(e,t){if(U.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var n=this.type=e.type,r=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(A){e:{try{C(t.nodeName);var i=!0;break e}catch(e){}i=!1}i||(t=null)}}else"mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement);this.relatedTarget=t,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"==typeof e.pointerType?e.pointerType:q[e.pointerType]||"",this.state=e.state,this.i=e,e.defaultPrevented&&$.aa.h.call(this)}}E($,U);var q={2:"touch",3:"pen",4:"mouse"};$.prototype.h=function(){$.aa.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var z="closure_listenable_"+(1e6*Math.random()|0),W=0;function H(e,t,n,r,i){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!r,this.ha=i,this.key=++W,this.da=this.fa=!1}function G(e){e.da=!0,e.listener=null,e.proxy=null,e.src=null,e.ha=null}function K(e){this.src=e,this.g={},this.h=0}function Q(e,t){var n=t.type;if(n in e.g){var r,i=e.g[n],s=Array.prototype.indexOf.call(i,t,void 0);(r=0<=s)&&Array.prototype.splice.call(i,s,1),r&&(G(t),0==e.g[n].length&&(delete e.g[n],e.h--))}}function X(e,t,n,r){for(var i=0;i<e.length;++i){var s=e[i];if(!s.da&&s.listener==t&&!!n==s.capture&&s.ha==r)return i}return -1}K.prototype.add=function(e,t,n,r,i){var s=e.toString();(e=this.g[s])||(e=this.g[s]=[],this.h++);var a=X(e,t,r,i);return -1<a?(t=e[a],n||(t.fa=!1)):((t=new H(t,this.src,s,!!r,i)).fa=n,e.push(t)),t};var Y="closure_lm_"+(1e6*Math.random()|0),J={};function Z(e,t,n,r,i,s){if(!t)throw Error("Invalid event type");var a=l(i)?!!i.capture:!!i,o=er(e);if(o||(e[Y]=o=new K(e)),(n=o.add(t,n,r,a,s)).proxy)return n;if(r=function e(t){return en.call(e.src,e.listener,t)},n.proxy=r,r.src=e,r.listener=n,e.addEventListener)j||(i=a),void 0===i&&(i=!1),e.addEventListener(t.toString(),r,i);else if(e.attachEvent)e.attachEvent(et(t.toString()),r);else if(e.addListener&&e.removeListener)e.addListener(r);else throw Error("addEventListener and attachEvent are unavailable.");return n}function ee(e){if("number"!=typeof e&&e&&!e.da){var t=e.src;if(t&&t[z])Q(t.i,e);else{var n=e.type,r=e.proxy;t.removeEventListener?t.removeEventListener(n,r,e.capture):t.detachEvent?t.detachEvent(et(n),r):t.addListener&&t.removeListener&&t.removeListener(r),(n=er(t))?(Q(n,e),0==n.h&&(n.src=null,t[Y]=null)):G(e)}}}function et(e){return e in J?J[e]:J[e]="on"+e}function en(e,t){if(e.da)e=!0;else{t=new $(t,this);var n=e.listener,r=e.ha||e.src;e.fa&&ee(e),e=n.call(r,t)}return e}function er(e){return(e=e[Y])instanceof K?e:null}var ei="__closure_events_fn_"+(1e9*Math.random()>>>0);function es(e){return"function"==typeof e?e:(e[ei]||(e[ei]=function(t){return e.handleEvent(t)}),e[ei])}function ea(){B.call(this),this.i=new K(this),this.M=this,this.F=null}function eo(e,t){var n,r=e.F;if(r)for(n=[];r;r=r.F)n.push(r);if(e=e.M,r=t.type||t,"string"==typeof t)t=new U(t,e);else if(t instanceof U)t.target=t.target||e;else{var i=t;N(t=new U(r,e),i)}if(i=!0,n)for(var s=n.length-1;0<=s;s--){var a=t.g=n[s];i=el(a,r,!0,t)&&i}if(i=el(a=t.g=e,r,!0,t)&&i,i=el(a,r,!1,t)&&i,n)for(s=0;s<n.length;s++)i=el(a=t.g=n[s],r,!1,t)&&i}function el(e,t,n,r){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();for(var i=!0,s=0;s<t.length;++s){var a=t[s];if(a&&!a.da&&a.capture==n){var o=a.listener,l=a.ha||a.src;a.fa&&Q(e.i,a),i=!1!==o.call(l,r)&&i}}return i&&!r.defaultPrevented}function eu(e,t,n){if("function"==typeof e)n&&(e=w(e,n));else if(e&&"function"==typeof e.handleEvent)e=w(e.handleEvent,e);else throw Error("Invalid listener argument");return 0x7fffffff<Number(t)?-1:a.setTimeout(e,t||0)}E(ea,B),ea.prototype[z]=!0,ea.prototype.removeEventListener=function(e,t,n,r){!function e(t,n,r,i,s){if(Array.isArray(n))for(var a=0;a<n.length;a++)e(t,n[a],r,i,s);else(i=l(i)?!!i.capture:!!i,r=es(r),t&&t[z])?(t=t.i,(n=String(n).toString())in t.g&&-1<(r=X(a=t.g[n],r,i,s))&&(G(a[r]),Array.prototype.splice.call(a,r,1),0==a.length&&(delete t.g[n],t.h--))):t&&(t=er(t))&&(n=t.g[n.toString()],t=-1,n&&(t=X(n,r,i,s)),(r=-1<t?n[t]:null)&&ee(r))}(this,e,t,n,r)},ea.prototype.N=function(){if(ea.aa.N.call(this),this.i){var e,t=this.i;for(e in t.g){for(var n=t.g[e],r=0;r<n.length;r++)G(n[r]);delete t.g[e],t.h--}}this.F=null},ea.prototype.K=function(e,t,n,r){return this.i.add(String(e),t,!1,n,r)},ea.prototype.L=function(e,t,n,r){return this.i.add(String(e),t,!0,n,r)};class eh extends B{constructor(e,t){super(),this.m=e,this.l=t,this.h=null,this.i=!1,this.g=null}j(e){this.h=arguments,this.g?this.i=!0:function e(t){t.g=eu(()=>{t.g=null,t.i&&(t.i=!1,e(t))},t.l);let n=t.h;t.h=null,t.m.apply(null,n)}(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function ec(e){B.call(this),this.h=e,this.g={}}E(ec,B);var ed=[];function ef(e){x(e.g,function(e,t){this.g.hasOwnProperty(t)&&ee(e)},e),e.g={}}ec.prototype.N=function(){ec.aa.N.call(this),ef(this)},ec.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var ep=a.JSON.stringify,eg=a.JSON.parse,em=class{stringify(e){return a.JSON.stringify(e,void 0)}parse(e){return a.JSON.parse(e,void 0)}};function ey(){}function ev(e){return e.h||(e.h=e.i())}function ew(){}ey.prototype.h=null;var eb={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function eE(){U.call(this,"d")}function eT(){U.call(this,"c")}E(eE,U),E(eT,U);var e_={},eI=null;function eS(){return eI=eI||new ea}function eC(e){U.call(this,e_.La,e)}function eA(e){let t=eS();eo(t,new eC(t))}function ex(e,t){U.call(this,e_.STAT_EVENT,e),this.stat=t}function eD(e){let t=eS();eo(t,new ex(t,e))}function ek(e,t){U.call(this,e_.Ma,e),this.size=t}function eN(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){e()},t)}function eL(){this.g=!0}function eR(e,t,n,r){e.info(function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{var n=JSON.parse(t);if(n){for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var r=n[e];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var s=i[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var a=1;a<i.length;a++)i[a]=""}}}}return ep(n)}catch(e){return t}}(e,n)+(r?" "+r:"")})}e_.La="serverreachability",E(eC,U),e_.STAT_EVENT="statevent",E(ex,U),e_.Ma="timingevent",E(ek,U),eL.prototype.xa=function(){this.g=!1},eL.prototype.info=function(){};var eO={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},eM={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"};function eP(){}function eF(e,t,n,r){this.j=e,this.i=t,this.l=n,this.R=r||1,this.U=new ec(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new eV}function eV(){this.i=null,this.g="",this.h=!1}E(eP,ey),eP.prototype.g=function(){return new XMLHttpRequest},eP.prototype.i=function(){return{}},t=new eP;var eB={},eU={};function ej(e,t,n){e.L=1,e.v=ti(e9(t)),e.m=n,e.P=!0,e$(e,null)}function e$(e,t){e.F=Date.now(),ez(e),e.A=e9(e.v);var n,r,i,s,a,o,u=e.A,h=e.R;Array.isArray(h)||(h=[String(h)]),ty(u.i,"t",h),e.C=0,u=e.j.J,e.h=new eV,e.g=t6(e.j,u?t:null,!e.m),0<e.O&&(e.M=new eh(w(e.Y,e,e.g),e.O)),t=e.U,u=e.g,h=e.ca;var c="readystatechange";Array.isArray(c)||(c&&(ed[0]=c.toString()),c=ed);for(var d=0;d<c.length;d++){var f=function e(t,n,r,i,s){if(i&&i.once)return function e(t,n,r,i,s){if(Array.isArray(n)){for(var a=0;a<n.length;a++)e(t,n[a],r,i,s);return null}return r=es(r),t&&t[z]?t.L(n,r,l(i)?!!i.capture:!!i,s):Z(t,n,r,!0,i,s)}(t,n,r,i,s);if(Array.isArray(n)){for(var a=0;a<n.length;a++)e(t,n[a],r,i,s);return null}return r=es(r),t&&t[z]?t.K(n,r,l(i)?!!i.capture:!!i,s):Z(t,n,r,!1,i,s)}(u,c[d],h||t.handleEvent,!1,t.h||t);if(!f)break;t.g[f.key]=f}t=e.H?D(e.H):{},e.m?(e.u||(e.u="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ea(e.A,e.u,e.m,t)):(e.u="GET",e.g.ea(e.A,e.u,null,t)),eA(),n=e.i,r=e.u,i=e.A,s=e.l,a=e.R,o=e.m,n.info(function(){if(n.g)if(o)for(var e="",t=o.split("&"),l=0;l<t.length;l++){var u=t[l].split("=");if(1<u.length){var h=u[0];u=u[1];var c=h.split("_");e=2<=c.length&&"type"==c[1]?e+(h+"=")+u+"&":e+(h+"=redacted&")}}else e=null;else e=o;return"XMLHTTP REQ ("+s+") [attempt "+a+"]: "+r+"\n"+i+"\n"+e})}function eq(e){return!!e.g&&"GET"==e.u&&2!=e.L&&e.j.Ca}function ez(e){e.S=Date.now()+e.I,eW(e,e.I)}function eW(e,t){if(null!=e.B)throw Error("WatchDog timer not null");e.B=eN(w(e.ba,e),t)}function eH(e){e.B&&(a.clearTimeout(e.B),e.B=null)}function eG(e){0==e.j.G||e.J||tJ(e.j,e)}function eK(e){eH(e);var t=e.M;t&&"function"==typeof t.ma&&t.ma(),e.M=null,ef(e.U),e.g&&(t=e.g,e.g=null,t.abort(),t.ma())}function eQ(e,t){try{var n=e.j;if(0!=n.G&&(n.g==e||e2(n.h,e))){if(!e.K&&e2(n.h,e)&&3==n.G){try{var r=n.Da.g.parse(t)}catch(e){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){e:if(!n.u){if(n.g)if(n.g.F+3e3<e.F)tY(n),tj(n);else break e;tK(n),eD(18)}}else n.za=i[1],0<n.za-n.T&&37500>i[2]&&n.F&&0==n.v&&!n.C&&(n.C=eN(w(n.Za,n),6e3));if(1>=e1(n.h)&&n.ca){try{n.ca()}catch(e){}n.ca=void 0}}else t0(n,11)}else if((e.K||n.g==e)&&tY(n),!I(t))for(i=n.Da.g.parse(t),t=0;t<i.length;t++){let o=i[t];if(n.T=o[0],o=o[1],2==n.G)if("c"==o[0]){n.K=o[1],n.ia=o[2];let t=o[3];null!=t&&(n.la=t,n.j.info("VER="+n.la));let i=o[4];null!=i&&(n.Aa=i,n.j.info("SVER="+n.Aa));let l=o[5];null!=l&&"number"==typeof l&&0<l&&(n.L=r=1.5*l,n.j.info("backChannelRequestTimeoutMs_="+r)),r=n;let u=e.g;if(u){let e=u.g?u.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var s=r.h;s.g||-1==e.indexOf("spdy")&&-1==e.indexOf("quic")&&-1==e.indexOf("h2")||(s.j=s.l,s.g=new Set,s.h&&(e6(s,s.h),s.h=null))}if(r.D){let e=u.g?u.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(r.ya=e,tr(r.I,r.D,e))}}if(n.G=3,n.l&&n.l.ua(),n.ba&&(n.R=Date.now()-e.F,n.j.info("Handshake RTT: "+n.R+"ms")),(r=n).qa=t2(r,r.J?r.ia:null,r.W),e.K){e3(r.h,e);var a=r.L;a&&(e.I=a),e.B&&(eH(e),ez(e)),r.g=e}else tG(r);0<n.i.length&&tq(n)}else"stop"!=o[0]&&"close"!=o[0]||t0(n,7);else 3==n.G&&("stop"==o[0]||"close"==o[0]?"stop"==o[0]?t0(n,7):tU(n):"noop"!=o[0]&&n.l&&n.l.ta(o),n.v=0)}}eA(4)}catch(e){}}eF.prototype.ca=function(e){e=e.target;let t=this.M;t&&3==tP(e)?t.j():this.Y(e)},eF.prototype.Y=function(e){try{if(e==this.g)e:{let v=tP(this.g);var t=this.g.Ba();let w=this.g.Z();if(!(3>v)&&(3!=v||this.g&&(this.h.h||this.g.oa()||tF(this.g)))){this.J||4!=v||7==t||(8==t||0>=w?eA(3):eA(2)),eH(this);var n=this.g.Z();this.X=n;t:if(eq(this)){var r=tF(this.g);e="";var i=r.length,s=4==tP(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){eK(this),eG(this);var o="";break t}this.h.i=new a.TextDecoder}for(t=0;t<i;t++)this.h.h=!0,e+=this.h.i.decode(r[t],{stream:!(s&&t==i-1)});r.length=0,this.h.g+=e,this.C=0,o=this.h.g}else o=this.g.oa();if(this.o=200==n,l=this.i,u=this.u,h=this.A,c=this.l,d=this.R,f=n,l.info(function(){return"XMLHTTP RESP ("+c+") [ attempt "+d+"]: "+u+"\n"+h+"\n"+v+" "+f}),this.o){if(this.T&&!this.K){t:{if(this.g){var l,u,h,c,d,f,p,g=this.g;if((p=g.g?g.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!I(p)){var m=p;break t}}m=null}if(n=m)eR(this.i,this.l,n,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,eQ(this,n);else{this.o=!1,this.s=3,eD(12),eK(this),eG(this);break e}}if(this.P){let e;for(n=!0;!this.J&&this.C<o.length;)if((e=function(e,t){var n=e.C,r=t.indexOf("\n",n);return -1==r?eU:isNaN(n=Number(t.substring(n,r)))?eB:(r+=1)+n>t.length?eU:(t=t.slice(r,r+n),e.C=r+n,t)}(this,o))==eU){4==v&&(this.s=4,eD(14),n=!1),eR(this.i,this.l,null,"[Incomplete Response]");break}else if(e==eB){this.s=4,eD(15),eR(this.i,this.l,o,"[Invalid Chunk]"),n=!1;break}else eR(this.i,this.l,e,null),eQ(this,e);if(eq(this)&&0!=this.C&&(this.h.g=this.h.g.slice(this.C),this.C=0),4!=v||0!=o.length||this.h.h||(this.s=1,eD(16),n=!1),this.o=this.o&&n,n){if(0<o.length&&!this.W){this.W=!0;var y=this.j;y.g==this&&y.ba&&!y.M&&(y.j.info("Great, no buffering proxy detected. Bytes received: "+o.length),tQ(y),y.M=!0,eD(11))}}else eR(this.i,this.l,o,"[Invalid Chunked Response]"),eK(this),eG(this)}else eR(this.i,this.l,o,null),eQ(this,o);4==v&&eK(this),this.o&&!this.J&&(4==v?tJ(this.j,this):(this.o=!1,ez(this)))}else(function(e){let t={};e=(e.g&&2<=tP(e)&&e.g.getAllResponseHeaders()||"").split("\r\n");for(let r=0;r<e.length;r++){if(I(e[r]))continue;var n=function(e){var t=1;e=e.split(":");let n=[];for(;0<t&&e.length;)n.push(e.shift()),t--;return e.length&&n.push(e.join(":")),n}(e[r]);let i=n[0];if("string"!=typeof(n=n[1]))continue;n=n.trim();let s=t[i]||[];t[i]=s,s.push(n)}var r=function(e){return e.join(", ")};for(let e in t)r.call(void 0,t[e],e,t)})(this.g),400==n&&0<o.indexOf("Unknown SID")?(this.s=3,eD(12)):(this.s=0,eD(13)),eK(this),eG(this)}}}catch(e){}finally{}},eF.prototype.cancel=function(){this.J=!0,eK(this)},eF.prototype.ba=function(){var e,t;this.B=null;let n=Date.now();0<=n-this.S?(e=this.i,t=this.A,e.info(function(){return"TIMEOUT: "+t}),2!=this.L&&(eA(),eD(17)),eK(this),this.s=2,eG(this)):eW(this,this.S-n)};var eX=class{constructor(e,t){this.g=e,this.map=t}};function eY(e){this.l=e||10,e=a.PerformanceNavigationTiming?0<(e=a.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function eJ(e){return!!e.h||!!e.g&&e.g.size>=e.j}function e1(e){return e.h?1:e.g?e.g.size:0}function e2(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function e6(e,t){e.g?e.g.add(t):e.h=t}function e3(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function e5(e){if(null!=e.h)return e.i.concat(e.h.D);if(null!=e.g&&0!==e.g.size){let t=e.i;for(let n of e.g.values())t=t.concat(n.D);return t}return T(e.i)}function e4(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(o(e)||"string"==typeof e)Array.prototype.forEach.call(e,t,void 0);else for(var n=function(e){if(e.na&&"function"==typeof e.na)return e.na();if(!e.V||"function"!=typeof e.V){if("undefined"!=typeof Map&&e instanceof Map)return Array.from(e.keys());if(!("undefined"!=typeof Set&&e instanceof Set)){if(o(e)||"string"==typeof e){var t=[];e=e.length;for(var n=0;n<e;n++)t.push(n);return t}for(let r in t=[],n=0,e)t[n++]=r;return t}}}(e),r=function(e){if(e.V&&"function"==typeof e.V)return e.V();if("undefined"!=typeof Map&&e instanceof Map||"undefined"!=typeof Set&&e instanceof Set)return Array.from(e.values());if("string"==typeof e)return e.split("");if(o(e)){for(var t=[],n=e.length,r=0;r<n;r++)t.push(e[r]);return t}for(r in t=[],n=0,e)t[n++]=e[r];return t}(e),i=r.length,s=0;s<i;s++)t.call(void 0,r[s],n&&n[s],e)}eY.prototype.cancel=function(){if(this.i=e5(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(let e of this.g.values())e.cancel();this.g.clear()}};var e8=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function e7(e){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,e instanceof e7){this.h=e.h,te(this,e.j),this.o=e.o,this.g=e.g,tt(this,e.s),this.l=e.l;var t=e.i,n=new tf;n.i=t.i,t.g&&(n.g=new Map(t.g),n.h=t.h),tn(this,n),this.m=e.m}else e&&(t=String(e).match(e8))?(this.h=!1,te(this,t[1]||"",!0),this.o=ts(t[2]||""),this.g=ts(t[3]||"",!0),tt(this,t[4]),this.l=ts(t[5]||"",!0),tn(this,t[6]||"",!0),this.m=ts(t[7]||"")):(this.h=!1,this.i=new tf(null,this.h))}function e9(e){return new e7(e)}function te(e,t,n){e.j=n?ts(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function tt(e,t){if(t){if(isNaN(t=Number(t))||0>t)throw Error("Bad port number "+t);e.s=t}else e.s=null}function tn(e,t,n){var r,i;t instanceof tf?(e.i=t,r=e.i,(i=e.h)&&!r.j&&(tp(r),r.i=null,r.g.forEach(function(e,t){var n=t.toLowerCase();t!=n&&(tg(this,t),ty(this,n,e))},r)),r.j=i):(n||(t=ta(t,tc)),e.i=new tf(t,e.h))}function tr(e,t,n){e.i.set(t,n)}function ti(e){return tr(e,"zx",Math.floor(0x80000000*Math.random()).toString(36)+Math.abs(Math.floor(0x80000000*Math.random())^Date.now()).toString(36)),e}function ts(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function ta(e,t,n){return"string"==typeof e?(e=encodeURI(e).replace(t,to),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function to(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}e7.prototype.toString=function(){var e=[],t=this.j;t&&e.push(ta(t,tl,!0),":");var n=this.g;return(n||"file"==t)&&(e.push("//"),(t=this.o)&&e.push(ta(t,tl,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.s)&&e.push(":",String(n))),(n=this.l)&&(this.g&&"/"!=n.charAt(0)&&e.push("/"),e.push(ta(n,"/"==n.charAt(0)?th:tu,!0))),(n=this.i.toString())&&e.push("?",n),(n=this.m)&&e.push("#",ta(n,td)),e.join("")};var tl=/[#\/\?@]/g,tu=/[#\?:]/g,th=/[#\?]/g,tc=/[#\?@]/g,td=/#/g;function tf(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function tp(e){e.g||(e.g=new Map,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(var n=0;n<e.length;n++){var r=e[n].indexOf("="),i=null;if(0<=r){var s=e[n].substring(0,r);i=e[n].substring(r+1)}else s=e[n];t(s,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(e.i,function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)}))}function tg(e,t){tp(e),t=tv(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function tm(e,t){return tp(e),t=tv(e,t),e.g.has(t)}function ty(e,t,n){tg(e,t),0<n.length&&(e.i=null,e.g.set(tv(e,t),T(n)),e.h+=n.length)}function tv(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}function tw(e,t,n,r,i){try{i&&(i.onload=null,i.onerror=null,i.onabort=null,i.ontimeout=null),r(n)}catch(e){}}function tb(){this.g=new em}function tE(e){this.l=e.Ub||null,this.j=e.eb||!1}function tT(e,t){ea.call(this),this.D=e,this.o=t,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}function t_(e){e.j.read().then(e.Pa.bind(e)).catch(e.ga.bind(e))}function tI(e){e.readyState=4,e.l=null,e.j=null,e.v=null,tS(e)}function tS(e){e.onreadystatechange&&e.onreadystatechange.call(e)}function tC(e){let t="";return x(e,function(e,n){t+=n,t+=":",t+=e,t+="\r\n"}),t}function tA(e,t,n){e:{for(r in n){var r=!1;break e}r=!0}r||(n=tC(n),"string"==typeof e?null!=n&&encodeURIComponent(String(n)):tr(e,t,n))}function tx(e){ea.call(this),this.headers=new Map,this.o=e||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}(n=tf.prototype).add=function(e,t){tp(this),this.i=null,e=tv(this,e);var n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},n.forEach=function(e,t){tp(this),this.g.forEach(function(n,r){n.forEach(function(n){e.call(t,n,r,this)},this)},this)},n.na=function(){tp(this);let e=Array.from(this.g.values()),t=Array.from(this.g.keys()),n=[];for(let r=0;r<t.length;r++){let i=e[r];for(let e=0;e<i.length;e++)n.push(t[r])}return n},n.V=function(e){tp(this);let t=[];if("string"==typeof e)tm(this,e)&&(t=t.concat(this.g.get(tv(this,e))));else{e=Array.from(this.g.values());for(let n=0;n<e.length;n++)t=t.concat(e[n])}return t},n.set=function(e,t){return tp(this),this.i=null,tm(this,e=tv(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},n.get=function(e,t){return e&&0<(e=this.V(e)).length?String(e[0]):t},n.toString=function(){if(this.i)return this.i;if(!this.g)return"";let e=[],t=Array.from(this.g.keys());for(var n=0;n<t.length;n++){var r=t[n];let s=encodeURIComponent(String(r)),a=this.V(r);for(r=0;r<a.length;r++){var i=s;""!==a[r]&&(i+="="+encodeURIComponent(String(a[r]))),e.push(i)}}return this.i=e.join("&")},E(tE,ey),tE.prototype.g=function(){return new tT(this.l,this.j)},tE.prototype.i=(e={},function(){return e}),E(tT,ea),(n=tT.prototype).open=function(e,t){if(0!=this.readyState)throw this.abort(),Error("Error reopening a connection");this.B=e,this.A=t,this.readyState=1,tS(this)},n.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;let t={headers:this.u,method:this.B,credentials:this.m,cache:void 0};e&&(t.body=e),(this.D||a).fetch(new Request(this.A,t)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,tI(this)),this.readyState=0},n.Sa=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,tS(this)),this.g&&(this.readyState=3,tS(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(void 0!==a.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;t_(this)}else e.text().then(this.Ra.bind(this),this.ga.bind(this))},n.Pa=function(e){if(this.g){if(this.o&&e.value)this.response.push(e.value);else if(!this.o){var t=e.value?e.value:new Uint8Array(0);(t=this.v.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?tI(this):tS(this),3==this.readyState&&t_(this)}},n.Ra=function(e){this.g&&(this.response=this.responseText=e,tI(this))},n.Qa=function(e){this.g&&(this.response=e,tI(this))},n.ga=function(){this.g&&tI(this)},n.setRequestHeader=function(e,t){this.u.append(e,t)},n.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";let e=[],t=this.h.entries();for(var n=t.next();!n.done;)e.push((n=n.value)[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(tT.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}}),E(tx,ea);var tD=/^https?$/i,tk=["POST","PUT"];function tN(e,t){e.h=!1,e.g&&(e.j=!0,e.g.abort(),e.j=!1),e.l=t,e.m=5,tL(e),tO(e)}function tL(e){e.A||(e.A=!0,eo(e,"complete"),eo(e,"error"))}function tR(e){if(e.h&&void 0!==s&&(!e.v[1]||4!=tP(e)||2!=e.Z())){if(e.u&&4==tP(e))eu(e.Ea,0,e);else if(eo(e,"readystatechange"),4==tP(e)){e.h=!1;try{let s=e.Z();switch(s){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t,n,r=!0;break;default:r=!1}if(!(t=r)){if(n=0===s){var i=String(e.D).match(e8)[1]||null;!i&&a.self&&a.self.location&&(i=a.self.location.protocol.slice(0,-1)),n=!tD.test(i?i.toLowerCase():"")}t=n}if(t)eo(e,"complete"),eo(e,"success");else{e.m=6;try{var o=2<tP(e)?e.g.statusText:""}catch(e){o=""}e.l=o+" ["+e.Z()+"]",tL(e)}}finally{tO(e)}}}}function tO(e,t){if(e.g){tM(e);let n=e.g,r=e.v[0]?()=>{}:null;e.g=null,e.v=null,t||eo(e,"ready");try{n.onreadystatechange=r}catch(e){}}}function tM(e){e.I&&(a.clearTimeout(e.I),e.I=null)}function tP(e){return e.g?e.g.readyState:0}function tF(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.H){case"":case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(e){return null}}function tV(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function tB(e){this.Aa=0,this.i=[],this.j=new eL,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=tV("failFast",!1,e),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=tV("baseRetryDelayMs",5e3,e),this.cb=tV("retryDelaySeedMs",1e4,e),this.Wa=tV("forwardChannelMaxRetries",2,e),this.wa=tV("forwardChannelRequestTimeoutMs",2e4,e),this.pa=e&&e.xmlHttpFactory||void 0,this.Xa=e&&e.Tb||void 0,this.Ca=e&&e.useFetchStreams||!1,this.L=void 0,this.J=e&&e.supportsCrossDomainXhr||!1,this.K="",this.h=new eY(e&&e.concurrentRequestLimit),this.Da=new tb,this.P=e&&e.fastHandshake||!1,this.O=e&&e.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=e&&e.Rb||!1,e&&e.xa&&this.j.xa(),e&&e.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&e&&e.detectBufferingProxy||!1,this.ja=void 0,e&&e.longPollingTimeout&&0<e.longPollingTimeout&&(this.ja=e.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}function tU(e){if(t$(e),3==e.G){var t=e.U++,n=e9(e.I);if(tr(n,"SID",e.K),tr(n,"RID",t),tr(n,"TYPE","terminate"),tW(e,n),(t=new eF(e,e.j,t)).L=2,t.v=ti(e9(n)),n=!1,a.navigator&&a.navigator.sendBeacon)try{n=a.navigator.sendBeacon(t.v.toString(),"")}catch(e){}!n&&a.Image&&((new Image).src=t.v,n=!0),n||(t.g=t6(t.j,null),t.g.ea(t.v)),t.F=Date.now(),ez(t)}t1(e)}function tj(e){e.g&&(tQ(e),e.g.cancel(),e.g=null)}function t$(e){tj(e),e.u&&(a.clearTimeout(e.u),e.u=null),tY(e),e.h.cancel(),e.s&&("number"==typeof e.s&&a.clearTimeout(e.s),e.s=null)}function tq(e){if(!eJ(e.h)&&!e.s){e.s=!0;var t=e.Ga;O||F(),M||(O(),M=!0),P.add(t,e),e.B=0}}function tz(e,t){var n;n=t?t.l:e.U++;let r=e9(e.I);tr(r,"SID",e.K),tr(r,"RID",n),tr(r,"AID",e.T),tW(e,r),e.m&&e.o&&tA(r,e.m,e.o),n=new eF(e,e.j,n,e.B+1),null===e.m&&(n.H=e.o),t&&(e.i=t.D.concat(e.i)),t=tH(e,n,1e3),n.I=Math.round(.5*e.wa)+Math.round(.5*e.wa*Math.random()),e6(e.h,n),ej(n,r,t)}function tW(e,t){e.H&&x(e.H,function(e,n){tr(t,n,e)}),e.l&&e4({},function(e,n){tr(t,n,e)})}function tH(e,t,n){n=Math.min(e.i.length,n);var r=e.l?w(e.l.Na,e.l,e):null;e:{var i=e.i;let t=-1;for(;;){let e=["count="+n];-1==t?0<n?(t=i[0].g,e.push("ofs="+t)):t=0:e.push("ofs="+t);let s=!0;for(let a=0;a<n;a++){let n=i[a].g,o=i[a].map;if(0>(n-=t))t=Math.max(0,i[a].g-100),s=!1;else try{!function(e,t,n){let r=n||"";try{e4(e,function(e,n){let i=e;l(e)&&(i=ep(e)),t.push(r+n+"="+encodeURIComponent(i))})}catch(e){throw t.push(r+"type="+encodeURIComponent("_badmap")),e}}(o,e,"req"+n+"_")}catch(e){r&&r(o)}}if(s){r=e.join("&");break e}}}return t.D=e=e.i.splice(0,n),r}function tG(e){if(!e.g&&!e.u){e.Y=1;var t=e.Fa;O||F(),M||(O(),M=!0),P.add(t,e),e.v=0}}function tK(e){return!e.g&&!e.u&&!(3<=e.v)&&(e.Y++,e.u=eN(w(e.Fa,e),tZ(e,e.v)),e.v++,!0)}function tQ(e){null!=e.A&&(a.clearTimeout(e.A),e.A=null)}function tX(e){e.g=new eF(e,e.j,"rpc",e.Y),null===e.m&&(e.g.H=e.o),e.g.O=0;var t=e9(e.qa);tr(t,"RID","rpc"),tr(t,"SID",e.K),tr(t,"AID",e.T),tr(t,"CI",e.F?"0":"1"),!e.F&&e.ja&&tr(t,"TO",e.ja),tr(t,"TYPE","xmlhttp"),tW(e,t),e.m&&e.o&&tA(t,e.m,e.o),e.L&&(e.g.I=e.L);var n=e.g;e=e.ia,n.L=1,n.v=ti(e9(t)),n.m=null,n.P=!0,e$(n,e)}function tY(e){null!=e.C&&(a.clearTimeout(e.C),e.C=null)}function tJ(e,t){var n,r=null;if(e.g==t){tY(e),tQ(e),e.g=null;var i=2}else{if(!e2(e.h,t))return;r=t.D,e3(e.h,t),i=1}if(0!=e.G){if(t.o)if(1==i){r=t.m?t.m.length:0,t=Date.now()-t.F;var s=e.B;eo(i=eS(),new ek(i,r)),tq(e)}else tG(e);else if(3==(s=t.s)||0==s&&0<t.X||!(1==i&&(n=t,!(e1(e.h)>=e.h.j-!!e.s)&&(e.s?(e.i=n.D.concat(e.i),!0):1!=e.G&&2!=e.G&&!(e.B>=(e.Va?0:e.Wa))&&(e.s=eN(w(e.Ga,e,n),tZ(e,e.B)),e.B++,!0)))||2==i&&tK(e)))switch(r&&0<r.length&&((t=e.h).i=t.i.concat(r)),s){case 1:t0(e,5);break;case 4:t0(e,10);break;case 3:t0(e,6);break;default:t0(e,2)}}}function tZ(e,t){let n=e.Ta+Math.floor(Math.random()*e.cb);return e.isActive()||(n*=2),n*t}function t0(e,t){if(e.j.info("Error code "+t),2==t){var n=w(e.fb,e),r=e.Xa;let t=!r;r=new e7(r||"//www.google.com/images/cleardot.gif"),a.location&&"http"==a.location.protocol||te(r,"https"),ti(r),t?function(e,t){let n=new eL;if(a.Image){let r=new Image;r.onload=b(tw,n,"TestLoadImage: loaded",!0,t,r),r.onerror=b(tw,n,"TestLoadImage: error",!1,t,r),r.onabort=b(tw,n,"TestLoadImage: abort",!1,t,r),r.ontimeout=b(tw,n,"TestLoadImage: timeout",!1,t,r),a.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=e}else t(!1)}(r.toString(),n):function(e,t){let n=new eL,r=new AbortController,i=setTimeout(()=>{r.abort(),tw(n,"TestPingServer: timeout",!1,t)},1e4);fetch(e,{signal:r.signal}).then(e=>{clearTimeout(i),e.ok?tw(n,"TestPingServer: ok",!0,t):tw(n,"TestPingServer: server error",!1,t)}).catch(()=>{clearTimeout(i),tw(n,"TestPingServer: error",!1,t)})}(r.toString(),n)}else eD(2);e.G=0,e.l&&e.l.sa(t),t1(e),t$(e)}function t1(e){if(e.G=0,e.ka=[],e.l){let t=e5(e.h);(0!=t.length||0!=e.i.length)&&(_(e.ka,t),_(e.ka,e.i),e.h.i.length=0,T(e.i),e.i.length=0),e.l.ra()}}function t2(e,t,n){var r=n instanceof e7?e9(n):new e7(n);if(""!=r.g)t&&(r.g=t+"."+r.g),tt(r,r.s);else{var i=a.location;r=i.protocol,t=t?t+"."+i.hostname:i.hostname,i=+i.port;var s=new e7(null);r&&te(s,r),t&&(s.g=t),i&&tt(s,i),n&&(s.l=n),r=s}return n=e.D,t=e.ya,n&&t&&tr(r,n,t),tr(r,"VER",e.la),tW(e,r),r}function t6(e,t,n){if(t&&!e.J)throw Error("Can't create secondary domain capable XhrIo object.");return(t=new tx(e.Ca&&!e.pa?new tE({eb:n}):e.pa)).Ha(e.J),t}function t3(){}function t5(){}function t4(e,t){ea.call(this),this.g=new tB(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.o=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.va&&(e?e["X-WebChannel-Client-Profile"]=t.va:e={"X-WebChannel-Client-Profile":t.va}),this.g.S=e,(e=t&&t.Sb)&&!I(e)&&(this.g.m=e),this.v=t&&t.supportsCrossDomainXhr||!1,this.u=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!I(t)&&(this.g.D=t,null!==(e=this.h)&&t in e&&t in(e=this.h)&&delete e[t]),this.j=new t9(this)}function t8(e){eE.call(this),e.__headers__&&(this.headers=e.__headers__,this.statusCode=e.__status__,delete e.__headers__,delete e.__status__);var t=e.__sm__;if(t){e:{for(let n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function t7(){eT.call(this),this.status=1}function t9(e){this.g=e}(n=tx.prototype).Ha=function(e){this.J=e},n.ea=function(e,n,r,i){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+e);n=n?n.toUpperCase():"GET",this.D=e,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():t.g(),this.v=this.o?ev(this.o):ev(t),this.g.onreadystatechange=w(this.Ea,this);try{this.B=!0,this.g.open(n,String(e),!0),this.B=!1}catch(e){tN(this,e);return}if(e=r||"",r=new Map(this.headers),i)if(Object.getPrototypeOf(i)===Object.prototype)for(var s in i)r.set(s,i[s]);else if("function"==typeof i.keys&&"function"==typeof i.get)for(let e of i.keys())r.set(e,i.get(e));else throw Error("Unknown input type for opt_headers: "+String(i));for(let[t,o]of(i=Array.from(r.keys()).find(e=>"content-type"==e.toLowerCase()),s=a.FormData&&e instanceof a.FormData,!(0<=Array.prototype.indexOf.call(tk,n,void 0))||i||s||r.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),r))this.g.setRequestHeader(t,o);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{tM(this),this.u=!0,this.g.send(e),this.u=!1}catch(e){tN(this,e)}},n.abort=function(e){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=e||7,eo(this,"complete"),eo(this,"abort"),tO(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),tO(this,!0)),tx.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?tR(this):this.bb())},n.bb=function(){tR(this)},n.isActive=function(){return!!this.g},n.Z=function(){try{return 2<tP(this)?this.g.status:-1}catch(e){return -1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},n.Oa=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),eg(t)}},n.Ba=function(){return this.m},n.Ka=function(){return"string"==typeof this.l?this.l:String(this.l)},(n=tB.prototype).la=8,n.G=1,n.connect=function(e,t,n,r){eD(0),this.W=e,this.H=t||{},n&&void 0!==r&&(this.H.OSID=n,this.H.OAID=r),this.F=this.X,this.I=t2(this,null,this.W),tq(this)},n.Ga=function(e){if(this.s)if(this.s=null,1==this.G){if(!e){this.U=Math.floor(1e5*Math.random()),e=this.U++;let i=new eF(this,this.j,e),s=this.o;if(this.S&&(s?N(s=D(s),this.S):s=this.S),null!==this.m||this.O||(i.H=s,s=null),this.P)e:{for(var t=0,n=0;n<this.i.length;n++){t:{var r=this.i[n];if("__data__"in r.map&&"string"==typeof(r=r.map.__data__)){r=r.length;break t}r=void 0}if(void 0===r)break;if(4096<(t+=r)){t=n;break e}if(4096===t||n===this.i.length-1){t=n+1;break e}}t=1e3}else t=1e3;t=tH(this,i,t),tr(n=e9(this.I),"RID",e),tr(n,"CVER",22),this.D&&tr(n,"X-HTTP-Session-Id",this.D),tW(this,n),s&&(this.O?t="headers="+encodeURIComponent(String(tC(s)))+"&"+t:this.m&&tA(n,this.m,s)),e6(this.h,i),this.Ua&&tr(n,"TYPE","init"),this.P?(tr(n,"$req",t),tr(n,"SID","null"),i.T=!0,ej(i,n,null)):ej(i,n,t),this.G=2}}else 3==this.G&&(e?tz(this,e):0==this.i.length||eJ(this.h)||tz(this))},n.Fa=function(){if(this.u=null,tX(this),this.ba&&!(this.M||null==this.g||0>=this.R)){var e=2*this.R;this.j.info("BP detection timer enabled: "+e),this.A=eN(w(this.ab,this),e)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,eD(10),tj(this),tX(this))},n.Za=function(){null!=this.C&&(this.C=null,tj(this),tK(this),eD(19))},n.fb=function(e){e?(this.j.info("Successfully pinged google.com"),eD(2)):(this.j.info("Failed to ping google.com"),eD(1))},n.isActive=function(){return!!this.l&&this.l.isActive(this)},(n=t3.prototype).ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){},t5.prototype.g=function(e,t){return new t4(e,t)},E(t4,ea),t4.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},t4.prototype.close=function(){tU(this.g)},t4.prototype.o=function(e){var t=this.g;if("string"==typeof e){var n={};n.__data__=e,e=n}else this.u&&((n={}).__data__=ep(e),e=n);t.i.push(new eX(t.Ya++,e)),3==t.G&&tq(t)},t4.prototype.N=function(){this.g.l=null,delete this.j,tU(this.g),delete this.g,t4.aa.N.call(this)},E(t8,eE),E(t7,eT),E(t9,t3),t9.prototype.ua=function(){eo(this.g,"a")},t9.prototype.ta=function(e){eo(this.g,new t8(e))},t9.prototype.sa=function(e){eo(this.g,new t7)},t9.prototype.ra=function(){eo(this.g,"b")},t5.prototype.createWebChannel=t5.prototype.g,t4.prototype.send=t4.prototype.o,t4.prototype.open=t4.prototype.m,t4.prototype.close=t4.prototype.close,y=e0.createWebChannelTransport=function(){return new t5},m=e0.getStatEventTarget=function(){return eS()},g=e0.Event=e_,p=e0.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},eO.NO_ERROR=0,eO.TIMEOUT=8,eO.HTTP_ERROR=6,f=e0.ErrorCode=eO,eM.COMPLETE="complete",d=e0.EventType=eM,ew.EventType=eb,eb.OPEN="a",eb.CLOSE="b",eb.ERROR="c",eb.MESSAGE="d",ea.prototype.listen=ea.prototype.K,c=e0.WebChannel=ew,e0.FetchXmlHttpFactory=tE,tx.prototype.listenOnce=tx.prototype.L,tx.prototype.getLastError=tx.prototype.Ka,tx.prototype.getLastErrorCode=tx.prototype.Ba,tx.prototype.getStatus=tx.prototype.Z,tx.prototype.getResponseJson=tx.prototype.Oa,tx.prototype.getResponseText=tx.prototype.oa,tx.prototype.send=tx.prototype.ea,tx.prototype.setWithCredentials=tx.prototype.Ha,h=e0.XhrIo=tx}).apply(void 0!==eZ?eZ:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{}),v=function(e){for(var t,n=e.length,r=n%3,i=[],s=0,a=n-r;s<a;s+=16383)i.push(function(e,t,n){for(var r,i=[],s=t;s<n;s+=3)r=(e[s]<<16&0xff0000)+(e[s+1]<<8&65280)+(255&e[s+2]),i.push(e1[r>>18&63]+e1[r>>12&63]+e1[r>>6&63]+e1[63&r]);return i.join("")}(e,s,s+16383>a?a:s+16383));return 1===r?i.push(e1[(t=e[n-1])>>2]+e1[t<<4&63]+"=="):2===r&&i.push(e1[(t=(e[n-2]<<8)+e[n-1])>>10]+e1[t>>4&63]+e1[t<<2&63]+"="),i.join("")};for(var e1=[],e2=[],e6="undefined"!=typeof Uint8Array?Uint8Array:Array,e3="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",e5=0,e4=e3.length;e5<e4;++e5)e1[e5]=e3[e5],e2[e3.charCodeAt(e5)]=e5;e2[45]=62,e2[95]=63,w=function(e,t,n,r,i){var s,a,o=8*i-r-1,l=(1<<o)-1,u=l>>1,h=-7,c=n?i-1:0,d=n?-1:1,f=e[t+c];for(c+=d,s=f&(1<<-h)-1,f>>=-h,h+=o;h>0;s=256*s+e[t+c],c+=d,h-=8);for(a=s&(1<<-h)-1,s>>=-h,h+=r;h>0;a=256*a+e[t+c],c+=d,h-=8);if(0===s)s=1-u;else{if(s===l)return a?NaN:1/0*(f?-1:1);a+=Math.pow(2,r),s-=u}return(f?-1:1)*a*Math.pow(2,s-r)},b=function(e,t,n,r,i,s){var a,o,l,u=8*s-i-1,h=(1<<u)-1,c=h>>1,d=5960464477539062e-23*(23===i),f=r?0:s-1,p=r?1:-1,g=+(t<0||0===t&&1/t<0);for(isNaN(t=Math.abs(t))||t===1/0?(o=+!!isNaN(t),a=h):(a=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-a))<1&&(a--,l*=2),a+c>=1?t+=d/l:t+=d*Math.pow(2,1-c),t*l>=2&&(a++,l/=2),a+c>=h?(o=0,a=h):a+c>=1?(o=(t*l-1)*Math.pow(2,i),a+=c):(o=t*Math.pow(2,c-1)*Math.pow(2,i),a=0));i>=8;e[n+f]=255&o,f+=p,o/=256,i-=8);for(a=a<<i|o,u+=i;u>0;e[n+f]=255&a,f+=p,a/=256,u-=8);e[n+f-p]|=128*g};const e8="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;function e7(e){if(e>0x7fffffff)throw RangeError('The value "'+e+'" is invalid for option "size"');let t=new Uint8Array(e);return Object.setPrototypeOf(t,e9.prototype),t}function e9(e,t,n){if("number"==typeof e){if("string"==typeof t)throw TypeError('The "string" argument must be of type string. Received type number');return tn(e)}return te(e,t,n)}function te(e,t,n){if("string"==typeof e){var r=e,i=t;if(("string"!=typeof i||""===i)&&(i="utf8"),!e9.isEncoding(i))throw TypeError("Unknown encoding: "+i);let n=0|ta(r,i),s=e7(n),a=s.write(r,i);return a!==n&&(s=s.slice(0,a)),s}if(ArrayBuffer.isView(e)){var s=e;if(tD(s,Uint8Array)){let e=new Uint8Array(s);return ti(e.buffer,e.byteOffset,e.byteLength)}return tr(s)}if(null==e)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(tD(e,ArrayBuffer)||e&&tD(e.buffer,ArrayBuffer)||"undefined"!=typeof SharedArrayBuffer&&(tD(e,SharedArrayBuffer)||e&&tD(e.buffer,SharedArrayBuffer)))return ti(e,t,n);if("number"==typeof e)throw TypeError('The "value" argument must not be of type number. Received type number');let a=e.valueOf&&e.valueOf();if(null!=a&&a!==e)return e9.from(a,t,n);let o=function(e){if(e9.isBuffer(e)){let t=0|ts(e.length),n=e7(t);return 0===n.length||e.copy(n,0,0,t),n}return void 0!==e.length?"number"!=typeof e.length||function(e){return e!=e}(e.length)?e7(0):tr(e):"Buffer"===e.type&&Array.isArray(e.data)?tr(e.data):void 0}(e);if(o)return o;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return e9.from(e[Symbol.toPrimitive]("string"),t,n);throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function tt(e){if("number"!=typeof e)throw TypeError('"size" argument must be of type number');if(e<0)throw RangeError('The value "'+e+'" is invalid for option "size"')}function tn(e){return tt(e),e7(e<0?0:0|ts(e))}function tr(e){let t=e.length<0?0:0|ts(e.length),n=e7(t);for(let r=0;r<t;r+=1)n[r]=255&e[r];return n}function ti(e,t,n){let r;if(t<0||e.byteLength<t)throw RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(n||0))throw RangeError('"length" is outside of buffer bounds');return Object.setPrototypeOf(r=void 0===t&&void 0===n?new Uint8Array(e):void 0===n?new Uint8Array(e,t):new Uint8Array(e,t,n),e9.prototype),r}function ts(e){if(e>=0x7fffffff)throw RangeError("Attempt to allocate Buffer larger than maximum size: 0x7fffffff bytes");return 0|e}function ta(e,t){if(e9.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||tD(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);let n=e.length,r=arguments.length>2&&!0===arguments[2];if(!r&&0===n)return 0;let i=!1;for(;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":return tC(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return tA(e).length;default:if(i)return r?-1:tC(e).length;t=(""+t).toLowerCase(),i=!0}}function to(e,t,n){let r=!1;if((void 0===t||t<0)&&(t=0),t>this.length||((void 0===n||n>this.length)&&(n=this.length),n<=0||(n>>>=0)<=(t>>>=0)))return"";for(e||(e="utf8");;)switch(e){case"hex":return function(e,t,n){let r=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>r)&&(n=r);let i="";for(let r=t;r<n;++r)i+=tk[e[r]];return i}(this,t,n);case"utf8":case"utf-8":return tc(this,t,n);case"ascii":return function(e,t,n){let r="";n=Math.min(e.length,n);for(let i=t;i<n;++i)r+=String.fromCharCode(127&e[i]);return r}(this,t,n);case"latin1":case"binary":return function(e,t,n){let r="";n=Math.min(e.length,n);for(let i=t;i<n;++i)r+=String.fromCharCode(e[i]);return r}(this,t,n);case"base64":var i,s,a;return i=this,s=t,a=n,0===s&&a===i.length?v(i):v(i.slice(s,a));case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return function(e,t,n){let r=e.slice(t,n),i="";for(let e=0;e<r.length-1;e+=2)i+=String.fromCharCode(r[e]+256*r[e+1]);return i}(this,t,n);default:if(r)throw TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),r=!0}}function tl(e,t,n){let r=e[t];e[t]=e[n],e[n]=r}function tu(e,t,n,r,i){var s;if(0===e.length)return -1;if("string"==typeof n?(r=n,n=0):n>0x7fffffff?n=0x7fffffff:n<-0x80000000&&(n=-0x80000000),(s=n*=1)!=s&&(n=i?0:e.length-1),n<0&&(n=e.length+n),n>=e.length)if(i)return -1;else n=e.length-1;else if(n<0)if(!i)return -1;else n=0;if("string"==typeof t&&(t=e9.from(t,r)),e9.isBuffer(t))return 0===t.length?-1:th(e,t,n,r,i);if("number"==typeof t){if(t&=255,"function"==typeof Uint8Array.prototype.indexOf)if(i)return Uint8Array.prototype.indexOf.call(e,t,n);else return Uint8Array.prototype.lastIndexOf.call(e,t,n);return th(e,[t],n,r,i)}throw TypeError("val must be string, number or Buffer")}function th(e,t,n,r,i){let s,a=1,o=e.length,l=t.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return -1;a=2,o/=2,l/=2,n/=2}function u(e,t){return 1===a?e[t]:e.readUInt16BE(t*a)}if(i){let r=-1;for(s=n;s<o;s++)if(u(e,s)===u(t,-1===r?0:s-r)){if(-1===r&&(r=s),s-r+1===l)return r*a}else -1!==r&&(s-=s-r),r=-1}else for(n+l>o&&(n=o-l),s=n;s>=0;s--){let n=!0;for(let r=0;r<l;r++)if(u(e,s+r)!==u(t,r)){n=!1;break}if(n)return s}return -1}function tc(e,t,n){n=Math.min(e.length,n);let r=[],i=t;for(;i<n;){let t=e[i],s=null,a=t>239?4:t>223?3:t>191?2:1;if(i+a<=n){let n,r,o,l;switch(a){case 1:t<128&&(s=t);break;case 2:(192&(n=e[i+1]))==128&&(l=(31&t)<<6|63&n)>127&&(s=l);break;case 3:n=e[i+1],r=e[i+2],(192&n)==128&&(192&r)==128&&(l=(15&t)<<12|(63&n)<<6|63&r)>2047&&(l<55296||l>57343)&&(s=l);break;case 4:n=e[i+1],r=e[i+2],o=e[i+3],(192&n)==128&&(192&r)==128&&(192&o)==128&&(l=(15&t)<<18|(63&n)<<12|(63&r)<<6|63&o)>65535&&l<1114112&&(s=l)}}null===s?(s=65533,a=1):s>65535&&(s-=65536,r.push(s>>>10&1023|55296),s=56320|1023&s),r.push(s),i+=a}var s=r;let a=s.length;if(a<=4096)return String.fromCharCode.apply(String,s);let o="",l=0;for(;l<a;)o+=String.fromCharCode.apply(String,s.slice(l,l+=4096));return o}function td(e,t,n){if(e%1!=0||e<0)throw RangeError("offset is not uint");if(e+t>n)throw RangeError("Trying to access beyond buffer length")}function tf(e,t,n,r,i,s){if(!e9.isBuffer(e))throw TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<s)throw RangeError('"value" argument is out of bounds');if(n+r>e.length)throw RangeError("Index out of range")}function tp(e,t,n,r,i){tT(t,r,i,e,n,7);let s=Number(t&BigInt(0xffffffff));e[n++]=s,s>>=8,e[n++]=s,s>>=8,e[n++]=s,s>>=8,e[n++]=s;let a=Number(t>>BigInt(32)&BigInt(0xffffffff));return e[n++]=a,a>>=8,e[n++]=a,a>>=8,e[n++]=a,a>>=8,e[n++]=a,n}function tg(e,t,n,r,i){tT(t,r,i,e,n,7);let s=Number(t&BigInt(0xffffffff));e[n+7]=s,s>>=8,e[n+6]=s,s>>=8,e[n+5]=s,s>>=8,e[n+4]=s;let a=Number(t>>BigInt(32)&BigInt(0xffffffff));return e[n+3]=a,a>>=8,e[n+2]=a,a>>=8,e[n+1]=a,a>>=8,e[n]=a,n+8}function tm(e,t,n,r,i,s){if(n+r>e.length||n<0)throw RangeError("Index out of range")}function ty(e,t,n,r,i){return t*=1,n>>>=0,i||tm(e,t,n,4,34028234663852886e22,-34028234663852886e22),b(e,t,n,r,23,4),n+4}function tv(e,t,n,r,i){return t*=1,n>>>=0,i||tm(e,t,n,8,17976931348623157e292,-17976931348623157e292),b(e,t,n,r,52,8),n+8}e9.TYPED_ARRAY_SUPPORT=function(){try{let e=new Uint8Array(1),t={foo:function(){return 42}};return Object.setPrototypeOf(t,Uint8Array.prototype),Object.setPrototypeOf(e,t),42===e.foo()}catch(e){return!1}}(),e9.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(e9.prototype,"parent",{enumerable:!0,get:function(){if(e9.isBuffer(this))return this.buffer}}),Object.defineProperty(e9.prototype,"offset",{enumerable:!0,get:function(){if(e9.isBuffer(this))return this.byteOffset}}),e9.poolSize=8192,e9.from=function(e,t,n){return te(e,t,n)},Object.setPrototypeOf(e9.prototype,Uint8Array.prototype),Object.setPrototypeOf(e9,Uint8Array),e9.alloc=function(e,t,n){return(tt(e),e<=0)?e7(e):void 0!==t?"string"==typeof n?e7(e).fill(t,n):e7(e).fill(t):e7(e)},e9.allocUnsafe=function(e){return tn(e)},e9.allocUnsafeSlow=function(e){return tn(e)},e9.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==e9.prototype},e9.compare=function(e,t){if(tD(e,Uint8Array)&&(e=e9.from(e,e.offset,e.byteLength)),tD(t,Uint8Array)&&(t=e9.from(t,t.offset,t.byteLength)),!e9.isBuffer(e)||!e9.isBuffer(t))throw TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;let n=e.length,r=t.length;for(let i=0,s=Math.min(n,r);i<s;++i)if(e[i]!==t[i]){n=e[i],r=t[i];break}return n<r?-1:+(r<n)},e9.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},e9.concat=function(e,t){let n;if(!Array.isArray(e))throw TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return e9.alloc(0);if(void 0===t)for(n=0,t=0;n<e.length;++n)t+=e[n].length;let r=e9.allocUnsafe(t),i=0;for(n=0;n<e.length;++n){let t=e[n];if(tD(t,Uint8Array))i+t.length>r.length?(e9.isBuffer(t)||(t=e9.from(t)),t.copy(r,i)):Uint8Array.prototype.set.call(r,t,i);else if(e9.isBuffer(t))t.copy(r,i);else throw TypeError('"list" argument must be an Array of Buffers');i+=t.length}return r},e9.byteLength=ta,e9.prototype._isBuffer=!0,e9.prototype.swap16=function(){let e=this.length;if(e%2!=0)throw RangeError("Buffer size must be a multiple of 16-bits");for(let t=0;t<e;t+=2)tl(this,t,t+1);return this},e9.prototype.swap32=function(){let e=this.length;if(e%4!=0)throw RangeError("Buffer size must be a multiple of 32-bits");for(let t=0;t<e;t+=4)tl(this,t,t+3),tl(this,t+1,t+2);return this},e9.prototype.swap64=function(){let e=this.length;if(e%8!=0)throw RangeError("Buffer size must be a multiple of 64-bits");for(let t=0;t<e;t+=8)tl(this,t,t+7),tl(this,t+1,t+6),tl(this,t+2,t+5),tl(this,t+3,t+4);return this},e9.prototype.toString=function(){let e=this.length;return 0===e?"":0==arguments.length?tc(this,0,e):to.apply(this,arguments)},e9.prototype.toLocaleString=e9.prototype.toString,e9.prototype.equals=function(e){if(!e9.isBuffer(e))throw TypeError("Argument must be a Buffer");return this===e||0===e9.compare(this,e)},e9.prototype.inspect=function(){let e="";return e=this.toString("hex",0,50).replace(/(.{2})/g,"$1 ").trim(),this.length>50&&(e+=" ... "),"<Buffer "+e+">"},e8&&(e9.prototype[e8]=e9.prototype.inspect),e9.prototype.compare=function(e,t,n,r,i){if(tD(e,Uint8Array)&&(e=e9.from(e,e.offset,e.byteLength)),!e9.isBuffer(e))throw TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===r&&(r=0),void 0===i&&(i=this.length),t<0||n>e.length||r<0||i>this.length)throw RangeError("out of range index");if(r>=i&&t>=n)return 0;if(r>=i)return -1;if(t>=n)return 1;if(t>>>=0,n>>>=0,r>>>=0,i>>>=0,this===e)return 0;let s=i-r,a=n-t,o=Math.min(s,a),l=this.slice(r,i),u=e.slice(t,n);for(let e=0;e<o;++e)if(l[e]!==u[e]){s=l[e],a=u[e];break}return s<a?-1:+(a<s)},e9.prototype.includes=function(e,t,n){return -1!==this.indexOf(e,t,n)},e9.prototype.indexOf=function(e,t,n){return tu(this,e,t,n,!0)},e9.prototype.lastIndexOf=function(e,t,n){return tu(this,e,t,n,!1)},e9.prototype.write=function(e,t,n,r){var i,s,a,o,l,u,h,c;if(void 0===t)r="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)r=t,n=this.length,t=0;else if(isFinite(t))t>>>=0,isFinite(n)?(n>>>=0,void 0===r&&(r="utf8")):(r=n,n=void 0);else throw Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");let d=this.length-t;if((void 0===n||n>d)&&(n=d),e.length>0&&(n<0||t<0)||t>this.length)throw RangeError("Attempt to write outside buffer bounds");r||(r="utf8");let f=!1;for(;;)switch(r){case"hex":return function(e,t,n,r){let i;n=Number(n)||0;let s=e.length-n;r?(r=Number(r))>s&&(r=s):r=s;let a=t.length;for(r>a/2&&(r=a/2),i=0;i<r;++i){var o;let r=parseInt(t.substr(2*i,2),16);if((o=r)!=o)break;e[n+i]=r}return i}(this,e,t,n);case"utf8":case"utf-8":return i=t,s=n,tx(tC(e,this.length-i),this,i,s);case"ascii":case"latin1":case"binary":return a=t,o=n,tx(function(e){let t=[];for(let n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(e),this,a,o);case"base64":return l=t,u=n,tx(tA(e),this,l,u);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return h=t,c=n,tx(function(e,t){let n,r,i=[];for(let s=0;s<e.length&&!((t-=2)<0);++s)r=(n=e.charCodeAt(s))>>8,i.push(n%256),i.push(r);return i}(e,this.length-h),this,h,c);default:if(f)throw TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),f=!0}},e9.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},e9.prototype.slice=function(e,t){let n=this.length;e=~~e,t=void 0===t?n:~~t,e<0?(e+=n)<0&&(e=0):e>n&&(e=n),t<0?(t+=n)<0&&(t=0):t>n&&(t=n),t<e&&(t=e);let r=this.subarray(e,t);return Object.setPrototypeOf(r,e9.prototype),r},e9.prototype.readUintLE=e9.prototype.readUIntLE=function(e,t,n){e>>>=0,t>>>=0,n||td(e,t,this.length);let r=this[e],i=1,s=0;for(;++s<t&&(i*=256);)r+=this[e+s]*i;return r},e9.prototype.readUintBE=e9.prototype.readUIntBE=function(e,t,n){e>>>=0,t>>>=0,n||td(e,t,this.length);let r=this[e+--t],i=1;for(;t>0&&(i*=256);)r+=this[e+--t]*i;return r},e9.prototype.readUint8=e9.prototype.readUInt8=function(e,t){return e>>>=0,t||td(e,1,this.length),this[e]},e9.prototype.readUint16LE=e9.prototype.readUInt16LE=function(e,t){return e>>>=0,t||td(e,2,this.length),this[e]|this[e+1]<<8},e9.prototype.readUint16BE=e9.prototype.readUInt16BE=function(e,t){return e>>>=0,t||td(e,2,this.length),this[e]<<8|this[e+1]},e9.prototype.readUint32LE=e9.prototype.readUInt32LE=function(e,t){return e>>>=0,t||td(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+0x1000000*this[e+3]},e9.prototype.readUint32BE=e9.prototype.readUInt32BE=function(e,t){return e>>>=0,t||td(e,4,this.length),0x1000000*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},e9.prototype.readBigUInt64LE=tN(function(e){t_(e>>>=0,"offset");let t=this[e],n=this[e+7];(void 0===t||void 0===n)&&tI(e,this.length-8);let r=t+256*this[++e]+65536*this[++e]+0x1000000*this[++e],i=this[++e]+256*this[++e]+65536*this[++e]+0x1000000*n;return BigInt(r)+(BigInt(i)<<BigInt(32))}),e9.prototype.readBigUInt64BE=tN(function(e){t_(e>>>=0,"offset");let t=this[e],n=this[e+7];(void 0===t||void 0===n)&&tI(e,this.length-8);let r=0x1000000*t+65536*this[++e]+256*this[++e]+this[++e],i=0x1000000*this[++e]+65536*this[++e]+256*this[++e]+n;return(BigInt(r)<<BigInt(32))+BigInt(i)}),e9.prototype.readIntLE=function(e,t,n){e>>>=0,t>>>=0,n||td(e,t,this.length);let r=this[e],i=1,s=0;for(;++s<t&&(i*=256);)r+=this[e+s]*i;return r>=(i*=128)&&(r-=Math.pow(2,8*t)),r},e9.prototype.readIntBE=function(e,t,n){e>>>=0,t>>>=0,n||td(e,t,this.length);let r=t,i=1,s=this[e+--r];for(;r>0&&(i*=256);)s+=this[e+--r]*i;return s>=(i*=128)&&(s-=Math.pow(2,8*t)),s},e9.prototype.readInt8=function(e,t){return(e>>>=0,t||td(e,1,this.length),128&this[e])?-((255-this[e]+1)*1):this[e]},e9.prototype.readInt16LE=function(e,t){e>>>=0,t||td(e,2,this.length);let n=this[e]|this[e+1]<<8;return 32768&n?0xffff0000|n:n},e9.prototype.readInt16BE=function(e,t){e>>>=0,t||td(e,2,this.length);let n=this[e+1]|this[e]<<8;return 32768&n?0xffff0000|n:n},e9.prototype.readInt32LE=function(e,t){return e>>>=0,t||td(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},e9.prototype.readInt32BE=function(e,t){return e>>>=0,t||td(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},e9.prototype.readBigInt64LE=tN(function(e){t_(e>>>=0,"offset");let t=this[e],n=this[e+7];return(void 0===t||void 0===n)&&tI(e,this.length-8),(BigInt(this[e+4]+256*this[e+5]+65536*this[e+6]+(n<<24))<<BigInt(32))+BigInt(t+256*this[++e]+65536*this[++e]+0x1000000*this[++e])}),e9.prototype.readBigInt64BE=tN(function(e){t_(e>>>=0,"offset");let t=this[e],n=this[e+7];return(void 0===t||void 0===n)&&tI(e,this.length-8),(BigInt((t<<24)+65536*this[++e]+256*this[++e]+this[++e])<<BigInt(32))+BigInt(0x1000000*this[++e]+65536*this[++e]+256*this[++e]+n)}),e9.prototype.readFloatLE=function(e,t){return e>>>=0,t||td(e,4,this.length),w(this,e,!0,23,4)},e9.prototype.readFloatBE=function(e,t){return e>>>=0,t||td(e,4,this.length),w(this,e,!1,23,4)},e9.prototype.readDoubleLE=function(e,t){return e>>>=0,t||td(e,8,this.length),w(this,e,!0,52,8)},e9.prototype.readDoubleBE=function(e,t){return e>>>=0,t||td(e,8,this.length),w(this,e,!1,52,8)},e9.prototype.writeUintLE=e9.prototype.writeUIntLE=function(e,t,n,r){if(e*=1,t>>>=0,n>>>=0,!r){let r=Math.pow(2,8*n)-1;tf(this,e,t,n,r,0)}let i=1,s=0;for(this[t]=255&e;++s<n&&(i*=256);)this[t+s]=e/i&255;return t+n},e9.prototype.writeUintBE=e9.prototype.writeUIntBE=function(e,t,n,r){if(e*=1,t>>>=0,n>>>=0,!r){let r=Math.pow(2,8*n)-1;tf(this,e,t,n,r,0)}let i=n-1,s=1;for(this[t+i]=255&e;--i>=0&&(s*=256);)this[t+i]=e/s&255;return t+n},e9.prototype.writeUint8=e9.prototype.writeUInt8=function(e,t,n){return e*=1,t>>>=0,n||tf(this,e,t,1,255,0),this[t]=255&e,t+1},e9.prototype.writeUint16LE=e9.prototype.writeUInt16LE=function(e,t,n){return e*=1,t>>>=0,n||tf(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},e9.prototype.writeUint16BE=e9.prototype.writeUInt16BE=function(e,t,n){return e*=1,t>>>=0,n||tf(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},e9.prototype.writeUint32LE=e9.prototype.writeUInt32LE=function(e,t,n){return e*=1,t>>>=0,n||tf(this,e,t,4,0xffffffff,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},e9.prototype.writeUint32BE=e9.prototype.writeUInt32BE=function(e,t,n){return e*=1,t>>>=0,n||tf(this,e,t,4,0xffffffff,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},e9.prototype.writeBigUInt64LE=tN(function(e,t=0){return tp(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))}),e9.prototype.writeBigUInt64BE=tN(function(e,t=0){return tg(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))}),e9.prototype.writeIntLE=function(e,t,n,r){if(e*=1,t>>>=0,!r){let r=Math.pow(2,8*n-1);tf(this,e,t,n,r-1,-r)}let i=0,s=1,a=0;for(this[t]=255&e;++i<n&&(s*=256);)e<0&&0===a&&0!==this[t+i-1]&&(a=1),this[t+i]=(e/s|0)-a&255;return t+n},e9.prototype.writeIntBE=function(e,t,n,r){if(e*=1,t>>>=0,!r){let r=Math.pow(2,8*n-1);tf(this,e,t,n,r-1,-r)}let i=n-1,s=1,a=0;for(this[t+i]=255&e;--i>=0&&(s*=256);)e<0&&0===a&&0!==this[t+i+1]&&(a=1),this[t+i]=(e/s|0)-a&255;return t+n},e9.prototype.writeInt8=function(e,t,n){return e*=1,t>>>=0,n||tf(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},e9.prototype.writeInt16LE=function(e,t,n){return e*=1,t>>>=0,n||tf(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},e9.prototype.writeInt16BE=function(e,t,n){return e*=1,t>>>=0,n||tf(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},e9.prototype.writeInt32LE=function(e,t,n){return e*=1,t>>>=0,n||tf(this,e,t,4,0x7fffffff,-0x80000000),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},e9.prototype.writeInt32BE=function(e,t,n){return e*=1,t>>>=0,n||tf(this,e,t,4,0x7fffffff,-0x80000000),e<0&&(e=0xffffffff+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},e9.prototype.writeBigInt64LE=tN(function(e,t=0){return tp(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),e9.prototype.writeBigInt64BE=tN(function(e,t=0){return tg(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),e9.prototype.writeFloatLE=function(e,t,n){return ty(this,e,t,!0,n)},e9.prototype.writeFloatBE=function(e,t,n){return ty(this,e,t,!1,n)},e9.prototype.writeDoubleLE=function(e,t,n){return tv(this,e,t,!0,n)},e9.prototype.writeDoubleBE=function(e,t,n){return tv(this,e,t,!1,n)},e9.prototype.copy=function(e,t,n,r){if(!e9.isBuffer(e))throw TypeError("argument should be a Buffer");if(n||(n=0),r||0===r||(r=this.length),t>=e.length&&(t=e.length),t||(t=0),r>0&&r<n&&(r=n),r===n||0===e.length||0===this.length)return 0;if(t<0)throw RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw RangeError("Index out of range");if(r<0)throw RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),e.length-t<r-n&&(r=e.length-t+n);let i=r-n;return this===e&&"function"==typeof Uint8Array.prototype.copyWithin?this.copyWithin(t,n,r):Uint8Array.prototype.set.call(e,this.subarray(n,r),t),i},e9.prototype.fill=function(e,t,n,r){let i;if("string"==typeof e){if("string"==typeof t?(r=t,t=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),void 0!==r&&"string"!=typeof r)throw TypeError("encoding must be a string");if("string"==typeof r&&!e9.isEncoding(r))throw TypeError("Unknown encoding: "+r);if(1===e.length){let t=e.charCodeAt(0);("utf8"===r&&t<128||"latin1"===r)&&(e=t)}}else"number"==typeof e?e&=255:"boolean"==typeof e&&(e=Number(e));if(t<0||this.length<t||this.length<n)throw RangeError("Out of range index");if(n<=t)return this;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(i=t;i<n;++i)this[i]=e;else{let s=e9.isBuffer(e)?e:e9.from(e,r),a=s.length;if(0===a)throw TypeError('The value "'+e+'" is invalid for argument "value"');for(i=0;i<n-t;++i)this[i+t]=s[i%a]}return this};const tw={};function tb(e,t,n){tw[e]=class extends n{constructor(){super(),Object.defineProperty(this,"message",{value:t.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${e}]`,this.stack,delete this.name}get code(){return e}set code(e){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:e,writable:!0})}toString(){return`${this.name} [${e}]: ${this.message}`}}}function tE(e){let t="",n=e.length,r=+("-"===e[0]);for(;n>=r+4;n-=3)t=`_${e.slice(n-3,n)}${t}`;return`${e.slice(0,n)}${t}`}function tT(e,t,n,r,i,s){if(e>n||e<t){let r,i="bigint"==typeof t?"n":"";throw r=s>3?0===t||t===BigInt(0)?`>= 0${i} and < 2${i} ** ${(s+1)*8}${i}`:`>= -(2${i} ** ${(s+1)*8-1}${i}) and < 2 ** ${(s+1)*8-1}${i}`:`>= ${t}${i} and <= ${n}${i}`,new tw.ERR_OUT_OF_RANGE("value",r,e)}t_(i,"offset"),(void 0===r[i]||void 0===r[i+s])&&tI(i,r.length-(s+1))}function t_(e,t){if("number"!=typeof e)throw new tw.ERR_INVALID_ARG_TYPE(t,"number",e)}function tI(e,t,n){if(Math.floor(e)!==e)throw t_(e,n),new tw.ERR_OUT_OF_RANGE(n||"offset","an integer",e);if(t<0)throw new tw.ERR_BUFFER_OUT_OF_BOUNDS;throw new tw.ERR_OUT_OF_RANGE(n||"offset",`>= ${+!!n} and <= ${t}`,e)}tb("ERR_BUFFER_OUT_OF_BOUNDS",function(e){return e?`${e} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),tb("ERR_INVALID_ARG_TYPE",function(e,t){return`The "${e}" argument must be of type number. Received type ${typeof t}`},TypeError),tb("ERR_OUT_OF_RANGE",function(e,t,n){let r=`The value of "${e}" is out of range.`,i=n;return Number.isInteger(n)&&Math.abs(n)>0x100000000?i=tE(String(n)):"bigint"==typeof n&&(i=String(n),(n>BigInt(2)**BigInt(32)||n<-(BigInt(2)**BigInt(32)))&&(i=tE(i)),i+="n"),r+=` It must be ${t}. Received ${i}`},RangeError);const tS=/[^+/0-9A-Za-z-_]/g;function tC(e,t){let n;t=t||1/0;let r=e.length,i=null,s=[];for(let a=0;a<r;++a){if((n=e.charCodeAt(a))>55295&&n<57344){if(!i){if(n>56319||a+1===r){(t-=3)>-1&&s.push(239,191,189);continue}i=n;continue}if(n<56320){(t-=3)>-1&&s.push(239,191,189),i=n;continue}n=(i-55296<<10|n-56320)+65536}else i&&(t-=3)>-1&&s.push(239,191,189);if(i=null,n<128){if((t-=1)<0)break;s.push(n)}else if(n<2048){if((t-=2)<0)break;s.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;s.push(n>>12|224,n>>6&63|128,63&n|128)}else if(n<1114112){if((t-=4)<0)break;s.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}else throw Error("Invalid code point")}return s}function tA(e){return function(e){var t,n,r=function(e){var t=e.length;if(t%4>0)throw Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");-1===n&&(n=t);var r=n===t?0:4-n%4;return[n,r]}(e),i=r[0],s=r[1],a=new e6((i+s)*3/4-s),o=0,l=s>0?i-4:i;for(n=0;n<l;n+=4)t=e2[e.charCodeAt(n)]<<18|e2[e.charCodeAt(n+1)]<<12|e2[e.charCodeAt(n+2)]<<6|e2[e.charCodeAt(n+3)],a[o++]=t>>16&255,a[o++]=t>>8&255,a[o++]=255&t;return 2===s&&(t=e2[e.charCodeAt(n)]<<2|e2[e.charCodeAt(n+1)]>>4,a[o++]=255&t),1===s&&(t=e2[e.charCodeAt(n)]<<10|e2[e.charCodeAt(n+1)]<<4|e2[e.charCodeAt(n+2)]>>2,a[o++]=t>>8&255,a[o++]=255&t),a}(function(e){if((e=(e=e.split("=")[0]).trim().replace(tS,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function tx(e,t,n,r){let i;for(i=0;i<r&&!(i+n>=t.length)&&!(i>=e.length);++i)t[i+n]=e[i];return i}function tD(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}const tk=function(){let e="0123456789abcdef",t=Array(256);for(let n=0;n<16;++n){let r=16*n;for(let i=0;i<16;++i)t[r+i]=e[n]+e[i]}return t}();function tN(e){return"undefined"==typeof BigInt?tL:e}function tL(){throw Error("BigInt not supported")}const tR="@firebase/firestore",tO="4.8.0";class tM{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}tM.UNAUTHENTICATED=new tM(null),tM.GOOGLE_CREDENTIALS=new tM("google-credentials-uid"),tM.FIRST_PARTY=new tM("first-party-uid"),tM.MOCK_USER=new tM("mock-user");let tP="11.10.0";const tF=new ed("@firebase/firestore");function tV(){return tF.logLevel}function tB(e,...t){if(tF.logLevel<=o.DEBUG){let n=t.map(t$);tF.debug(`Firestore (${tP}): ${e}`,...n)}}function tU(e,...t){if(tF.logLevel<=o.ERROR){let n=t.map(t$);tF.error(`Firestore (${tP}): ${e}`,...n)}}function tj(e,...t){if(tF.logLevel<=o.WARN){let n=t.map(t$);tF.warn(`Firestore (${tP}): ${e}`,...n)}}function t$(e){if("string"==typeof e)return e;try{return JSON.stringify(e)}catch(t){return e}}function tq(e,t,n){let r="Unexpected state";"string"==typeof t?r=t:n=t,tz(e,r,n)}function tz(e,t,n){let r=`FIRESTORE (${tP}) INTERNAL ASSERTION FAILED: ${t} (ID: ${e.toString(16)})`;if(void 0!==n)try{r+=" CONTEXT: "+JSON.stringify(n)}catch(e){r+=" CONTEXT: "+n}throw tU(r),Error(r)}function tW(e,t,n,r){let i="Unexpected state";"string"==typeof n?i=n:r=n,e||tz(t,i,r)}const tH={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class tG extends Y{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class tK{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class tQ{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class tX{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(tM.UNAUTHENTICATED))}shutdown(){}}class tY{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class tJ{constructor(e){this.t=e,this.currentUser=tM.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){tW(void 0===this.o,42304);let n=this.i,r=e=>this.i!==n?(n=this.i,t(e)):Promise.resolve(),i=new tK;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new tK,e.enqueueRetryable(()=>r(this.currentUser))};let s=()=>{let t=i;e.enqueueRetryable(async()=>{await t.promise,await r(this.currentUser)})},a=e=>{tB("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.o&&(this.auth.addAuthTokenListener(this.o),s())};this.t.onInit(e=>a(e)),setTimeout(()=>{if(!this.auth){let e=this.t.getImmediate({optional:!0});e?a(e):(tB("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new tK)}},0),s()}getToken(){let e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(t=>this.i!==e?(tB("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(tW("string"==typeof t.accessToken,31837,{l:t}),new tQ(t.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){let e=this.auth&&this.auth.getUid();return tW(null===e||"string"==typeof e,2055,{h:e}),new tM(e)}}class tZ{constructor(e,t,n){this.P=e,this.T=t,this.I=n,this.type="FirstParty",this.user=tM.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);let e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class t0{constructor(e,t,n){this.P=e,this.T=t,this.I=n}getToken(){return Promise.resolve(new tZ(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable(()=>t(tM.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class t1{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class t2{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,null!=e&&void 0!==e.settings&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){tW(void 0===this.o,3512);let n=e=>{null!=e.error&&tB("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);let n=e.token!==this.m;return this.m=e.token,tB("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?t(e.token):Promise.resolve()};this.o=t=>{e.enqueueRetryable(()=>n(t))};let r=e=>{tB("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(e=>r(e)),setTimeout(()=>{if(!this.appCheck){let e=this.V.getImmediate({optional:!0});e?r(e):tB("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new t1(this.p));let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(e=>e?(tW("string"==typeof e.token,44558,{tokenResult:e}),this.m=e.token,new t1(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function t6(){return new TextEncoder}class t3{static newId(){let e=62*Math.floor(256/62),t="";for(;t.length<20;){let n=function(e){let t="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(40);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(let e=0;e<40;e++)n[e]=Math.floor(256*Math.random());return n}(40);for(let r=0;r<n.length;++r)t.length<20&&n[r]<e&&(t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(n[r]%62))}return t}}function t5(e,t){return e<t?-1:+(e>t)}function t4(e,t){let n=0;for(;n<e.length&&n<t.length;){let r=e.codePointAt(n),i=t.codePointAt(n);if(r!==i){if(r<128&&i<128)return t5(r,i);{let s=t6(),a=function(e,t){for(let n=0;n<e.length&&n<t.length;++n)if(e[n]!==t[n])return t5(e[n],t[n]);return t5(e.length,t.length)}(s.encode(t8(e,n)),s.encode(t8(t,n)));return 0!==a?a:t5(r,i)}}n+=r>65535?2:1}return t5(e.length,t.length)}function t8(e,t){return e.codePointAt(t)>65535?e.substring(t,t+2):e.substring(t,t+1)}function t7(e,t,n){return e.length===t.length&&e.every((e,r)=>n(e,t[r]))}const t9="__name__";class ne{constructor(e,t,n){void 0===t?t=0:t>e.length&&tq(637,{offset:t,range:e.length}),void 0===n?n=e.length-t:n>e.length-t&&tq(1746,{length:n,range:e.length-t}),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===ne.comparator(this,e)}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof ne?e.forEach(e=>{t.push(e)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let n=Math.min(e.length,t.length);for(let r=0;r<n;r++){let n=ne.compareSegments(e.get(r),t.get(r));if(0!==n)return n}return t5(e.length,t.length)}static compareSegments(e,t){let n=ne.isNumericId(e),r=ne.isNumericId(t);return n&&!r?-1:!n&&r?1:n&&r?ne.extractNumericId(e).compare(ne.extractNumericId(t)):t4(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return l.fromString(e.substring(4,e.length-2))}}class nt extends ne{construct(e,t,n){return new nt(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let n of e){if(n.indexOf("//")>=0)throw new tG(tH.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter(e=>e.length>0))}return new nt(t)}static emptyPath(){return new nt([])}}const nn=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class nr extends ne{construct(e,t,n){return new nr(e,t,n)}static isValidIdentifier(e){return nn.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),nr.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&this.get(0)===t9}static keyField(){return new nr([t9])}static fromServerFormat(e){let t=[],n="",r=0,i=()=>{if(0===n.length)throw new tG(tH.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""},s=!1;for(;r<e.length;){let t=e[r];if("\\"===t){if(r+1===e.length)throw new tG(tH.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let t=e[r+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new tG(tH.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,r+=2}else"`"===t?s=!s:"."!==t||s?n+=t:i(),r++}if(i(),s)throw new tG(tH.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new nr(t)}static emptyPath(){return new nr([])}}class ni{constructor(e){this.path=e}static fromPath(e){return new ni(nt.fromString(e))}static fromName(e){return new ni(nt.fromString(e).popFirst(5))}static empty(){return new ni(nt.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===nt.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return nt.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new ni(new nt(e.slice()))}}function ns(e,t,n){if(!n)throw new tG(tH.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function na(e){if(!ni.isDocumentKey(e))throw new tG(tH.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function no(e){if(ni.isDocumentKey(e))throw new tG(tH.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function nl(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}function nu(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{var t;let n=(t=e).constructor?t.constructor.name:null;return n?`a custom ${n} object`:"an object"}}return"function"==typeof e?"a function":tq(12329,{type:typeof e})}function nh(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new tG(tH.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let n=nu(e);throw new tG(tH.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${n}`)}}return e}function nc(e,t){let n={typeString:e};return t&&(n.value=t),n}function nd(e,t){let n;if(!nl(e))throw new tG(tH.INVALID_ARGUMENT,"JSON must be an object");for(let r in t)if(t[r]){let i=t[r].typeString,s="value"in t[r]?{value:t[r].value}:void 0;if(!(r in e)){n=`JSON missing required field: '${r}'`;break}let a=e[r];if(i&&typeof a!==i){n=`JSON field '${r}' must be a ${i}.`;break}if(void 0!==s&&a!==s.value){n=`Expected '${r}' field to equal '${s.value}'`;break}}if(n)throw new tG(tH.INVALID_ARGUMENT,n);return!0}class nf{static now(){return nf.fromMillis(Date.now())}static fromDate(e){return nf.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),n=Math.floor((e-1e3*t)*1e6);return new nf(t,n)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0||t>=1e9)throw new tG(tH.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-0xe7791f700||e>=0x3afff44180)throw new tG(tH.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?t5(this.nanoseconds,e.nanoseconds):t5(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:nf._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(nd(e,nf._jsonSchema))return new nf(e.seconds,e.nanoseconds)}valueOf(){return String(this.seconds- -0xe7791f700).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}nf._jsonSchemaVersion="firestore/timestamp/1.0",nf._jsonSchema={type:nc("string",nf._jsonSchemaVersion),seconds:nc("number"),nanoseconds:nc("number")};class np{static fromTimestamp(e){return new np(e)}static min(){return new np(new nf(0,0))}static max(){return new np(new nf(0x3afff4417f,0x3b9ac9ff))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class ng{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new ng(np.min(),ni.empty(),-1)}static max(){return new ng(np.max(),ni.empty(),-1)}}class nm{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}async function ny(e){if(e.code!==tH.FAILED_PRECONDITION||"The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab."!==e.message)throw e;tB("LocalStore","Unexpectedly lost primary lease")}class nv{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&tq(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new nv((n,r)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(n,r)},this.catchCallback=e=>{this.wrapFailure(t,e).next(n,r)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof nv?t:nv.resolve(t)}catch(e){return nv.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):nv.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):nv.reject(t)}static resolve(e){return new nv((t,n)=>{t(e)})}static reject(e){return new nv((t,n)=>{n(e)})}static waitFor(e){return new nv((t,n)=>{let r=0,i=0,s=!1;e.forEach(e=>{++r,e.next(()=>{++i,s&&i===r&&t()},e=>n(e))}),s=!0,i===r&&t()})}static or(e){let t=nv.resolve(!1);for(let n of e)t=t.next(e=>e?nv.resolve(e):n());return t}static forEach(e,t){let n=[];return e.forEach((e,r)=>{n.push(t.call(this,e,r))}),this.waitFor(n)}static mapArray(e,t){return new nv((n,r)=>{let i=e.length,s=Array(i),a=0;for(let o=0;o<i;o++){let l=o;t(e[l]).next(e=>{s[l]=e,++a===i&&n(s)},e=>r(e))}})}static doWhile(e,t){return new nv((n,r)=>{let i=()=>{!0===e()?t().next(()=>{i()},r):n()};i()})}}function nw(e){return"IndexedDbTransactionError"===e.name}class nb{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this._e(e),this.ae=e=>t.writeSequenceNumber(e))}_e(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){let e=++this.previousValue;return this.ae&&this.ae(e),e}}nb.ue=-1;function nE(e){return 0===e&&1/e==-1/0}function nT(e){let t=0;for(let n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function n_(e,t){for(let n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function nI(e){for(let t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class nS{constructor(e,t){this.comparator=e,this.root=t||nA.EMPTY}insert(e,t){return new nS(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,nA.BLACK,null,null))}remove(e){return new nS(this.comparator,this.root.remove(e,this.comparator).copy(null,null,nA.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){let r=this.comparator(e,n.key);if(0===r)return t+n.left.size;r<0?n=n.left:(t+=n.left.size+1,n=n.right)}return -1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,n)=>(e(t,n),!1))}toString(){let e=[];return this.inorderTraversal((t,n)=>(e.push(`${t}:${n}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new nC(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new nC(this.root,e,this.comparator,!1)}getReverseIterator(){return new nC(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new nC(this.root,e,this.comparator,!0)}}class nC{constructor(e,t,n,r){this.isReverse=r,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?n(e.key,t):1,t&&r&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(0===i){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class nA{constructor(e,t,n,r,i){this.key=e,this.value=t,this.color=null!=n?n:nA.RED,this.left=null!=r?r:nA.EMPTY,this.right=null!=i?i:nA.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,r,i){return new nA(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this,i=n(e,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n))).fixUp()}removeMin(){if(this.left.isEmpty())return nA.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),(e=e.copy(null,null,null,e.left.removeMin(),null)).fixUp()}remove(e,t){let n,r=this;if(0>t(e,r.key))r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===t(e,r.key)){if(r.right.isEmpty())return nA.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=(e=(e=e.copy(null,null,null,null,e.right.rotateRight())).rotateLeft()).colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=(e=e.rotateRight()).colorFlip()),e}rotateLeft(){let e=this.copy(null,null,nA.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,nA.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){return Math.pow(2,this.check())<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw tq(43730,{key:this.key,value:this.value});if(this.right.isRed())throw tq(14113,{key:this.key,value:this.value});let e=this.left.check();if(e!==this.right.check())throw tq(27949);return e+ +!this.isRed()}}nA.EMPTY=null,nA.RED=!0,nA.BLACK=!1,nA.EMPTY=new class{constructor(){this.size=0}get key(){throw tq(57766)}get value(){throw tq(16141)}get color(){throw tq(16727)}get left(){throw tq(29726)}get right(){throw tq(36894)}copy(e,t,n,r,i){return this}insert(e,t,n){return new nA(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class nx{constructor(e){this.comparator=e,this.data=new nS(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,n)=>(e(t),!1))}forEachInRange(e,t){let n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){let r=n.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new nD(this.data.getIterator())}getIteratorFrom(e){return new nD(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(e=>{t=t.add(e)}),t}isEqual(e){if(!(e instanceof nx)||this.size!==e.size)return!1;let t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){let e=t.getNext().key,r=n.getNext().key;if(0!==this.comparator(e,r))return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new nx(this.comparator);return t.data=e,t}}class nD{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class nk{constructor(e){this.fields=e,e.sort(nr.comparator)}static empty(){return new nk([])}unionWith(e){let t=new nx(nr.comparator);for(let e of this.fields)t=t.add(e);for(let n of e)t=t.add(n);return new nk(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return t7(this.fields,e.fields,(e,t)=>e.isEqual(t))}}class nN extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class nL{constructor(e){this.binaryString=e}static fromBase64String(e){return new nL(function(e){try{return atob(e)}catch(e){throw"undefined"!=typeof DOMException&&e instanceof DOMException?new nN("Invalid base64 string: "+e):e}}(e))}static fromUint8Array(e){return new nL(function(e){let t="";for(let n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e))}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return btoa(this.binaryString)}toUint8Array(){var e=this.binaryString;let t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return t5(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}nL.EMPTY_BYTE_STRING=new nL("");const nR=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function nO(e){if(tW(!!e,39018),"string"==typeof e){let t=0,n=nR.exec(e);if(tW(!!n,46558,{timestamp:e}),n[1]){let e=n[1];t=Number(e=(e+"000000000").substr(0,9))}return{seconds:Math.floor(new Date(e).getTime()/1e3),nanos:t}}return{seconds:nM(e.seconds),nanos:nM(e.nanos)}}function nM(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function nP(e){return"string"==typeof e?nL.fromBase64String(e):nL.fromUint8Array(e)}const nF="server_timestamp",nV="__type__",nB="__previous_value__",nU="__local_write_time__";function nj(e){var t,n;return(null==(n=((null==(t=null==e?void 0:e.mapValue)?void 0:t.fields)||{})[nV])?void 0:n.stringValue)===nF}function n$(e){let t=e.mapValue.fields[nB];return nj(t)?n$(t):t}function nq(e){let t=nO(e.mapValue.fields[nU].timestampValue);return new nf(t.seconds,t.nanos)}class nz{constructor(e,t,n,r,i,s,a,o,l,u){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=s,this.autoDetectLongPolling=a,this.longPollingOptions=o,this.useFetchStreams=l,this.isUsingEmulator=u}}const nW="(default)";class nH{constructor(e,t){this.projectId=e,this.database=t||nW}static empty(){return new nH("","")}get isDefaultDatabase(){return this.database===nW}isEqual(e){return e instanceof nH&&e.projectId===this.projectId&&e.database===this.database}}const nG="__type__",nK="__max__",nQ={mapValue:{fields:{__type__:{stringValue:nK}}}},nX="__vector__",nY="value";function nJ(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?nj(e)?4:rn(e)?0x1fffffffffffff:re(e)?10:11:tq(28295,{value:e})}function nZ(e,t){if(e===t)return!0;let n=nJ(e);if(n!==nJ(t))return!1;switch(n){case 0:case 0x1fffffffffffff:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return nq(e).isEqual(nq(t));case 3:if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;let r=nO(e.timestampValue),i=nO(t.timestampValue);return r.seconds===i.seconds&&r.nanos===i.nanos;case 5:return e.stringValue===t.stringValue;case 6:return nP(e.bytesValue).isEqual(nP(t.bytesValue));case 7:return e.referenceValue===t.referenceValue;case 8:return nM(e.geoPointValue.latitude)===nM(t.geoPointValue.latitude)&&nM(e.geoPointValue.longitude)===nM(t.geoPointValue.longitude);case 2:if("integerValue"in e&&"integerValue"in t)return nM(e.integerValue)===nM(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){let n=nM(e.doubleValue),r=nM(t.doubleValue);return n===r?nE(n)===nE(r):isNaN(n)&&isNaN(r)}return!1;case 9:return t7(e.arrayValue.values||[],t.arrayValue.values||[],nZ);case 10:case 11:let s=e.mapValue.fields||{},a=t.mapValue.fields||{};if(nT(s)!==nT(a))return!1;for(let e in s)if(s.hasOwnProperty(e)&&(void 0===a[e]||!nZ(s[e],a[e])))return!1;return!0;default:return tq(52216,{left:e})}}function n0(e,t){return void 0!==(e.values||[]).find(e=>nZ(e,t))}function n1(e,t){if(e===t)return 0;let n=nJ(e),r=nJ(t);if(n!==r)return t5(n,r);switch(n){case 0:case 0x1fffffffffffff:return 0;case 1:return t5(e.booleanValue,t.booleanValue);case 2:let i=nM(e.integerValue||e.doubleValue),s=nM(t.integerValue||t.doubleValue);return i<s?-1:i>s?1:i===s?0:isNaN(i)?isNaN(s)?0:-1:1;case 3:return n2(e.timestampValue,t.timestampValue);case 4:return n2(nq(e),nq(t));case 5:return t4(e.stringValue,t.stringValue);case 6:return function(e,t){let n=nP(e),r=nP(t);return n.compareTo(r)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){let n=e.split("/"),r=t.split("/");for(let e=0;e<n.length&&e<r.length;e++){let t=t5(n[e],r[e]);if(0!==t)return t}return t5(n.length,r.length)}(e.referenceValue,t.referenceValue);case 8:return function(e,t){let n=t5(nM(e.latitude),nM(t.latitude));return 0!==n?n:t5(nM(e.longitude),nM(t.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return n6(e.arrayValue,t.arrayValue);case 10:return function(e,t){var n,r,i,s;let a=e.fields||{},o=t.fields||{},l=null==(n=a[nY])?void 0:n.arrayValue,u=null==(r=o[nY])?void 0:r.arrayValue,h=t5((null==(i=null==l?void 0:l.values)?void 0:i.length)||0,(null==(s=null==u?void 0:u.values)?void 0:s.length)||0);return 0!==h?h:n6(l,u)}(e.mapValue,t.mapValue);case 11:return function(e,t){if(e===nQ.mapValue&&t===nQ.mapValue)return 0;if(e===nQ.mapValue)return 1;if(t===nQ.mapValue)return -1;let n=e.fields||{},r=Object.keys(n),i=t.fields||{},s=Object.keys(i);r.sort(),s.sort();for(let e=0;e<r.length&&e<s.length;++e){let t=t4(r[e],s[e]);if(0!==t)return t;let a=n1(n[r[e]],i[s[e]]);if(0!==a)return a}return t5(r.length,s.length)}(e.mapValue,t.mapValue);default:throw tq(23264,{le:n})}}function n2(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return t5(e,t);let n=nO(e),r=nO(t),i=t5(n.seconds,r.seconds);return 0!==i?i:t5(n.nanos,r.nanos)}function n6(e,t){let n=e.values||[],r=t.values||[];for(let e=0;e<n.length&&e<r.length;++e){let t=n1(n[e],r[e]);if(t)return t}return t5(n.length,r.length)}function n3(e){var t,n;return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){let t=nO(e);return`time(${t.seconds},${t.nanos})`}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?nP(e.bytesValue).toBase64():"referenceValue"in e?(t=e.referenceValue,ni.fromName(t).toString()):"geoPointValue"in e?(n=e.geoPointValue,`geo(${n.latitude},${n.longitude})`):"arrayValue"in e?function(e){let t="[",n=!0;for(let r of e.values||[])n?n=!1:t+=",",t+=n3(r);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){let t=Object.keys(e.fields||{}).sort(),n="{",r=!0;for(let i of t)r?r=!1:n+=",",n+=`${i}:${n3(e.fields[i])}`;return n+"}"}(e.mapValue):tq(61005,{value:e})}function n5(e){return!!e&&"integerValue"in e}function n4(e){return!!e&&"arrayValue"in e}function n8(e){return!!e&&"nullValue"in e}function n7(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function n9(e){return!!e&&"mapValue"in e}function re(e){var t,n;return(null==(n=((null==(t=null==e?void 0:e.mapValue)?void 0:t.fields)||{})[nG])?void 0:n.stringValue)===nX}function rt(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:Object.assign({},e.timestampValue)};if(e.mapValue){let t={mapValue:{fields:{}}};return n_(e.mapValue.fields,(e,n)=>t.mapValue.fields[e]=rt(n)),t}if(e.arrayValue){let t={arrayValue:{values:[]}};for(let n=0;n<(e.arrayValue.values||[]).length;++n)t.arrayValue.values[n]=rt(e.arrayValue.values[n]);return t}return Object.assign({},e)}function rn(e){return(((e.mapValue||{}).fields||{}).__type__||{}).stringValue===nK}class rr{constructor(e){this.value=e}static empty(){return new rr({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(!n9(t=(t.mapValue.fields||{})[e.get(n)]))return null;return(t=(t.mapValue.fields||{})[e.lastSegment()])||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=rt(t)}setAll(e){let t=nr.emptyPath(),n={},r=[];e.forEach((e,i)=>{if(!t.isImmediateParentOf(i)){let e=this.getFieldsMap(t);this.applyChanges(e,n,r),n={},r=[],t=i.popLast()}e?n[i.lastSegment()]=rt(e):r.push(i.lastSegment())});let i=this.getFieldsMap(t);this.applyChanges(i,n,r)}delete(e){let t=this.field(e.popLast());n9(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return nZ(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let r=t.mapValue.fields[e.get(n)];n9(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,n){for(let r of(n_(t,(t,n)=>e[t]=n),n))delete e[r]}clone(){return new rr(rt(this.value))}}class ri{constructor(e,t,n,r,i,s,a){this.key=e,this.documentType=t,this.version=n,this.readTime=r,this.createTime=i,this.data=s,this.documentState=a}static newInvalidDocument(e){return new ri(e,0,np.min(),np.min(),np.min(),rr.empty(),0)}static newFoundDocument(e,t,n,r){return new ri(e,1,t,np.min(),n,r,0)}static newNoDocument(e,t){return new ri(e,2,t,np.min(),np.min(),rr.empty(),0)}static newUnknownDocument(e,t){return new ri(e,3,t,np.min(),np.min(),rr.empty(),2)}convertToFoundDocument(e,t){return this.createTime.isEqual(np.min())&&(2===this.documentType||0===this.documentType)&&(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=rr.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=rr.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=np.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof ri&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new ri(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class rs{constructor(e,t){this.position=e,this.inclusive=t}}function ra(e,t,n){let r=0;for(let i=0;i<e.position.length;i++){let s=t[i],a=e.position[i];if(r=s.field.isKeyField()?ni.comparator(ni.fromName(a.referenceValue),n.key):n1(a,n.data.field(s.field)),"desc"===s.dir&&(r*=-1),0!==r)break}return r}function ro(e,t){if(null===e)return null===t;if(null===t||e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!nZ(e.position[n],t.position[n]))return!1;return!0}class rl{constructor(e,t="asc"){this.field=e,this.dir=t}}class ru{}class rh extends ru{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):new rp(e,t,n):"array-contains"===t?new rv(e,n):"in"===t?new rw(e,n):"not-in"===t?new rb(e,n):"array-contains-any"===t?new rE(e,n):new rh(e,t,n)}static createKeyFieldInFilter(e,t,n){return"in"===t?new rg(e,n):new rm(e,n)}matches(e){let t=e.data.field(this.field);return"!="===this.op?null!==t&&void 0===t.nullValue&&this.matchesComparison(n1(t,this.value)):null!==t&&nJ(this.value)===nJ(t)&&this.matchesComparison(n1(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return tq(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class rc extends ru{constructor(e,t){super(),this.filters=e,this.op=t,this.he=null}static create(e,t){return new rc(e,t)}matches(e){return rd(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.he||(this.he=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.he}getFilters(){return Object.assign([],this.filters)}}function rd(e){return"and"===e.op}function rf(e){for(let t of e.filters)if(t instanceof rc)return!1;return!0}class rp extends rh{constructor(e,t,n){super(e,t,n),this.key=ni.fromName(n.referenceValue)}matches(e){let t=ni.comparator(e.key,this.key);return this.matchesComparison(t)}}class rg extends rh{constructor(e,t){super(e,"in",t),this.keys=ry("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class rm extends rh{constructor(e,t){super(e,"not-in",t),this.keys=ry("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function ry(e,t){var n;return((null==(n=t.arrayValue)?void 0:n.values)||[]).map(e=>ni.fromName(e.referenceValue))}class rv extends rh{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return n4(t)&&n0(t.arrayValue,this.value)}}class rw extends rh{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return null!==t&&n0(this.value.arrayValue,t)}}class rb extends rh{constructor(e,t){super(e,"not-in",t)}matches(e){if(n0(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return null!==t&&void 0===t.nullValue&&!n0(this.value.arrayValue,t)}}class rE extends rh{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!(!n4(t)||!t.arrayValue.values)&&t.arrayValue.values.some(e=>n0(this.value.arrayValue,e))}}class rT{constructor(e,t=null,n=[],r=[],i=null,s=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=s,this.endAt=a,this.Pe=null}}function r_(e,t=null,n=[],r=[],i=null,s=null,a=null){return new rT(e,t,n,r,i,s,a)}function rI(e){if(null===e.Pe){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(e=>(function e(t){if(t instanceof rh)return t.field.canonicalString()+t.op.toString()+n3(t.value);if(rf(t)&&rd(t))return t.filters.map(t=>e(t)).join(",");{let n=t.filters.map(t=>e(t)).join(",");return`${t.op}(${n})`}})(e)).join(","),t+="|ob:",t+=e.orderBy.map(e=>e.field.canonicalString()+e.dir).join(","),null==e.limit||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(e=>n3(e)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(e=>n3(e)).join(",")),e.Pe=t}return e.Pe}function rS(e,t){if(e.limit!==t.limit||e.orderBy.length!==t.orderBy.length)return!1;for(let i=0;i<e.orderBy.length;i++){var n,r;if(n=e.orderBy[i],r=t.orderBy[i],!(n.dir===r.dir&&n.field.isEqual(r.field)))return!1}if(e.filters.length!==t.filters.length)return!1;for(let n=0;n<e.filters.length;n++)if(!function e(t,n){return t instanceof rh?n instanceof rh&&t.op===n.op&&t.field.isEqual(n.field)&&nZ(t.value,n.value):t instanceof rc?n instanceof rc&&t.op===n.op&&t.filters.length===n.filters.length&&t.filters.reduce((t,r,i)=>t&&e(r,n.filters[i]),!0):void tq(19439)}(e.filters[n],t.filters[n]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!ro(e.startAt,t.startAt)&&ro(e.endAt,t.endAt)}function rC(e){return ni.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}class rA{constructor(e,t=null,n=[],r=[],i=null,s="F",a=null,o=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=s,this.startAt=a,this.endAt=o,this.Te=null,this.Ie=null,this.de=null,this.startAt,this.endAt}}function rx(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function rD(e){if(null===e.Te){let t;e.Te=[];let n=new Set;for(let t of e.explicitOrderBy)e.Te.push(t),n.add(t.field.canonicalString());let r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(t=new nx(nr.comparator),e.filters.forEach(e=>{e.getFlattenedFilters().forEach(e=>{e.isInequality()&&(t=t.add(e.field))})}),t).forEach(t=>{n.has(t.canonicalString())||t.isKeyField()||e.Te.push(new rl(t,r))}),n.has(nr.keyField().canonicalString())||e.Te.push(new rl(nr.keyField(),r))}return e.Te}function rk(e){return e.Ie||(e.Ie=function(e,t){if("F"===e.limitType)return r_(e.path,e.collectionGroup,t,e.filters,e.limit,e.startAt,e.endAt);{t=t.map(e=>{let t="desc"===e.dir?"asc":"desc";return new rl(e.field,t)});let n=e.endAt?new rs(e.endAt.position,e.endAt.inclusive):null,r=e.startAt?new rs(e.startAt.position,e.startAt.inclusive):null;return r_(e.path,e.collectionGroup,t,e.filters,e.limit,n,r)}}(e,rD(e))),e.Ie}function rN(e,t,n){return new rA(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function rL(e,t){return rS(rk(e),rk(t))&&e.limitType===t.limitType}function rR(e){return`${rI(rk(e))}|lt:${e.limitType}`}function rO(e){var t;let n;return`Query(target=${n=(t=rk(e)).path.canonicalString(),null!==t.collectionGroup&&(n+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(n+=`, filters: [${t.filters.map(e=>(function e(t){return t instanceof rh?`${t.field.canonicalString()} ${t.op} ${n3(t.value)}`:t instanceof rc?t.op.toString()+" {"+t.getFilters().map(e).join(" ,")+"}":"Filter"})(e)).join(", ")}]`),null==t.limit||(n+=", limit: "+t.limit),t.orderBy.length>0&&(n+=`, orderBy: [${t.orderBy.map(e=>`${e.field.canonicalString()} (${e.dir})`).join(", ")}]`),t.startAt&&(n+=", startAt: ",n+=t.startAt.inclusive?"b:":"a:",n+=t.startAt.position.map(e=>n3(e)).join(",")),t.endAt&&(n+=", endAt: ",n+=t.endAt.inclusive?"a:":"b:",n+=t.endAt.position.map(e=>n3(e)).join(",")),`Target(${n})`}; limitType=${e.limitType})`}function rM(e,t){return t.isFoundDocument()&&function(e,t){let n=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(n):ni.isDocumentKey(e.path)?e.path.isEqual(n):e.path.isImmediateParentOf(n)}(e,t)&&function(e,t){for(let n of rD(e))if(!n.field.isKeyField()&&null===t.data.field(n.field))return!1;return!0}(e,t)&&function(e,t){for(let n of e.filters)if(!n.matches(t))return!1;return!0}(e,t)&&(!e.startAt||!!function(e,t,n){let r=ra(e,t,n);return e.inclusive?r<=0:r<0}(e.startAt,rD(e),t))&&(!e.endAt||!!function(e,t,n){let r=ra(e,t,n);return e.inclusive?r>=0:r>0}(e.endAt,rD(e),t))}function rP(e){return(t,n)=>{let r=!1;for(let i of rD(e)){let e=function(e,t,n){let r=e.field.isKeyField()?ni.comparator(t.key,n.key):function(e,t,n){let r=t.data.field(e),i=n.data.field(e);return null!==r&&null!==i?n1(r,i):tq(42886)}(e.field,t,n);switch(e.dir){case"asc":return r;case"desc":return -1*r;default:return tq(19790,{direction:e.dir})}}(i,t,n);if(0!==e)return e;r=r||i.field.isKeyField()}return 0}}class rF{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n){for(let[t,r]of n)if(this.equalsFn(t,e))return r}}has(e){return void 0!==this.get(e)}set(e,t){let n=this.mapKeyFn(e),r=this.inner[n];if(void 0===r)return this.inner[n]=[[e,t]],void this.innerSize++;for(let n=0;n<r.length;n++)if(this.equalsFn(r[n][0],e))return void(r[n]=[e,t]);r.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return 1===n.length?delete this.inner[t]:n.splice(r,1),this.innerSize--,!0;return!1}forEach(e){n_(this.inner,(t,n)=>{for(let[t,r]of n)e(t,r)})}isEmpty(){return nI(this.inner)}size(){return this.innerSize}}const rV=new nS(ni.comparator),rB=new nS(ni.comparator);function rU(...e){let t=rB;for(let n of e)t=t.insert(n.key,n);return t}function rj(e){let t=rB;return e.forEach((e,n)=>t=t.insert(e,n.overlayedDocument)),t}function r$(){return new rF(e=>e.toString(),(e,t)=>e.isEqual(t))}const rq=new nS(ni.comparator),rz=new nx(ni.comparator);function rW(...e){let t=rz;for(let n of e)t=t.add(n);return t}const rH=new nx(t5);function rG(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:nE(t)?"-0":t}}function rK(e){return{integerValue:""+e}}class rQ{constructor(){this._=void 0}}function rX(e,t){return e instanceof r2?n5(t)||t&&"doubleValue"in t?t:{integerValue:0}:null}class rY extends rQ{}class rJ extends rQ{constructor(e){super(),this.elements=e}}function rZ(e,t){let n=r3(t);for(let t of e.elements)n.some(e=>nZ(e,t))||n.push(t);return{arrayValue:{values:n}}}class r0 extends rQ{constructor(e){super(),this.elements=e}}function r1(e,t){let n=r3(t);for(let t of e.elements)n=n.filter(e=>!nZ(e,t));return{arrayValue:{values:n}}}class r2 extends rQ{constructor(e,t){super(),this.serializer=e,this.Ee=t}}function r6(e){return nM(e.integerValue||e.doubleValue)}function r3(e){return n4(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class r5{constructor(e,t){this.version=e,this.transformResults=t}}class r4{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new r4}static exists(e){return new r4(void 0,e)}static updateTime(e){return new r4(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function r8(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class r7{}function r9(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new il(e.key,r4.none()):new ir(e.key,e.data,r4.none());{let n=e.data,r=rr.empty(),i=new nx(nr.comparator);for(let e of t.fields)if(!i.has(e)){let t=n.field(e);null===t&&e.length>1&&(e=e.popLast(),t=n.field(e)),null===t?r.delete(e):r.set(e,t),i=i.add(e)}return new ii(e.key,r,new nk(i.toArray()),r4.none())}}function ie(e,t,n,r){return e instanceof ir?function(e,t,n,r){if(!r8(e.precondition,t))return n;let i=e.value.clone(),s=io(e.fieldTransforms,r,t);return i.setAll(s),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null}(e,t,n,r):e instanceof ii?function(e,t,n,r){if(!r8(e.precondition,t))return n;let i=io(e.fieldTransforms,r,t),s=t.data;return(s.setAll(is(e)),s.setAll(i),t.convertToFoundDocument(t.version,s).setHasLocalMutations(),null===n)?null:n.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map(e=>e.field))}(e,t,n,r):r8(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):n}function it(e,t){var n,r;return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&(n=e.fieldTransforms,r=t.fieldTransforms,!!(void 0===n&&void 0===r||!(!n||!r)&&t7(n,r,(e,t)=>{var n,r;return e.field.isEqual(t.field)&&(n=e.transform,r=t.transform,n instanceof rJ&&r instanceof rJ||n instanceof r0&&r instanceof r0?t7(n.elements,r.elements,nZ):n instanceof r2&&r instanceof r2?nZ(n.Ee,r.Ee):n instanceof rY&&r instanceof rY)})))&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}class ir extends r7{constructor(e,t,n,r=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class ii extends r7{constructor(e,t,n,r,i=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=r,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function is(e){let t=new Map;return e.fieldMask.fields.forEach(n=>{if(!n.isEmpty()){let r=e.data.field(n);t.set(n,r)}}),t}function ia(e,t,n){let r=new Map;tW(e.length===n.length,32656,{Ae:n.length,Re:e.length});for(let s=0;s<n.length;s++){var i;let a=e[s],o=a.transform,l=t.data.field(a.field);r.set(a.field,(i=n[s],o instanceof rJ?rZ(o,l):o instanceof r0?r1(o,l):i))}return r}function io(e,t,n){let r=new Map;for(let i of e){let e=i.transform,s=n.data.field(i.field);r.set(i.field,e instanceof rY?function(e,t){let n={fields:{[nV]:{stringValue:nF},[nU]:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&nj(t)&&(t=n$(t)),t&&(n.fields[nB]=t),{mapValue:n}}(t,s):e instanceof rJ?rZ(e,s):e instanceof r0?r1(e,s):function(e,t){let n=rX(e,t),r=r6(n)+r6(e.Ee);return n5(n)&&n5(e.Ee)?rK(r):rG(e.serializer,r)}(e,s))}return r}class il extends r7{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class iu extends r7{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class ih{constructor(e,t,n,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(e,t){let n=t.mutationResults;for(let t=0;t<this.mutations.length;t++){let r=this.mutations[t];r.key.isEqual(e.key)&&function(e,t,n){e instanceof ir?function(e,t,n){let r=e.value.clone(),i=ia(e.fieldTransforms,t,n.transformResults);r.setAll(i),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(e,t,n):e instanceof ii?function(e,t,n){if(!r8(e.precondition,t))return t.convertToUnknownDocument(n.version);let r=ia(e.fieldTransforms,t,n.transformResults),i=t.data;i.setAll(is(e)),i.setAll(r),t.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(e,t,n):t.convertToNoDocument(n.version).setHasCommittedMutations()}(r,e,n[t])}}applyToLocalView(e,t){for(let n of this.baseMutations)n.key.isEqual(e.key)&&(t=ie(n,e,t,this.localWriteTime));for(let n of this.mutations)n.key.isEqual(e.key)&&(t=ie(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let n=r$();return this.mutations.forEach(r=>{let i=e.get(r.key),s=i.overlayedDocument,a=this.applyToLocalView(s,i.mutatedFields),o=r9(s,a=t.has(r.key)?null:a);null!==o&&n.set(r.key,o),s.isValidDocument()||s.convertToNoDocument(np.min())}),n}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),rW())}isEqual(e){return this.batchId===e.batchId&&t7(this.mutations,e.mutations,(e,t)=>it(e,t))&&t7(this.baseMutations,e.baseMutations,(e,t)=>it(e,t))}}class ic{constructor(e,t,n,r){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=r}static from(e,t,n){tW(e.mutations.length===n.length,58842,{Ve:e.mutations.length,me:n.length});let r=rq,i=e.mutations;for(let e=0;e<i.length;e++)r=r.insert(i[e].key,n[e].version);return new ic(e,t,n,r)}}class id{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class ip{constructor(e,t){this.count=e,this.unchangedNames=t}}function ig(e){if(void 0===e)return tU("GRPC error has no .code"),tH.UNKNOWN;switch(e){case E.OK:return tH.OK;case E.CANCELLED:return tH.CANCELLED;case E.UNKNOWN:return tH.UNKNOWN;case E.DEADLINE_EXCEEDED:return tH.DEADLINE_EXCEEDED;case E.RESOURCE_EXHAUSTED:return tH.RESOURCE_EXHAUSTED;case E.INTERNAL:return tH.INTERNAL;case E.UNAVAILABLE:return tH.UNAVAILABLE;case E.UNAUTHENTICATED:return tH.UNAUTHENTICATED;case E.INVALID_ARGUMENT:return tH.INVALID_ARGUMENT;case E.NOT_FOUND:return tH.NOT_FOUND;case E.ALREADY_EXISTS:return tH.ALREADY_EXISTS;case E.PERMISSION_DENIED:return tH.PERMISSION_DENIED;case E.FAILED_PRECONDITION:return tH.FAILED_PRECONDITION;case E.ABORTED:return tH.ABORTED;case E.OUT_OF_RANGE:return tH.OUT_OF_RANGE;case E.UNIMPLEMENTED:return tH.UNIMPLEMENTED;case E.DATA_LOSS:return tH.DATA_LOSS;default:return tq(39323,{code:e})}}(T=E||(E={}))[T.OK=0]="OK",T[T.CANCELLED=1]="CANCELLED",T[T.UNKNOWN=2]="UNKNOWN",T[T.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",T[T.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",T[T.NOT_FOUND=5]="NOT_FOUND",T[T.ALREADY_EXISTS=6]="ALREADY_EXISTS",T[T.PERMISSION_DENIED=7]="PERMISSION_DENIED",T[T.UNAUTHENTICATED=16]="UNAUTHENTICATED",T[T.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",T[T.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",T[T.ABORTED=10]="ABORTED",T[T.OUT_OF_RANGE=11]="OUT_OF_RANGE",T[T.UNIMPLEMENTED=12]="UNIMPLEMENTED",T[T.INTERNAL=13]="INTERNAL",T[T.UNAVAILABLE=14]="UNAVAILABLE",T[T.DATA_LOSS=15]="DATA_LOSS";const im=new l([0xffffffff,0xffffffff],0);function iy(e){let t=t6().encode(e),n=new u;return n.update(t),new Uint8Array(n.digest())}function iv(e){let t=new DataView(e.buffer),n=t.getUint32(0,!0),r=t.getUint32(4,!0),i=t.getUint32(8,!0),s=t.getUint32(12,!0);return[new l([n,r],0),new l([i,s],0)]}class iw{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new ib(`Invalid padding: ${t}`);if(n<0||e.length>0&&0===this.hashCount)throw new ib(`Invalid hash count: ${n}`);if(0===e.length&&0!==t)throw new ib(`Invalid padding when bitmap length is 0: ${t}`);this.fe=8*e.length-t,this.ge=l.fromNumber(this.fe)}pe(e,t,n){let r=e.add(t.multiply(l.fromNumber(n)));return 1===r.compare(im)&&(r=new l([r.getBits(0),r.getBits(1)],0)),r.modulo(this.ge).toNumber()}ye(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.fe)return!1;let[t,n]=iv(iy(e));for(let e=0;e<this.hashCount;e++){let r=this.pe(t,n,e);if(!this.ye(r))return!1}return!0}static create(e,t,n){let r=new iw(new Uint8Array(Math.ceil(e/8)),e%8==0?0:8-e%8,t);return n.forEach(e=>r.insert(e)),r}insert(e){if(0===this.fe)return;let[t,n]=iv(iy(e));for(let e=0;e<this.hashCount;e++){let r=this.pe(t,n,e);this.we(r)}}we(e){let t=Math.floor(e/8);this.bitmap[t]|=1<<e%8}}class ib extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class iE{constructor(e,t,n,r,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,n){let r=new Map;return r.set(e,iT.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new iE(np.min(),r,new nS(t5),rV,rW())}}class iT{constructor(e,t,n,r,i){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new iT(n,t,rW(),rW(),rW())}}class i_{constructor(e,t,n,r){this.Se=e,this.removedTargetIds=t,this.key=n,this.be=r}}class iI{constructor(e,t){this.targetId=e,this.De=t}}class iS{constructor(e,t,n=nL.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=r}}class iC{constructor(){this.ve=0,this.Ce=iD(),this.Fe=nL.EMPTY_BYTE_STRING,this.Me=!1,this.xe=!0}get current(){return this.Me}get resumeToken(){return this.Fe}get Oe(){return 0!==this.ve}get Ne(){return this.xe}Be(e){e.approximateByteSize()>0&&(this.xe=!0,this.Fe=e)}Le(){let e=rW(),t=rW(),n=rW();return this.Ce.forEach((r,i)=>{switch(i){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:n=n.add(r);break;default:tq(38017,{changeType:i})}}),new iT(this.Fe,this.Me,e,t,n)}ke(){this.xe=!1,this.Ce=iD()}qe(e,t){this.xe=!0,this.Ce=this.Ce.insert(e,t)}Qe(e){this.xe=!0,this.Ce=this.Ce.remove(e)}$e(){this.ve+=1}Ue(){this.ve-=1,tW(this.ve>=0,3241,{ve:this.ve})}Ke(){this.xe=!0,this.Me=!0}}class iA{constructor(e){this.We=e,this.Ge=new Map,this.ze=rV,this.je=ix(),this.Je=ix(),this.He=new nS(t5)}Ye(e){for(let t of e.Se)e.be&&e.be.isFoundDocument()?this.Ze(t,e.be):this.Xe(t,e.key,e.be);for(let t of e.removedTargetIds)this.Xe(t,e.key,e.be)}et(e){this.forEachTarget(e,t=>{let n=this.tt(t);switch(e.state){case 0:this.nt(t)&&n.Be(e.resumeToken);break;case 1:n.Ue(),n.Oe||n.ke(),n.Be(e.resumeToken);break;case 2:n.Ue(),n.Oe||this.removeTarget(t);break;case 3:this.nt(t)&&(n.Ke(),n.Be(e.resumeToken));break;case 4:this.nt(t)&&(this.rt(t),n.Be(e.resumeToken));break;default:tq(56790,{state:e.state})}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Ge.forEach((e,n)=>{this.nt(n)&&t(n)})}it(e){let t=e.targetId,n=e.De.count,r=this.st(t);if(r){let i=r.target;if(rC(i))if(0===n){let e=new ni(i.path);this.Xe(t,e,ri.newNoDocument(e,np.min()))}else tW(1===n,20013,{expectedCount:n});else{let r=this.ot(t);if(r!==n){let n=this._t(e),i=n?this.ut(n,e,r):1;0!==i&&(this.rt(t),this.He=this.He.insert(t,2===i?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch"))}}}}_t(e){let t,n,r=e.De.unchangedNames;if(!r||!r.bits)return null;let{bits:{bitmap:i="",padding:s=0},hashCount:a=0}=r;try{t=nP(i).toUint8Array()}catch(e){if(e instanceof nN)return tj("Decoding the base64 bloom filter in existence filter failed ("+e.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw e}try{n=new iw(t,s,a)}catch(e){return tj(e instanceof ib?"BloomFilter error: ":"Applying bloom filter failed: ",e),null}return 0===n.fe?null:n}ut(e,t,n){return 2*(t.De.count!==n-this.ht(e,t.targetId))}ht(e,t){let n=this.We.getRemoteKeysForTarget(t),r=0;return n.forEach(n=>{let i=this.We.lt(),s=`projects/${i.projectId}/databases/${i.database}/documents/${n.path.canonicalString()}`;e.mightContain(s)||(this.Xe(t,n,null),r++)}),r}Pt(e){let t=new Map;this.Ge.forEach((n,r)=>{let i=this.st(r);if(i){if(n.current&&rC(i.target)){let t=new ni(i.target.path);this.Tt(t).has(r)||this.It(r,t)||this.Xe(r,t,ri.newNoDocument(t,e))}n.Ne&&(t.set(r,n.Le()),n.ke())}});let n=rW();this.Je.forEach((e,t)=>{let r=!0;t.forEachWhile(e=>{let t=this.st(e);return!t||"TargetPurposeLimboResolution"===t.purpose||(r=!1,!1)}),r&&(n=n.add(e))}),this.ze.forEach((t,n)=>n.setReadTime(e));let r=new iE(e,t,this.He,this.ze,n);return this.ze=rV,this.je=ix(),this.Je=ix(),this.He=new nS(t5),r}Ze(e,t){if(!this.nt(e))return;let n=2*!!this.It(e,t.key);this.tt(e).qe(t.key,n),this.ze=this.ze.insert(t.key,t),this.je=this.je.insert(t.key,this.Tt(t.key).add(e)),this.Je=this.Je.insert(t.key,this.dt(t.key).add(e))}Xe(e,t,n){if(!this.nt(e))return;let r=this.tt(e);this.It(e,t)?r.qe(t,1):r.Qe(t),this.Je=this.Je.insert(t,this.dt(t).delete(e)),this.Je=this.Je.insert(t,this.dt(t).add(e)),n&&(this.ze=this.ze.insert(t,n))}removeTarget(e){this.Ge.delete(e)}ot(e){let t=this.tt(e).Le();return this.We.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}$e(e){this.tt(e).$e()}tt(e){let t=this.Ge.get(e);return t||(t=new iC,this.Ge.set(e,t)),t}dt(e){let t=this.Je.get(e);return t||(t=new nx(t5),this.Je=this.Je.insert(e,t)),t}Tt(e){let t=this.je.get(e);return t||(t=new nx(t5),this.je=this.je.insert(e,t)),t}nt(e){let t=null!==this.st(e);return t||tB("WatchChangeAggregator","Detected inactive target",e),t}st(e){let t=this.Ge.get(e);return t&&t.Oe?null:this.We.Et(e)}rt(e){this.Ge.set(e,new iC),this.We.getRemoteKeysForTarget(e).forEach(t=>{this.Xe(e,t,null)})}It(e,t){return this.We.getRemoteKeysForTarget(e).has(t)}}function ix(){return new nS(ni.comparator)}function iD(){return new nS(ni.comparator)}const ik={asc:"ASCENDING",desc:"DESCENDING"},iN={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},iL={and:"AND",or:"OR"};class iR{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function iO(e,t){return e.useProto3Json||null==t?t:{value:t}}function iM(e,t){return e.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function iP(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function iF(e){return tW(!!e,49232),np.fromTimestamp(function(e){let t=nO(e);return new nf(t.seconds,t.nanos)}(e))}function iV(e,t){return iB(e,t).canonicalString()}function iB(e,t){let n=new nt(["projects",e.projectId,"databases",e.database]).child("documents");return void 0===t?n:n.child(t)}function iU(e){let t=nt.fromString(e);return tW(iQ(t),10190,{key:t.toString()}),t}function ij(e,t){return iV(e.databaseId,t.path)}function i$(e,t){let n=iU(t);if(n.get(1)!==e.databaseId.projectId)throw new tG(tH.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new tG(tH.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new ni(iW(n))}function iq(e,t){return iV(e.databaseId,t)}function iz(e){return new nt(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function iW(e){return tW(e.length>4&&"documents"===e.get(4),29091,{key:e.toString()}),e.popFirst(5)}function iH(e,t,n){return{name:ij(e,t),fields:n.value.mapValue.fields}}function iG(e){return{fieldPath:e.canonicalString()}}function iK(e){return nr.fromServerFormat(e.fieldPath)}function iQ(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}class iX{constructor(e,t,n,r,i=np.min(),s=np.min(),a=nL.EMPTY_BYTE_STRING,o=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=a,this.expectedCount=o}withSequenceNumber(e){return new iX(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new iX(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new iX(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new iX(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class iY{constructor(e){this.gt=e}}class iJ{constructor(){}bt(e,t){this.Dt(e,t),t.vt()}Dt(e,t){if("nullValue"in e)this.Ct(t,5);else if("booleanValue"in e)this.Ct(t,10),t.Ft(+!!e.booleanValue);else if("integerValue"in e)this.Ct(t,15),t.Ft(nM(e.integerValue));else if("doubleValue"in e){let n=nM(e.doubleValue);isNaN(n)?this.Ct(t,13):(this.Ct(t,15),nE(n)?t.Ft(0):t.Ft(n))}else if("timestampValue"in e){let n=e.timestampValue;this.Ct(t,20),"string"==typeof n&&(n=nO(n)),t.Mt(`${n.seconds||""}`),t.Ft(n.nanos||0)}else if("stringValue"in e)this.xt(e.stringValue,t),this.Ot(t);else if("bytesValue"in e)this.Ct(t,30),t.Nt(nP(e.bytesValue)),this.Ot(t);else if("referenceValue"in e)this.Bt(e.referenceValue,t);else if("geoPointValue"in e){let n=e.geoPointValue;this.Ct(t,45),t.Ft(n.latitude||0),t.Ft(n.longitude||0)}else"mapValue"in e?rn(e)?this.Ct(t,Number.MAX_SAFE_INTEGER):re(e)?this.Lt(e.mapValue,t):(this.kt(e.mapValue,t),this.Ot(t)):"arrayValue"in e?(this.qt(e.arrayValue,t),this.Ot(t)):tq(19022,{Qt:e})}xt(e,t){this.Ct(t,25),this.$t(e,t)}$t(e,t){t.Mt(e)}kt(e,t){let n=e.fields||{};for(let e of(this.Ct(t,55),Object.keys(n)))this.xt(e,t),this.Dt(n[e],t)}Lt(e,t){var n,r;let i=e.fields||{};this.Ct(t,53);let s=(null==(r=null==(n=i[nY].arrayValue)?void 0:n.values)?void 0:r.length)||0;this.Ct(t,15),t.Ft(nM(s)),this.xt(nY,t),this.Dt(i[nY],t)}qt(e,t){let n=e.values||[];for(let e of(this.Ct(t,50),n))this.Dt(e,t)}Bt(e,t){this.Ct(t,37),ni.fromName(e).path.forEach(e=>{this.Ct(t,60),this.$t(e,t)})}Ct(e,t){e.Ft(t)}Ot(e){e.Ft(2)}}iJ.Ut=new iJ;class iZ{constructor(){this.Dn=new i0}addToCollectionParentIndex(e,t){return this.Dn.add(t),nv.resolve()}getCollectionParents(e,t){return nv.resolve(this.Dn.getEntries(t))}addFieldIndex(e,t){return nv.resolve()}deleteFieldIndex(e,t){return nv.resolve()}deleteAllFieldIndexes(e){return nv.resolve()}createTargetIndexes(e,t){return nv.resolve()}getDocumentsMatchingTarget(e,t){return nv.resolve(null)}getIndexType(e,t){return nv.resolve(0)}getFieldIndexes(e,t){return nv.resolve([])}getNextCollectionGroupToUpdate(e){return nv.resolve(null)}getMinOffset(e,t){return nv.resolve(ng.min())}getMinOffsetFromCollectionGroup(e,t){return nv.resolve(ng.min())}updateCollectionGroup(e,t,n){return nv.resolve()}updateIndexEntries(e,t){return nv.resolve()}}class i0{constructor(){this.index={}}add(e){let t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new nx(nt.comparator),i=!r.has(n);return this.index[t]=r.add(n),i}has(e){let t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&&r.has(n)}getEntries(e){return(this.index[e]||new nx(nt.comparator)).toArray()}}new Uint8Array(0);const i1={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class i2{static withCacheSize(e){return new i2(e,i2.DEFAULT_COLLECTION_PERCENTILE,i2.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}}i2.DEFAULT_COLLECTION_PERCENTILE=10,i2.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,i2.DEFAULT=new i2(0x2800000,i2.DEFAULT_COLLECTION_PERCENTILE,i2.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),i2.DISABLED=new i2(-1,0,0);class i6{constructor(e){this._r=e}next(){return this._r+=2,this._r}static ar(){return new i6(0)}static ur(){return new i6(-1)}}const i3="LruGarbageCollector";function i5([e,t],[n,r]){let i=t5(e,n);return 0===i?t5(t,r):i}class i4{constructor(e){this.Tr=e,this.buffer=new nx(i5),this.Ir=0}dr(){return++this.Ir}Er(e){let t=[e,this.dr()];if(this.buffer.size<this.Tr)this.buffer=this.buffer.add(t);else{let e=this.buffer.last();0>i5(t,e)&&(this.buffer=this.buffer.delete(e).add(t))}}get maxValue(){return this.buffer.last()[0]}}class i8{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.Ar=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Rr(6e4)}stop(){this.Ar&&(this.Ar.cancel(),this.Ar=null)}get started(){return null!==this.Ar}Rr(e){tB(i3,`Garbage collection scheduled in ${e}ms`),this.Ar=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Ar=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){nw(e)?tB(i3,"Ignoring IndexedDB error during garbage collection: ",e):await ny(e)}await this.Rr(3e5)})}}class i7{constructor(e,t){this.Vr=e,this.params=t}calculateTargetCount(e,t){return this.Vr.mr(e).next(e=>Math.floor(t/100*e))}nthSequenceNumber(e,t){if(0===t)return nv.resolve(nb.ue);let n=new i4(t);return this.Vr.forEachTarget(e,e=>n.Er(e.sequenceNumber)).next(()=>this.Vr.gr(e,e=>n.Er(e))).next(()=>n.maxValue)}removeTargets(e,t,n){return this.Vr.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.Vr.removeOrphanedDocuments(e,t)}collect(e,t){return -1===this.params.cacheSizeCollectionThreshold?(tB("LruGarbageCollector","Garbage collection skipped; disabled"),nv.resolve(i1)):this.getCacheSize(e).next(n=>n<this.params.cacheSizeCollectionThreshold?(tB("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),i1):this.pr(e,t))}getCacheSize(e){return this.Vr.getCacheSize(e)}pr(e,t){let n,r,i,s,a,l,u,h=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(t=>(t>this.params.maximumSequenceNumbersToCollect?(tB("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${t}`),r=this.params.maximumSequenceNumbersToCollect):r=t,s=Date.now(),this.nthSequenceNumber(e,r))).next(r=>(n=r,a=Date.now(),this.removeTargets(e,n,t))).next(t=>(i=t,l=Date.now(),this.removeOrphanedDocuments(e,n))).next(e=>(u=Date.now(),tV()<=o.DEBUG&&tB("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${s-h}ms
	Determined least recently used ${r} in `+(a-s)+"ms\n"+`	Removed ${i} targets in `+(l-a)+"ms\n"+`	Removed ${e} documents in `+(u-l)+"ms\n"+`Total Duration: ${u-h}ms`),nv.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:e})))}}class i9{constructor(){this.changes=new rF(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,ri.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let n=this.changes.get(t);return void 0!==n?nv.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class se{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class st{constructor(e,t,n,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=r}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next(r=>(n=r,this.remoteDocumentCache.getEntry(e,t))).next(e=>(null!==n&&ie(n.mutation,e,nk.empty(),nf.now()),e))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.getLocalViewOfDocuments(e,t,rW()).next(()=>t))}getLocalViewOfDocuments(e,t,n=rW()){let r=r$();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,n).next(e=>{let t=rU();return e.forEach((e,n)=>{t=t.insert(e,n.overlayedDocument)}),t}))}getOverlayedDocuments(e,t){let n=r$();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,rW()))}populateOverlays(e,t,n){let r=[];return n.forEach(e=>{t.has(e)||r.push(e)}),this.documentOverlayCache.getOverlays(e,r).next(e=>{e.forEach((e,n)=>{t.set(e,n)})})}computeViews(e,t,n,r){let i=rV,s=r$(),a=r$();return t.forEach((e,t)=>{let a=n.get(t.key);r.has(t.key)&&(void 0===a||a.mutation instanceof ii)?i=i.insert(t.key,t):void 0!==a?(s.set(t.key,a.mutation.getFieldMask()),ie(a.mutation,t,a.mutation.getFieldMask(),nf.now())):s.set(t.key,nk.empty())}),this.recalculateAndSaveOverlays(e,i).next(e=>(e.forEach((e,t)=>s.set(e,t)),t.forEach((e,t)=>{var n;return a.set(e,new se(t,null!=(n=s.get(e))?n:null))}),a))}recalculateAndSaveOverlays(e,t){let n=r$(),r=new nS((e,t)=>e-t),i=rW();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(e=>{for(let i of e)i.keys().forEach(e=>{let s=t.get(e);if(null===s)return;let a=n.get(e)||nk.empty();a=i.applyToLocalView(s,a),n.set(e,a);let o=(r.get(i.batchId)||rW()).add(e);r=r.insert(i.batchId,o)})}).next(()=>{let s=[],a=r.getReverseIterator();for(;a.hasNext();){let r=a.getNext(),o=r.key,l=r.value,u=r$();l.forEach(e=>{if(!i.has(e)){let r=r9(t.get(e),n.get(e));null!==r&&u.set(e,r),i=i.add(e)}}),s.push(this.documentOverlayCache.saveOverlays(e,o,u))}return nv.waitFor(s)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.recalculateAndSaveOverlays(e,t))}getDocumentsMatchingQuery(e,t,n,r){return ni.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length?this.getDocumentsMatchingDocumentQuery(e,t.path):null!==t.collectionGroup?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,r):this.getDocumentsMatchingCollectionQuery(e,t,n,r)}getNextDocuments(e,t,n,r){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,r).next(i=>{let s=r-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,r-i.size):nv.resolve(r$()),a=-1,o=i;return s.next(t=>nv.forEach(t,(t,n)=>(a<n.largestBatchId&&(a=n.largestBatchId),i.get(t)?nv.resolve():this.remoteDocumentCache.getEntry(e,t).next(e=>{o=o.insert(t,e)}))).next(()=>this.populateOverlays(e,t,i)).next(()=>this.computeViews(e,o,t,rW())).next(e=>({batchId:a,changes:rj(e)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new ni(t)).next(e=>{let t=rU();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t})}getDocumentsMatchingCollectionGroupQuery(e,t,n,r){let i=t.collectionGroup,s=rU();return this.indexManager.getCollectionParents(e,i).next(a=>nv.forEach(a,a=>{let o=new rA(a.child(i),null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt);return this.getDocumentsMatchingCollectionQuery(e,o,n,r).next(e=>{e.forEach((e,t)=>{s=s.insert(e,t)})})}).next(()=>s))}getDocumentsMatchingCollectionQuery(e,t,n,r){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next(s=>(i=s,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,i,r))).next(e=>{i.forEach((t,n)=>{let r=n.getKey();null===e.get(r)&&(e=e.insert(r,ri.newInvalidDocument(r)))});let n=rU();return e.forEach((e,r)=>{let s=i.get(e);void 0!==s&&ie(s.mutation,r,nk.empty(),nf.now()),rM(t,r)&&(n=n.insert(e,r))}),n})}}class sn{constructor(e){this.serializer=e,this.Br=new Map,this.Lr=new Map}getBundleMetadata(e,t){return nv.resolve(this.Br.get(t))}saveBundleMetadata(e,t){return this.Br.set(t.id,{id:t.id,version:t.version,createTime:iF(t.createTime)}),nv.resolve()}getNamedQuery(e,t){return nv.resolve(this.Lr.get(t))}saveNamedQuery(e,t){return this.Lr.set(t.name,{name:t.name,query:function(e){let t=function(e){var t;let n,r=function(e){let t=iU(e);return 4===t.length?nt.emptyPath():iW(t)}(e.parent),i=e.structuredQuery,s=i.from?i.from.length:0,a=null;if(s>0){tW(1===s,65062);let e=i.from[0];e.allDescendants?a=e.collectionId:r=r.child(e.collectionId)}let o=[];i.where&&(o=function(e){var t;let n=function e(t){return void 0!==t.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":let t=iK(e.unaryFilter.field);return rh.create(t,"==",{doubleValue:NaN});case"IS_NULL":let n=iK(e.unaryFilter.field);return rh.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let r=iK(e.unaryFilter.field);return rh.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let i=iK(e.unaryFilter.field);return rh.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return tq(61313);default:return tq(60726)}}(t):void 0!==t.fieldFilter?rh.create(iK(t.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return tq(58110);default:return tq(50506)}}(t.fieldFilter.op),t.fieldFilter.value):void 0!==t.compositeFilter?rc.create(t.compositeFilter.filters.map(t=>e(t)),function(e){switch(e){case"AND":return"and";case"OR":return"or";default:return tq(1026)}}(t.compositeFilter.op)):tq(30097,{filter:t})}(e);return n instanceof rc&&rf(t=n)&&rd(t)?n.getFilters():[n]}(i.where));let l=[];i.orderBy&&(l=i.orderBy.map(e=>new rl(iK(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))));let u=null;i.limit&&(u=null==(n="object"==typeof(t=i.limit)?t.value:t)?null:n);let h=null;i.startAt&&(h=function(e){let t=!!e.before;return new rs(e.values||[],t)}(i.startAt));let c=null;return i.endAt&&(c=function(e){let t=!e.before;return new rs(e.values||[],t)}(i.endAt)),new rA(r,a,l,o,u,"F",h,c)}({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?rN(t,t.limit,"L"):t}(t.bundledQuery),readTime:iF(t.readTime)}),nv.resolve()}}class sr{constructor(){this.overlays=new nS(ni.comparator),this.kr=new Map}getOverlay(e,t){return nv.resolve(this.overlays.get(t))}getOverlays(e,t){let n=r$();return nv.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&n.set(t,e)})).next(()=>n)}saveOverlays(e,t,n){return n.forEach((n,r)=>{this.wt(e,t,r)}),nv.resolve()}removeOverlaysForBatchId(e,t,n){let r=this.kr.get(n);return void 0!==r&&(r.forEach(e=>this.overlays=this.overlays.remove(e)),this.kr.delete(n)),nv.resolve()}getOverlaysForCollection(e,t,n){let r=r$(),i=t.length+1,s=new ni(t.child("")),a=this.overlays.getIteratorFrom(s);for(;a.hasNext();){let e=a.getNext().value,s=e.getKey();if(!t.isPrefixOf(s.path))break;s.path.length===i&&e.largestBatchId>n&&r.set(e.getKey(),e)}return nv.resolve(r)}getOverlaysForCollectionGroup(e,t,n,r){let i=new nS((e,t)=>e-t),s=this.overlays.getIterator();for(;s.hasNext();){let e=s.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>n){let t=i.get(e.largestBatchId);null===t&&(t=r$(),i=i.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}let a=r$(),o=i.getIterator();for(;o.hasNext()&&(o.getNext().value.forEach((e,t)=>a.set(e,t)),!(a.size()>=r)););return nv.resolve(a)}wt(e,t,n){let r=this.overlays.get(n.key);if(null!==r){let e=this.kr.get(r.largestBatchId).delete(n.key);this.kr.set(r.largestBatchId,e)}this.overlays=this.overlays.insert(n.key,new id(t,n));let i=this.kr.get(t);void 0===i&&(i=rW(),this.kr.set(t,i)),this.kr.set(t,i.add(n.key))}}class si{constructor(){this.sessionToken=nL.EMPTY_BYTE_STRING}getSessionToken(e){return nv.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,nv.resolve()}}class ss{constructor(){this.qr=new nx(sa.Qr),this.$r=new nx(sa.Ur)}isEmpty(){return this.qr.isEmpty()}addReference(e,t){let n=new sa(e,t);this.qr=this.qr.add(n),this.$r=this.$r.add(n)}Kr(e,t){e.forEach(e=>this.addReference(e,t))}removeReference(e,t){this.Wr(new sa(e,t))}Gr(e,t){e.forEach(e=>this.removeReference(e,t))}zr(e){let t=new ni(new nt([])),n=new sa(t,e),r=new sa(t,e+1),i=[];return this.$r.forEachInRange([n,r],e=>{this.Wr(e),i.push(e.key)}),i}jr(){this.qr.forEach(e=>this.Wr(e))}Wr(e){this.qr=this.qr.delete(e),this.$r=this.$r.delete(e)}Jr(e){let t=new ni(new nt([])),n=new sa(t,e),r=new sa(t,e+1),i=rW();return this.$r.forEachInRange([n,r],e=>{i=i.add(e.key)}),i}containsKey(e){let t=new sa(e,0),n=this.qr.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class sa{constructor(e,t){this.key=e,this.Hr=t}static Qr(e,t){return ni.comparator(e.key,t.key)||t5(e.Hr,t.Hr)}static Ur(e,t){return t5(e.Hr,t.Hr)||ni.comparator(e.key,t.key)}}class so{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.er=1,this.Yr=new nx(sa.Qr)}checkEmpty(e){return nv.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,r){let i=this.er;this.er++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let s=new ih(i,t,n,r);for(let t of(this.mutationQueue.push(s),r))this.Yr=this.Yr.add(new sa(t.key,i)),this.indexManager.addToCollectionParentIndex(e,t.key.path.popLast());return nv.resolve(s)}lookupMutationBatch(e,t){return nv.resolve(this.Zr(t))}getNextMutationBatchAfterBatchId(e,t){let n=this.Xr(t+1),r=n<0?0:n;return nv.resolve(this.mutationQueue.length>r?this.mutationQueue[r]:null)}getHighestUnacknowledgedBatchId(){return nv.resolve(0===this.mutationQueue.length?-1:this.er-1)}getAllMutationBatches(e){return nv.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let n=new sa(t,0),r=new sa(t,Number.POSITIVE_INFINITY),i=[];return this.Yr.forEachInRange([n,r],e=>{let t=this.Zr(e.Hr);i.push(t)}),nv.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new nx(t5);return t.forEach(e=>{let t=new sa(e,0),r=new sa(e,Number.POSITIVE_INFINITY);this.Yr.forEachInRange([t,r],e=>{n=n.add(e.Hr)})}),nv.resolve(this.ei(n))}getAllMutationBatchesAffectingQuery(e,t){let n=t.path,r=n.length+1,i=n;ni.isDocumentKey(i)||(i=i.child(""));let s=new sa(new ni(i),0),a=new nx(t5);return this.Yr.forEachWhile(e=>{let t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===r&&(a=a.add(e.Hr)),!0)},s),nv.resolve(this.ei(a))}ei(e){let t=[];return e.forEach(e=>{let n=this.Zr(e);null!==n&&t.push(n)}),t}removeMutationBatch(e,t){tW(0===this.ti(t.batchId,"removed"),55003),this.mutationQueue.shift();let n=this.Yr;return nv.forEach(t.mutations,r=>{let i=new sa(r.key,t.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)}).next(()=>{this.Yr=n})}rr(e){}containsKey(e,t){let n=new sa(t,0),r=this.Yr.firstAfterOrEqual(n);return nv.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return this.mutationQueue.length,nv.resolve()}ti(e,t){return this.Xr(e)}Xr(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Zr(e){let t=this.Xr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class sl{constructor(e){this.ni=e,this.docs=new nS(ni.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let n=t.key,r=this.docs.get(n),i=r?r.size:0,s=this.ni(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:s}),this.size+=s-i,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let n=this.docs.get(t);return nv.resolve(n?n.document.mutableCopy():ri.newInvalidDocument(t))}getEntries(e,t){let n=rV;return t.forEach(e=>{let t=this.docs.get(e);n=n.insert(e,t?t.document.mutableCopy():ri.newInvalidDocument(e))}),nv.resolve(n)}getDocumentsMatchingQuery(e,t,n,r){let i=rV,s=t.path,a=new ni(s.child("__id-9223372036854775808__")),o=this.docs.getIteratorFrom(a);for(;o.hasNext();){let{key:e,value:{document:a}}=o.getNext();if(!s.isPrefixOf(e.path))break;e.path.length>s.length+1||0>=function(e,t){let n=e.readTime.compareTo(t.readTime);return 0!==n||0!==(n=ni.comparator(e.documentKey,t.documentKey))?n:t5(e.largestBatchId,t.largestBatchId)}(new ng(a.readTime,a.key,-1),n)||(r.has(a.key)||rM(t,a))&&(i=i.insert(a.key,a.mutableCopy()))}return nv.resolve(i)}getAllFromCollectionGroup(e,t,n,r){tq(9500)}ri(e,t){return nv.forEach(this.docs,e=>t(e))}newChangeBuffer(e){return new su(this)}getSize(e){return nv.resolve(this.size)}}class su extends i9{constructor(e){super(),this.Or=e}applyChanges(e){let t=[];return this.changes.forEach((n,r)=>{r.isValidDocument()?t.push(this.Or.addEntry(e,r)):this.Or.removeEntry(n)}),nv.waitFor(t)}getFromCache(e,t){return this.Or.getEntry(e,t)}getAllFromCache(e,t){return this.Or.getEntries(e,t)}}class sh{constructor(e){this.persistence=e,this.ii=new rF(e=>rI(e),rS),this.lastRemoteSnapshotVersion=np.min(),this.highestTargetId=0,this.si=0,this.oi=new ss,this.targetCount=0,this._i=i6.ar()}forEachTarget(e,t){return this.ii.forEach((e,n)=>t(n)),nv.resolve()}getLastRemoteSnapshotVersion(e){return nv.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return nv.resolve(this.si)}allocateTargetId(e){return this.highestTargetId=this._i.next(),nv.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.si&&(this.si=t),nv.resolve()}hr(e){this.ii.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this._i=new i6(t),this.highestTargetId=t),e.sequenceNumber>this.si&&(this.si=e.sequenceNumber)}addTargetData(e,t){return this.hr(t),this.targetCount+=1,nv.resolve()}updateTargetData(e,t){return this.hr(t),nv.resolve()}removeTargetData(e,t){return this.ii.delete(t.target),this.oi.zr(t.targetId),this.targetCount-=1,nv.resolve()}removeTargets(e,t,n){let r=0,i=[];return this.ii.forEach((s,a)=>{a.sequenceNumber<=t&&null===n.get(a.targetId)&&(this.ii.delete(s),i.push(this.removeMatchingKeysForTargetId(e,a.targetId)),r++)}),nv.waitFor(i).next(()=>r)}getTargetCount(e){return nv.resolve(this.targetCount)}getTargetData(e,t){let n=this.ii.get(t)||null;return nv.resolve(n)}addMatchingKeys(e,t,n){return this.oi.Kr(t,n),nv.resolve()}removeMatchingKeys(e,t,n){this.oi.Gr(t,n);let r=this.persistence.referenceDelegate,i=[];return r&&t.forEach(t=>{i.push(r.markPotentiallyOrphaned(e,t))}),nv.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.oi.zr(t),nv.resolve()}getMatchingKeysForTargetId(e,t){let n=this.oi.Jr(t);return nv.resolve(n)}containsKey(e,t){return nv.resolve(this.oi.containsKey(t))}}class sc{constructor(e,t){this.ai={},this.overlays={},this.ui=new nb(0),this.ci=!1,this.ci=!0,this.li=new si,this.referenceDelegate=e(this),this.hi=new sh(this),this.indexManager=new iZ,this.remoteDocumentCache=new sl(e=>this.referenceDelegate.Pi(e)),this.serializer=new iY(t),this.Ti=new sn(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.ci=!1,Promise.resolve()}get started(){return this.ci}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new sr,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.ai[e.toKey()];return n||(n=new so(t,this.referenceDelegate),this.ai[e.toKey()]=n),n}getGlobalsCache(){return this.li}getTargetCache(){return this.hi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ti}runTransaction(e,t,n){tB("MemoryPersistence","Starting transaction:",e);let r=new sd(this.ui.next());return this.referenceDelegate.Ii(),n(r).next(e=>this.referenceDelegate.di(r).next(()=>e)).toPromise().then(e=>(r.raiseOnCommittedEvent(),e))}Ei(e,t){return nv.or(Object.values(this.ai).map(n=>()=>n.containsKey(e,t)))}}class sd extends nm{constructor(e){super(),this.currentSequenceNumber=e}}class sf{constructor(e){this.persistence=e,this.Ai=new ss,this.Ri=null}static Vi(e){return new sf(e)}get mi(){if(this.Ri)return this.Ri;throw tq(60996)}addReference(e,t,n){return this.Ai.addReference(n,t),this.mi.delete(n.toString()),nv.resolve()}removeReference(e,t,n){return this.Ai.removeReference(n,t),this.mi.add(n.toString()),nv.resolve()}markPotentiallyOrphaned(e,t){return this.mi.add(t.toString()),nv.resolve()}removeTarget(e,t){this.Ai.zr(t.targetId).forEach(e=>this.mi.add(e.toString()));let n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(e=>{e.forEach(e=>this.mi.add(e.toString()))}).next(()=>n.removeTargetData(e,t))}Ii(){this.Ri=new Set}di(e){let t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return nv.forEach(this.mi,n=>{let r=ni.fromPath(n);return this.fi(e,r).next(e=>{e||t.removeEntry(r,np.min())})}).next(()=>(this.Ri=null,t.apply(e)))}updateLimboDocument(e,t){return this.fi(e,t).next(e=>{e?this.mi.delete(t.toString()):this.mi.add(t.toString())})}Pi(e){return 0}fi(e,t){return nv.or([()=>nv.resolve(this.Ai.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ei(e,t)])}}class sp{constructor(e,t){this.persistence=e,this.gi=new rF(e=>(function(e){let t="";for(let n=0;n<e.length;n++)t.length>0&&(t+="\x01\x01"),t=function(e,t){let n=t,r=e.length;for(let t=0;t<r;t++){let r=e.charAt(t);switch(r){case"\0":n+="\x01\x10";break;case"\x01":n+="\x01\x11";break;default:n+=r}}return n}(e.get(n),t);return t+"\x01\x01"})(e.path),(e,t)=>e.isEqual(t)),this.garbageCollector=new i7(this,t)}static Vi(e,t){return new sp(e,t)}Ii(){}di(e){return nv.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}mr(e){let t=this.yr(e);return this.persistence.getTargetCache().getTargetCount(e).next(e=>t.next(t=>e+t))}yr(e){let t=0;return this.gr(e,e=>{t++}).next(()=>t)}gr(e,t){return nv.forEach(this.gi,(n,r)=>this.Sr(e,n,r).next(e=>e?nv.resolve():t(r)))}removeTargets(e,t,n){return this.persistence.getTargetCache().removeTargets(e,t,n)}removeOrphanedDocuments(e,t){let n=0,r=this.persistence.getRemoteDocumentCache(),i=r.newChangeBuffer();return r.ri(e,r=>this.Sr(e,r,t).next(e=>{e||(n++,i.removeEntry(r,np.min()))})).next(()=>i.apply(e)).next(()=>n)}markPotentiallyOrphaned(e,t){return this.gi.set(t,e.currentSequenceNumber),nv.resolve()}removeTarget(e,t){let n=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,n)}addReference(e,t,n){return this.gi.set(n,e.currentSequenceNumber),nv.resolve()}removeReference(e,t,n){return this.gi.set(n,e.currentSequenceNumber),nv.resolve()}updateLimboDocument(e,t){return this.gi.set(t,e.currentSequenceNumber),nv.resolve()}Pi(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=function e(t){switch(nJ(t)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:let n=n$(t);return n?16+e(n):16;case 5:return 2*t.stringValue.length;case 6:return nP(t.bytesValue).approximateByteSize();case 7:return t.referenceValue.length;case 9:return(t.arrayValue.values||[]).reduce((t,n)=>t+e(n),0);case 10:case 11:var r;let i;return r=t.mapValue,i=0,n_(r.fields,(t,n)=>{i+=t.length+e(n)}),i;default:throw tq(13486,{value:t})}}(e.data.value)),t}Sr(e,t,n){return nv.or([()=>this.persistence.Ei(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{let e=this.gi.get(t);return nv.resolve(void 0!==e&&e>n)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class sg{constructor(e,t,n,r){this.targetId=e,this.fromCache=t,this.Is=n,this.ds=r}static Es(e,t){let n=rW(),r=rW();for(let e of t.docChanges)switch(e.type){case 0:n=n.add(e.doc.key);break;case 1:r=r.add(e.doc.key)}return new sg(e,t.fromCache,n,r)}}class sm{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class sy{constructor(){this.As=!1,this.Rs=!1,this.Vs=100,this.fs=!function(){var e;let t=null==(e=$())?void 0:e.forceEnvironment;if("node"===t)return!0;if("browser"===t)return!1;try{return"[object process]"===Object.prototype.toString.call(S.process)}catch(e){return!1}}()&&navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")?8:function(e){let t=e.match(/Android ([\d.]+)/i);return Number(t?t[1].split(".").slice(0,2).join("."):"-1")}("undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:"")>0?6:4}initialize(e,t){this.gs=e,this.indexManager=t,this.As=!0}getDocumentsMatchingQuery(e,t,n,r){let i={result:null};return this.ps(e,t).next(e=>{i.result=e}).next(()=>{if(!i.result)return this.ys(e,t,r,n).next(e=>{i.result=e})}).next(()=>{if(i.result)return;let n=new sm;return this.ws(e,t,n).next(r=>{if(i.result=r,this.Rs)return this.Ss(e,t,n,r.size)})}).next(()=>i.result)}Ss(e,t,n,r){return n.documentReadCount<this.Vs?(tV()<=o.DEBUG&&tB("QueryEngine","SDK will not create cache indexes for query:",rO(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Vs,"documents"),nv.resolve()):(tV()<=o.DEBUG&&tB("QueryEngine","Query:",rO(t),"scans",n.documentReadCount,"local documents and returns",r,"documents as results."),n.documentReadCount>this.fs*r?(tV()<=o.DEBUG&&tB("QueryEngine","The SDK decides to create cache indexes for query:",rO(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,rk(t))):nv.resolve())}ps(e,t){if(rx(t))return nv.resolve(null);let n=rk(t);return this.indexManager.getIndexType(e,n).next(r=>0===r?null:(null!==t.limit&&1===r&&(n=rk(t=rN(t,null,"F"))),this.indexManager.getDocumentsMatchingTarget(e,n).next(r=>{let i=rW(...r);return this.gs.getDocuments(e,i).next(r=>this.indexManager.getMinOffset(e,n).next(n=>{let s=this.bs(t,r);return this.Ds(t,s,i,n.readTime)?this.ps(e,rN(t,null,"F")):this.vs(e,s,t,n)}))})))}ys(e,t,n,r){return rx(t)||r.isEqual(np.min())?nv.resolve(null):this.gs.getDocuments(e,n).next(i=>{let s=this.bs(t,i);return this.Ds(t,s,n,r)?nv.resolve(null):(tV()<=o.DEBUG&&tB("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),rO(t)),this.vs(e,s,t,function(e,t){let n=e.toTimestamp().seconds,r=e.toTimestamp().nanoseconds+1;return new ng(np.fromTimestamp(1e9===r?new nf(n+1,0):new nf(n,r)),ni.empty(),-1)}(r,0)).next(e=>e))})}bs(e,t){let n=new nx(rP(e));return t.forEach((t,r)=>{rM(e,r)&&(n=n.add(r))}),n}Ds(e,t,n,r){if(null===e.limit)return!1;if(n.size!==t.size)return!0;let i="F"===e.limitType?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)}ws(e,t,n){return tV()<=o.DEBUG&&tB("QueryEngine","Using full collection scan to execute query:",rO(t)),this.gs.getDocumentsMatchingQuery(e,t,ng.min(),n)}vs(e,t,n,r){return this.gs.getDocumentsMatchingQuery(e,n,r).next(e=>(t.forEach(t=>{e=e.insert(t.key,t)}),e))}}const sv="LocalStore";class sw{constructor(e,t,n,r){this.persistence=e,this.Cs=t,this.serializer=r,this.Fs=new nS(t5),this.Ms=new rF(e=>rI(e),rS),this.xs=new Map,this.Os=e.getRemoteDocumentCache(),this.hi=e.getTargetCache(),this.Ti=e.getBundleCache(),this.Ns(n)}Ns(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new st(this.Os,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Os.setIndexManager(this.indexManager),this.Cs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.Fs))}}async function sb(e,t){return await e.persistence.runTransaction("Handle user change","readonly",n=>{let r;return e.mutationQueue.getAllMutationBatches(n).next(i=>(r=i,e.Ns(t),e.mutationQueue.getAllMutationBatches(n))).next(t=>{let i=[],s=[],a=rW();for(let e of r)for(let t of(i.push(e.batchId),e.mutations))a=a.add(t.key);for(let e of t)for(let t of(s.push(e.batchId),e.mutations))a=a.add(t.key);return e.localDocuments.getDocuments(n,a).next(e=>({Bs:e,removedBatchIds:i,addedBatchIds:s}))})})}function sE(e){return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.hi.getLastRemoteSnapshotVersion(t))}async function sT(e,t,n){let r=e.Fs.get(t);try{n||await e.persistence.runTransaction("Release target",n?"readwrite":"readwrite-primary",t=>e.persistence.referenceDelegate.removeTarget(t,r))}catch(e){if(!nw(e))throw e;tB(sv,`Failed to update sequence numbers for target ${t}: ${e}`)}e.Fs=e.Fs.remove(t),e.Ms.delete(r.target)}function s_(e,t,n){let r=np.min(),i=rW();return e.persistence.runTransaction("Execute query","readwrite",s=>(function(e,t,n){let r=e.Ms.get(n);return void 0!==r?nv.resolve(e.Fs.get(r)):e.hi.getTargetData(t,n)})(e,s,rk(t)).next(t=>{if(t)return r=t.lastLimboFreeSnapshotVersion,e.hi.getMatchingKeysForTargetId(s,t.targetId).next(e=>{i=e})}).next(()=>e.Cs.getDocumentsMatchingQuery(s,t,n?r:np.min(),n?i:rW())).next(n=>{var r,s,a;let o;return r=e,s=t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2)),a=n,o=r.xs.get(s)||np.min(),a.forEach((e,t)=>{t.readTime.compareTo(o)>0&&(o=t.readTime)}),r.xs.set(s,o),{documents:n,qs:i}}))}class sI{constructor(){this.activeTargetIds=rH}Gs(e){this.activeTargetIds=this.activeTargetIds.add(e)}zs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Ws(){return JSON.stringify({activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()})}}class sS{constructor(){this.Fo=new sI,this.Mo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e,t=!0){return t&&this.Fo.Gs(e),this.Mo[e]||"not-current"}updateQueryState(e,t,n){this.Mo[e]=t}removeLocalQueryTarget(e){this.Fo.zs(e)}isLocalQueryTarget(e){return this.Fo.activeTargetIds.has(e)}clearQueryState(e){delete this.Mo[e]}getAllActiveQueryTargets(){return this.Fo.activeTargetIds}isActiveQueryTarget(e){return this.Fo.activeTargetIds.has(e)}start(){return this.Fo=new sI,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class sC{xo(e){}shutdown(){}}const sA="ConnectivityMonitor";class sx{constructor(){this.Oo=()=>this.No(),this.Bo=()=>this.Lo(),this.ko=[],this.qo()}xo(e){this.ko.push(e)}shutdown(){window.removeEventListener("online",this.Oo),window.removeEventListener("offline",this.Bo)}qo(){window.addEventListener("online",this.Oo),window.addEventListener("offline",this.Bo)}No(){for(let e of(tB(sA,"Network connectivity changed: AVAILABLE"),this.ko))e(0)}Lo(){for(let e of(tB(sA,"Network connectivity changed: UNAVAILABLE"),this.ko))e(1)}static C(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let sD=null;function sk(){return null===sD?sD=0x10000000+Math.round(0x80000000*Math.random()):sD++,"0x"+sD.toString(16)}const sN="RestConnection",sL={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class sR{get Qo(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;let t=e.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),r=encodeURIComponent(this.databaseId.database);this.$o=t+"://"+e.host,this.Uo=`projects/${n}/databases/${r}`,this.Ko=this.databaseId.database===nW?`project_id=${n}`:`project_id=${n}&database_id=${r}`}Wo(e,t,n,r,i){let s=sk(),a=this.Go(e,t.toUriEncodedString());tB(sN,`Sending RPC '${e}' ${s}:`,a,n);let o={"google-cloud-resource-prefix":this.Uo,"x-goog-request-params":this.Ko};this.zo(o,r,i);let{host:l}=new URL(a),u=G(l);return this.jo(e,a,o,n,u).then(t=>(tB(sN,`Received RPC '${e}' ${s}: `,t),t),t=>{throw tj(sN,`RPC '${e}' ${s} failed with error: `,t,"url: ",a,"request:",n),t})}Jo(e,t,n,r,i,s){return this.Wo(e,t,n,r,i)}zo(e,t,n){e["X-Goog-Api-Client"]="gl-js/ fire/"+tP,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((t,n)=>e[n]=t),n&&n.headers.forEach((t,n)=>e[n]=t)}Go(e,t){let n=sL[e];return`${this.$o}/v1/${t}:${n}`}terminate(){}}class sO{constructor(e){this.Ho=e.Ho,this.Yo=e.Yo}Zo(e){this.Xo=e}e_(e){this.t_=e}n_(e){this.r_=e}onMessage(e){this.i_=e}close(){this.Yo()}send(e){this.Ho(e)}s_(){this.Xo()}o_(){this.t_()}__(e){this.r_(e)}a_(e){this.i_(e)}}const sM="WebChannelConnection";class sP extends sR{constructor(e){super(e),this.u_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}jo(e,t,n,r,i){let s=sk();return new Promise((i,a)=>{let o=new h;o.setWithCredentials(!0),o.listenOnce(d.COMPLETE,()=>{try{switch(o.getLastErrorCode()){case f.NO_ERROR:let t=o.getResponseJson();tB(sM,`XHR for RPC '${e}' ${s} received:`,JSON.stringify(t)),i(t);break;case f.TIMEOUT:tB(sM,`RPC '${e}' ${s} timed out`),a(new tG(tH.DEADLINE_EXCEEDED,"Request time out"));break;case f.HTTP_ERROR:let n=o.getStatus();if(tB(sM,`RPC '${e}' ${s} failed with status:`,n,"response text:",o.getResponseText()),n>0){let e=o.getResponseJson();Array.isArray(e)&&(e=e[0]);let t=null==e?void 0:e.error;if(t&&t.status&&t.message){let e=function(e){let t=e.toLowerCase().replace(/_/g,"-");return Object.values(tH).indexOf(t)>=0?t:tH.UNKNOWN}(t.status);a(new tG(e,t.message))}else a(new tG(tH.UNKNOWN,"Server responded with status "+o.getStatus()))}else a(new tG(tH.UNAVAILABLE,"Connection failed."));break;default:tq(9055,{c_:e,streamId:s,l_:o.getLastErrorCode(),h_:o.getLastError()})}}finally{tB(sM,`RPC '${e}' ${s} completed.`)}});let l=JSON.stringify(r);tB(sM,`RPC '${e}' ${s} sending request:`,r),o.send(t,"POST",l,n,15)})}P_(e,t,n){let r=sk(),i=[this.$o,"/","google.firestore.v1.Firestore","/",e,"/channel"],s=y(),a=m(),o={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},l=this.longPollingOptions.timeoutSeconds;void 0!==l&&(o.longPollingTimeout=Math.round(1e3*l)),this.useFetchStreams&&(o.useFetchStreams=!0),this.zo(o.initMessageHeaders,t,n),o.encodeInitMessageHeaders=!0;let u=i.join("");tB(sM,`Creating RPC '${e}' stream ${r}: ${u}`,o);let h=s.createWebChannel(u,o);this.T_(h);let d=!1,f=!1,v=new sO({Ho:t=>{f?tB(sM,`Not sending because RPC '${e}' stream ${r} is closed:`,t):(d||(tB(sM,`Opening RPC '${e}' stream ${r} transport.`),h.open(),d=!0),tB(sM,`RPC '${e}' stream ${r} sending:`,t),h.send(t))},Yo:()=>h.close()}),w=(e,t,n)=>{e.listen(t,e=>{try{n(e)}catch(e){setTimeout(()=>{throw e},0)}})};return w(h,c.EventType.OPEN,()=>{f||(tB(sM,`RPC '${e}' stream ${r} transport opened.`),v.s_())}),w(h,c.EventType.CLOSE,()=>{f||(f=!0,tB(sM,`RPC '${e}' stream ${r} transport closed`),v.__(),this.I_(h))}),w(h,c.EventType.ERROR,t=>{f||(f=!0,tj(sM,`RPC '${e}' stream ${r} transport errored. Name:`,t.name,"Message:",t.message),v.__(new tG(tH.UNAVAILABLE,"The operation could not be completed")))}),w(h,c.EventType.MESSAGE,t=>{var n;if(!f){let i=t.data[0];tW(!!i,16349);let s=(null==i?void 0:i.error)||(null==(n=i[0])?void 0:n.error);if(s){tB(sM,`RPC '${e}' stream ${r} received error:`,s);let t=s.status,n=function(e){let t=E[e];if(void 0!==t)return ig(t)}(t),i=s.message;void 0===n&&(n=tH.INTERNAL,i="Unknown error status: "+t+" with message "+s.message),f=!0,v.__(new tG(n,i)),h.close()}else tB(sM,`RPC '${e}' stream ${r} received:`,i),v.a_(i)}}),w(a,g.STAT_EVENT,t=>{t.stat===p.PROXY?tB(sM,`RPC '${e}' stream ${r} detected buffering proxy`):t.stat===p.NOPROXY&&tB(sM,`RPC '${e}' stream ${r} detected no buffering proxy`)}),setTimeout(()=>{v.o_()},0),v}terminate(){this.u_.forEach(e=>e.close()),this.u_=[]}T_(e){this.u_.push(e)}I_(e){this.u_=this.u_.filter(t=>t===e)}}function sF(){return"undefined"!=typeof document?document:null}function sV(e){return new iR(e,!0)}class sB{constructor(e,t,n=1e3,r=1.5,i=6e4){this.Fi=e,this.timerId=t,this.d_=n,this.E_=r,this.A_=i,this.R_=0,this.V_=null,this.m_=Date.now(),this.reset()}reset(){this.R_=0}f_(){this.R_=this.A_}g_(e){this.cancel();let t=Math.floor(this.R_+this.p_()),n=Math.max(0,Date.now()-this.m_),r=Math.max(0,t-n);r>0&&tB("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.R_} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.V_=this.Fi.enqueueAfterDelay(this.timerId,r,()=>(this.m_=Date.now(),e())),this.R_*=this.E_,this.R_<this.d_&&(this.R_=this.d_),this.R_>this.A_&&(this.R_=this.A_)}y_(){null!==this.V_&&(this.V_.skipDelay(),this.V_=null)}cancel(){null!==this.V_&&(this.V_.cancel(),this.V_=null)}p_(){return(Math.random()-.5)*this.R_}}const sU="PersistentStream";class sj{constructor(e,t,n,r,i,s,a,o){this.Fi=e,this.w_=n,this.S_=r,this.connection=i,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=a,this.listener=o,this.state=0,this.b_=0,this.D_=null,this.v_=null,this.stream=null,this.C_=0,this.F_=new sB(e,t)}M_(){return 1===this.state||5===this.state||this.x_()}x_(){return 2===this.state||3===this.state}start(){this.C_=0,4!==this.state?this.auth():this.O_()}async stop(){this.M_()&&await this.close(0)}N_(){this.state=0,this.F_.reset()}B_(){this.x_()&&null===this.D_&&(this.D_=this.Fi.enqueueAfterDelay(this.w_,6e4,()=>this.L_()))}k_(e){this.q_(),this.stream.send(e)}async L_(){if(this.x_())return this.close(0)}q_(){this.D_&&(this.D_.cancel(),this.D_=null)}Q_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.q_(),this.Q_(),this.F_.cancel(),this.b_++,4!==e?this.F_.reset():t&&t.code===tH.RESOURCE_EXHAUSTED?(tU(t.toString()),tU("Using maximum backoff delay to prevent overloading the backend."),this.F_.f_()):t&&t.code===tH.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.U_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.n_(t)}U_(){}auth(){this.state=1;let e=this.K_(this.b_),t=this.b_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([e,n])=>{this.b_===t&&this.W_(e,n)},t=>{e(()=>{let e=new tG(tH.UNKNOWN,"Fetching auth token failed: "+t.message);return this.G_(e)})})}W_(e,t){let n=this.K_(this.b_);this.stream=this.z_(e,t),this.stream.Zo(()=>{n(()=>this.listener.Zo())}),this.stream.e_(()=>{n(()=>(this.state=2,this.v_=this.Fi.enqueueAfterDelay(this.S_,1e4,()=>(this.x_()&&(this.state=3),Promise.resolve())),this.listener.e_()))}),this.stream.n_(e=>{n(()=>this.G_(e))}),this.stream.onMessage(e=>{n(()=>1==++this.C_?this.j_(e):this.onNext(e))})}O_(){this.state=5,this.F_.g_(async()=>{this.state=0,this.start()})}G_(e){return tB(sU,`close with error: ${e}`),this.stream=null,this.close(4,e)}K_(e){return t=>{this.Fi.enqueueAndForget(()=>this.b_===e?t():(tB(sU,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class s$ extends sj{constructor(e,t,n,r,i,s){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,r,s),this.serializer=i}z_(e,t){return this.connection.P_("Listen",e,t)}j_(e){return this.onNext(e)}onNext(e){this.F_.reset();let t=function(e,t){let n;if("targetChange"in t){var r,i;t.targetChange;let s="NO_CHANGE"===(r=t.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===r?1:"REMOVE"===r?2:"CURRENT"===r?3:"RESET"===r?4:tq(39313,{state:r}),a=t.targetChange.targetIds||[],o=(i=t.targetChange.resumeToken,e.useProto3Json?(tW(void 0===i||"string"==typeof i,58123),nL.fromBase64String(i||"")):(tW(void 0===i||i instanceof e9||i instanceof Uint8Array,16193),nL.fromUint8Array(i||new Uint8Array))),l=t.targetChange.cause;n=new iS(s,a,o,l&&new tG(void 0===l.code?tH.UNKNOWN:ig(l.code),l.message||"")||null)}else if("documentChange"in t){t.documentChange;let r=t.documentChange;r.document,r.document.name,r.document.updateTime;let i=i$(e,r.document.name),s=iF(r.document.updateTime),a=r.document.createTime?iF(r.document.createTime):np.min(),o=new rr({mapValue:{fields:r.document.fields}}),l=ri.newFoundDocument(i,s,a,o);n=new i_(r.targetIds||[],r.removedTargetIds||[],l.key,l)}else if("documentDelete"in t){t.documentDelete;let r=t.documentDelete;r.document;let i=i$(e,r.document),s=r.readTime?iF(r.readTime):np.min(),a=ri.newNoDocument(i,s);n=new i_([],r.removedTargetIds||[],a.key,a)}else if("documentRemove"in t){t.documentRemove;let r=t.documentRemove;r.document;let i=i$(e,r.document);n=new i_([],r.removedTargetIds||[],i,null)}else{if(!("filter"in t))return tq(11601,{At:t});{t.filter;let e=t.filter;e.targetId;let{count:r=0,unchangedNames:i}=e,s=new ip(r,i);n=new iI(e.targetId,s)}}return n}(this.serializer,e),n=function(e){if(!("targetChange"in e))return np.min();let t=e.targetChange;return t.targetIds&&t.targetIds.length?np.min():t.readTime?iF(t.readTime):np.min()}(e);return this.listener.J_(t,n)}H_(e){let t={};t.database=iz(this.serializer),t.addTarget=function(e,t){let n,r=t.target;if((n=rC(r)?{documents:{documents:[iq(e,r.path)]}}:{query:function(e,t){var n,r;let i,s={structuredQuery:{}},a=t.path;null!==t.collectionGroup?(i=a,s.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(i=a.popLast(),s.structuredQuery.from=[{collectionId:a.lastSegment()}]),s.parent=iq(e,i);let o=function(e){if(0!==e.length)return function e(t){return t instanceof rh?function(e){if("=="===e.op){if(n7(e.value))return{unaryFilter:{field:iG(e.field),op:"IS_NAN"}};if(n8(e.value))return{unaryFilter:{field:iG(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(n7(e.value))return{unaryFilter:{field:iG(e.field),op:"IS_NOT_NAN"}};if(n8(e.value))return{unaryFilter:{field:iG(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:iG(e.field),op:iN[e.op],value:e.value}}}(t):t instanceof rc?function(t){let n=t.getFilters().map(t=>e(t));return 1===n.length?n[0]:{compositeFilter:{op:iL[t.op],filters:n}}}(t):tq(54877,{filter:t})}(rc.create(e,"and"))}(t.filters);o&&(s.structuredQuery.where=o);let l=function(e){if(0!==e.length)return e.map(e=>({field:iG(e.field),direction:ik[e.dir]}))}(t.orderBy);l&&(s.structuredQuery.orderBy=l);let u=iO(e,t.limit);return null!==u&&(s.structuredQuery.limit=u),t.startAt&&(s.structuredQuery.startAt={before:(n=t.startAt).inclusive,values:n.position}),t.endAt&&(s.structuredQuery.endAt={before:!(r=t.endAt).inclusive,values:r.position}),{Vt:s,parent:i}}(e,r).Vt}).targetId=t.targetId,t.resumeToken.approximateByteSize()>0){n.resumeToken=iP(e,t.resumeToken);let r=iO(e,t.expectedCount);null!==r&&(n.expectedCount=r)}else if(t.snapshotVersion.compareTo(np.min())>0){n.readTime=iM(e,t.snapshotVersion.toTimestamp());let r=iO(e,t.expectedCount);null!==r&&(n.expectedCount=r)}return n}(this.serializer,e);let n=function(e,t){let n=function(e){switch(e){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return tq(28987,{purpose:e})}}(t.purpose);return null==n?null:{"goog-listen-tags":n}}(this.serializer,e);n&&(t.labels=n),this.k_(t)}Y_(e){let t={};t.database=iz(this.serializer),t.removeTarget=e,this.k_(t)}}class sq extends sj{constructor(e,t,n,r,i,s){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,r,s),this.serializer=i}get Z_(){return this.C_>0}start(){this.lastStreamToken=void 0,super.start()}U_(){this.Z_&&this.X_([])}z_(e,t){return this.connection.P_("Write",e,t)}j_(e){return tW(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,tW(!e.writeResults||0===e.writeResults.length,55816),this.listener.ea()}onNext(e){var t,n;tW(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.F_.reset();let r=(t=e.writeResults,n=e.commitTime,t&&t.length>0?(tW(void 0!==n,14353),t.map(e=>{let t;return(t=e.updateTime?iF(e.updateTime):iF(n)).isEqual(np.min())&&(t=iF(n)),new r5(t,e.transformResults||[])})):[]),i=iF(e.commitTime);return this.listener.ta(i,r)}na(){let e={};e.database=iz(this.serializer),this.k_(e)}X_(e){let t={streamToken:this.lastStreamToken,writes:e.map(e=>(function(e,t){var n;let r;if(t instanceof ir)r={update:iH(e,t.key,t.value)};else if(t instanceof il)r={delete:ij(e,t.key)};else if(t instanceof ii)r={update:iH(e,t.key,t.data),updateMask:function(e){let t=[];return e.fields.forEach(e=>t.push(e.canonicalString())),{fieldPaths:t}}(t.fieldMask)};else{if(!(t instanceof iu))return tq(16599,{Rt:t.type});r={verify:ij(e,t.key)}}return t.fieldTransforms.length>0&&(r.updateTransforms=t.fieldTransforms.map(e=>(function(e,t){let n=t.transform;if(n instanceof rY)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof rJ)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof r0)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof r2)return{fieldPath:t.field.canonicalString(),increment:n.Ee};throw tq(20930,{transform:t.transform})})(0,e))),t.precondition.isNone||(r.currentDocument=void 0!==(n=t.precondition).updateTime?{updateTime:iM(e,n.updateTime.toTimestamp())}:void 0!==n.exists?{exists:n.exists}:tq(27497)),r})(this.serializer,e))};this.k_(t)}}class sz{}class sW extends sz{constructor(e,t,n,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=r,this.ra=!1}ia(){if(this.ra)throw new tG(tH.FAILED_PRECONDITION,"The client has already been terminated.")}Wo(e,t,n,r){return this.ia(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,s])=>this.connection.Wo(e,iB(t,n),r,i,s)).catch(e=>{throw"FirebaseError"===e.name?(e.code===tH.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new tG(tH.UNKNOWN,e.toString())})}Jo(e,t,n,r,i){return this.ia(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,a])=>this.connection.Jo(e,iB(t,n),r,s,a,i)).catch(e=>{throw"FirebaseError"===e.name?(e.code===tH.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new tG(tH.UNKNOWN,e.toString())})}terminate(){this.ra=!0,this.connection.terminate()}}class sH{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.sa=0,this.oa=null,this._a=!0}aa(){0===this.sa&&(this.ua("Unknown"),this.oa=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.oa=null,this.ca("Backend didn't respond within 10 seconds."),this.ua("Offline"),Promise.resolve())))}la(e){"Online"===this.state?this.ua("Unknown"):(this.sa++,this.sa>=1&&(this.ha(),this.ca(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ua("Offline")))}set(e){this.ha(),this.sa=0,"Online"===e&&(this._a=!1),this.ua(e)}ua(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}ca(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this._a?(tU(t),this._a=!1):tB("OnlineStateTracker",t)}ha(){null!==this.oa&&(this.oa.cancel(),this.oa=null)}}const sG="RemoteStore";class sK{constructor(e,t,n,r,i){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.Pa=[],this.Ta=new Map,this.Ia=new Set,this.da=[],this.Ea=i,this.Ea.xo(e=>{n.enqueueAndForget(async()=>{s6(this)&&(tB(sG,"Restarting streams for network reachability change."),await async function(e){e.Ia.add(4),await sX(e),e.Aa.set("Unknown"),e.Ia.delete(4),await sQ(e)}(this))})}),this.Aa=new sH(n,r)}}async function sQ(e){if(s6(e))for(let t of e.da)await t(!0)}async function sX(e){for(let t of e.da)await t(!1)}function sY(e,t){e.Ta.has(t.targetId)||(e.Ta.set(t.targetId,t),s2(e)?s1(e):au(e).x_()&&sZ(e,t))}function sJ(e,t){let n=au(e);e.Ta.delete(t),n.x_()&&s0(e,t),0===e.Ta.size&&(n.x_()?n.B_():s6(e)&&e.Aa.set("Unknown"))}function sZ(e,t){if(e.Ra.$e(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(np.min())>0){let n=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(n)}au(e).H_(t)}function s0(e,t){e.Ra.$e(t),au(e).Y_(t)}function s1(e){e.Ra=new iA({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),Et:t=>e.Ta.get(t)||null,lt:()=>e.datastore.serializer.databaseId}),au(e).start(),e.Aa.aa()}function s2(e){return s6(e)&&!au(e).M_()&&e.Ta.size>0}function s6(e){return 0===e.Ia.size}async function s3(e){e.Aa.set("Online")}async function s5(e){e.Ta.forEach((t,n)=>{sZ(e,t)})}async function s4(e,t){e.Ra=void 0,s2(e)?(e.Aa.la(t),s1(e)):e.Aa.set("Unknown")}async function s8(e,t,n){if(e.Aa.set("Online"),t instanceof iS&&2===t.state&&t.cause)try{await async function(e,t){let n=t.cause;for(let r of t.targetIds)e.Ta.has(r)&&(await e.remoteSyncer.rejectListen(r,n),e.Ta.delete(r),e.Ra.removeTarget(r))}(e,t)}catch(n){tB(sG,"Failed to remove targets %s: %s ",t.targetIds.join(","),n),await s7(e,n)}else if(t instanceof i_?e.Ra.Ye(t):t instanceof iI?e.Ra.it(t):e.Ra.et(t),!n.isEqual(np.min()))try{let t=await sE(e.localStore);n.compareTo(t)>=0&&await function(e,t){let n=e.Ra.Pt(t);return n.targetChanges.forEach((n,r)=>{if(n.resumeToken.approximateByteSize()>0){let i=e.Ta.get(r);i&&e.Ta.set(r,i.withResumeToken(n.resumeToken,t))}}),n.targetMismatches.forEach((t,n)=>{let r=e.Ta.get(t);if(!r)return;e.Ta.set(t,r.withResumeToken(nL.EMPTY_BYTE_STRING,r.snapshotVersion)),s0(e,t);let i=new iX(r.target,t,n,r.sequenceNumber);sZ(e,i)}),e.remoteSyncer.applyRemoteEvent(n)}(e,n)}catch(t){tB(sG,"Failed to raise snapshot:",t),await s7(e,t)}}async function s7(e,t,n){if(!nw(t))throw t;e.Ia.add(1),await sX(e),e.Aa.set("Offline"),n||(n=()=>sE(e.localStore)),e.asyncQueue.enqueueRetryable(async()=>{tB(sG,"Retrying IndexedDB access"),await n(),e.Ia.delete(1),await sQ(e)})}function s9(e,t){return t().catch(n=>s7(e,n,t))}async function ae(e){var t;let n=ah(e),r=e.Pa.length>0?e.Pa[e.Pa.length-1].batchId:-1;for(;s6(t=e)&&t.Pa.length<10;)try{let t=await function(e,t){return e.persistence.runTransaction("Get next mutation batch","readonly",n=>(void 0===t&&(t=-1),e.mutationQueue.getNextMutationBatchAfterBatchId(n,t)))}(e.localStore,r);if(null===t){0===e.Pa.length&&n.B_();break}r=t.batchId,function(e,t){e.Pa.push(t);let n=ah(e);n.x_()&&n.Z_&&n.X_(t.mutations)}(e,t)}catch(t){await s7(e,t)}at(e)&&an(e)}function at(e){return s6(e)&&!ah(e).M_()&&e.Pa.length>0}function an(e){ah(e).start()}async function ar(e){ah(e).na()}async function ai(e){let t=ah(e);for(let n of e.Pa)t.X_(n.mutations)}async function as(e,t,n){let r=e.Pa.shift(),i=ic.from(r,t,n);await s9(e,()=>e.remoteSyncer.applySuccessfulWrite(i)),await ae(e)}async function aa(e,t){t&&ah(e).Z_&&await async function(e,t){var n;if(function(e){switch(e){case tH.OK:return tq(64938);case tH.CANCELLED:case tH.UNKNOWN:case tH.DEADLINE_EXCEEDED:case tH.RESOURCE_EXHAUSTED:case tH.INTERNAL:case tH.UNAVAILABLE:case tH.UNAUTHENTICATED:return!1;case tH.INVALID_ARGUMENT:case tH.NOT_FOUND:case tH.ALREADY_EXISTS:case tH.PERMISSION_DENIED:case tH.FAILED_PRECONDITION:case tH.ABORTED:case tH.OUT_OF_RANGE:case tH.UNIMPLEMENTED:case tH.DATA_LOSS:return!0;default:return tq(15467,{code:e})}}(n=t.code)&&n!==tH.ABORTED){let n=e.Pa.shift();ah(e).N_(),await s9(e,()=>e.remoteSyncer.rejectFailedWrite(n.batchId,t)),await ae(e)}}(e,t),at(e)&&an(e)}async function ao(e,t){e.asyncQueue.verifyOperationInProgress(),tB(sG,"RemoteStore received new credentials");let n=s6(e);e.Ia.add(3),await sX(e),n&&e.Aa.set("Unknown"),await e.remoteSyncer.handleCredentialChange(t),e.Ia.delete(3),await sQ(e)}async function al(e,t){t?(e.Ia.delete(2),await sQ(e)):t||(e.Ia.add(2),await sX(e),e.Aa.set("Unknown"))}function au(e){var t,n,r;return e.Va||(t=e.datastore,n=e.asyncQueue,r={Zo:s3.bind(null,e),e_:s5.bind(null,e),n_:s4.bind(null,e),J_:s8.bind(null,e)},t.ia(),e.Va=new s$(n,t.connection,t.authCredentials,t.appCheckCredentials,t.serializer,r),e.da.push(async t=>{t?(e.Va.N_(),s2(e)?s1(e):e.Aa.set("Unknown")):(await e.Va.stop(),e.Ra=void 0)})),e.Va}function ah(e){var t,n,r;return e.ma||(t=e.datastore,n=e.asyncQueue,r={Zo:()=>Promise.resolve(),e_:ar.bind(null,e),n_:aa.bind(null,e),ea:ai.bind(null,e),ta:as.bind(null,e)},t.ia(),e.ma=new sq(n,t.connection,t.authCredentials,t.appCheckCredentials,t.serializer,r),e.da.push(async t=>{t?(e.ma.N_(),await ae(e)):(await e.ma.stop(),e.Pa.length>0&&(tB(sG,`Stopping write stream with ${e.Pa.length} pending writes`),e.Pa=[]))})),e.ma}class ac{constructor(e,t,n,r,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new tK,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(e=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,r,i){let s=new ac(e,t,Date.now()+n,r,i);return s.start(n),s}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new tG(tH.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function ad(e,t){if(tU("AsyncQueue",`${t}: ${e}`),nw(e))return new tG(tH.UNAVAILABLE,`${t}: ${e}`);throw e}class af{static emptySet(e){return new af(e.comparator)}constructor(e){this.comparator=e?(t,n)=>e(t,n)||ni.comparator(t.key,n.key):(e,t)=>ni.comparator(e.key,t.key),this.keyedMap=rU(),this.sortedSet=new nS(this.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,n)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof af)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){let e=t.getNext().key,r=n.getNext().key;if(!e.isEqual(r))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){let n=new af;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class ap{constructor(){this.fa=new nS(ni.comparator)}track(e){let t=e.doc.key,n=this.fa.get(t);n?0!==e.type&&3===n.type?this.fa=this.fa.insert(t,e):3===e.type&&1!==n.type?this.fa=this.fa.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.fa=this.fa.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.fa=this.fa.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.fa=this.fa.remove(t):1===e.type&&2===n.type?this.fa=this.fa.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.fa=this.fa.insert(t,{type:2,doc:e.doc}):tq(63341,{At:e,ga:n}):this.fa=this.fa.insert(t,e)}pa(){let e=[];return this.fa.inorderTraversal((t,n)=>{e.push(n)}),e}}class ag{constructor(e,t,n,r,i,s,a,o,l){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=s,this.syncStateChanged=a,this.excludesMetadataChanges=o,this.hasCachedResults=l}static fromInitialDocuments(e,t,n,r,i){let s=[];return t.forEach(e=>{s.push({type:0,doc:e})}),new ag(e,t,af.emptySet(t),s,n,r,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&rL(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;let t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let e=0;e<t.length;e++)if(t[e].type!==n[e].type||!t[e].doc.isEqual(n[e].doc))return!1;return!0}}class am{constructor(){this.ya=void 0,this.wa=[]}Sa(){return this.wa.some(e=>e.ba())}}class ay{constructor(){this.queries=av(),this.onlineState="Unknown",this.Da=new Set}terminate(){!function(e,t){let n=e.queries;e.queries=av(),n.forEach((e,n)=>{for(let e of n.wa)e.onError(t)})}(this,new tG(tH.ABORTED,"Firestore shutting down"))}}function av(){return new rF(e=>rR(e),rL)}async function aw(e,t){let n=3,r=t.query,i=e.queries.get(r);i?!i.Sa()&&t.ba()&&(n=2):(i=new am,n=+!t.ba());try{switch(n){case 0:i.ya=await e.onListen(r,!0);break;case 1:i.ya=await e.onListen(r,!1);break;case 2:await e.onFirstRemoteStoreListen(r)}}catch(n){let e=ad(n,`Initialization of query '${rO(t.query)}' failed`);return void t.onError(e)}e.queries.set(r,i),i.wa.push(t),t.va(e.onlineState),i.ya&&t.Ca(i.ya)&&a_(e)}async function ab(e,t){let n=t.query,r=3,i=e.queries.get(n);if(i){let e=i.wa.indexOf(t);e>=0&&(i.wa.splice(e,1),0===i.wa.length?r=+!t.ba():!i.Sa()&&t.ba()&&(r=2))}switch(r){case 0:return e.queries.delete(n),e.onUnlisten(n,!0);case 1:return e.queries.delete(n),e.onUnlisten(n,!1);case 2:return e.onLastRemoteStoreUnlisten(n);default:return}}function aE(e,t){let n=!1;for(let r of t){let t=r.query,i=e.queries.get(t);if(i){for(let e of i.wa)e.Ca(r)&&(n=!0);i.ya=r}}n&&a_(e)}function aT(e,t,n){let r=e.queries.get(t);if(r)for(let e of r.wa)e.onError(n);e.queries.delete(t)}function a_(e){e.Da.forEach(e=>{e.next()})}(I=_||(_={})).Fa="default",I.Cache="cache";class aI{constructor(e,t,n){this.query=e,this.Ma=t,this.xa=!1,this.Oa=null,this.onlineState="Unknown",this.options=n||{}}Ca(e){if(!this.options.includeMetadataChanges){let t=[];for(let n of e.docChanges)3!==n.type&&t.push(n);e=new ag(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.xa?this.Na(e)&&(this.Ma.next(e),t=!0):this.Ba(e,this.onlineState)&&(this.La(e),t=!0),this.Oa=e,t}onError(e){this.Ma.error(e)}va(e){this.onlineState=e;let t=!1;return this.Oa&&!this.xa&&this.Ba(this.Oa,e)&&(this.La(this.Oa),t=!0),t}Ba(e,t){return!(e.fromCache&&this.ba())||(!this.options.ka||"Offline"===t)&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}Na(e){if(e.docChanges.length>0)return!0;let t=this.Oa&&this.Oa.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}La(e){e=ag.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.xa=!0,this.Ma.next(e)}ba(){return this.options.source!==_.Cache}}class aS{constructor(e){this.key=e}}class aC{constructor(e){this.key=e}}class aA{constructor(e,t){this.query=e,this.Ha=t,this.Ya=null,this.hasCachedResults=!1,this.current=!1,this.Za=rW(),this.mutatedKeys=rW(),this.Xa=rP(e),this.eu=new af(this.Xa)}get tu(){return this.Ha}nu(e,t){let n=t?t.ru:new ap,r=t?t.eu:this.eu,i=t?t.mutatedKeys:this.mutatedKeys,s=r,a=!1,o="F"===this.query.limitType&&r.size===this.query.limit?r.last():null,l="L"===this.query.limitType&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal((e,t)=>{let u=r.get(e),h=rM(this.query,t)?t:null,c=!!u&&this.mutatedKeys.has(u.key),d=!!h&&(h.hasLocalMutations||this.mutatedKeys.has(h.key)&&h.hasCommittedMutations),f=!1;u&&h?u.data.isEqual(h.data)?c!==d&&(n.track({type:3,doc:h}),f=!0):this.iu(u,h)||(n.track({type:2,doc:h}),f=!0,(o&&this.Xa(h,o)>0||l&&0>this.Xa(h,l))&&(a=!0)):!u&&h?(n.track({type:0,doc:h}),f=!0):u&&!h&&(n.track({type:1,doc:u}),f=!0,(o||l)&&(a=!0)),f&&(h?(s=s.add(h),i=d?i.add(e):i.delete(e)):(s=s.delete(e),i=i.delete(e)))}),null!==this.query.limit)for(;s.size>this.query.limit;){let e="F"===this.query.limitType?s.last():s.first();s=s.delete(e.key),i=i.delete(e.key),n.track({type:1,doc:e})}return{eu:s,ru:n,Ds:a,mutatedKeys:i}}iu(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n,r){let i=this.eu;this.eu=e.eu,this.mutatedKeys=e.mutatedKeys;let s=e.ru.pa();s.sort((e,t)=>(function(e,t){let n=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return tq(20277,{At:e})}};return n(e)-n(t)})(e.type,t.type)||this.Xa(e.doc,t.doc)),this.su(n),r=null!=r&&r;let a=t&&!r?this.ou():[],o=0===this.Za.size&&this.current&&!r?1:0,l=o!==this.Ya;return(this.Ya=o,0!==s.length||l)?{snapshot:new ag(this.query,e.eu,i,s,e.mutatedKeys,0===o,l,!1,!!n&&n.resumeToken.approximateByteSize()>0),_u:a}:{_u:a}}va(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({eu:this.eu,ru:new ap,mutatedKeys:this.mutatedKeys,Ds:!1},!1)):{_u:[]}}au(e){return!this.Ha.has(e)&&!!this.eu.has(e)&&!this.eu.get(e).hasLocalMutations}su(e){e&&(e.addedDocuments.forEach(e=>this.Ha=this.Ha.add(e)),e.modifiedDocuments.forEach(e=>{}),e.removedDocuments.forEach(e=>this.Ha=this.Ha.delete(e)),this.current=e.current)}ou(){if(!this.current)return[];let e=this.Za;this.Za=rW(),this.eu.forEach(e=>{this.au(e.key)&&(this.Za=this.Za.add(e.key))});let t=[];return e.forEach(e=>{this.Za.has(e)||t.push(new aC(e))}),this.Za.forEach(n=>{e.has(n)||t.push(new aS(n))}),t}uu(e){this.Ha=e.qs,this.Za=rW();let t=this.nu(e.documents);return this.applyChanges(t,!0)}cu(){return ag.fromInitialDocuments(this.query,this.eu,this.mutatedKeys,0===this.Ya,this.hasCachedResults)}}const ax="SyncEngine";class aD{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class ak{constructor(e){this.key=e,this.lu=!1}}class aN{constructor(e,t,n,r,i,s){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=s,this.hu={},this.Pu=new rF(e=>rR(e),rL),this.Tu=new Map,this.Iu=new Set,this.du=new nS(ni.comparator),this.Eu=new Map,this.Au=new ss,this.Ru={},this.Vu=new Map,this.mu=i6.ur(),this.onlineState="Unknown",this.fu=void 0}get isPrimaryClient(){return!0===this.fu}}async function aL(e,t,n=!0){let r,i=aZ(e),s=i.Pu.get(t);return s?(i.sharedClientState.addLocalQueryTarget(s.targetId),r=s.view.cu()):r=await aO(i,t,n,!0),r}async function aR(e,t){let n=aZ(e);await aO(n,t,!0,!1)}async function aO(e,t,n,r){var i,s;let a,o=await (i=e.localStore,s=rk(t),i.persistence.runTransaction("Allocate target","readwrite",e=>{let t;return i.hi.getTargetData(e,s).next(n=>n?(t=n,nv.resolve(t)):i.hi.allocateTargetId(e).next(n=>(t=new iX(s,n,"TargetPurposeListen",e.currentSequenceNumber),i.hi.addTargetData(e,t).next(()=>t))))}).then(e=>{let t=i.Fs.get(e.targetId);return(null===t||e.snapshotVersion.compareTo(t.snapshotVersion)>0)&&(i.Fs=i.Fs.insert(e.targetId,e),i.Ms.set(s,e.targetId)),e})),l=o.targetId,u=e.sharedClientState.addLocalQueryTarget(l,n);return r&&(a=await aM(e,t,l,"current"===u,o.resumeToken)),e.isPrimaryClient&&n&&sY(e.remoteStore,o),a}async function aM(e,t,n,r,i){e.gu=(t,n,r)=>(async function(e,t,n,r){let i=t.view.nu(n);i.Ds&&(i=await s_(e.localStore,t.query,!1).then(({documents:e})=>t.view.nu(e,i)));let s=r&&r.targetChanges.get(t.targetId),a=r&&null!=r.targetMismatches.get(t.targetId),o=t.view.applyChanges(i,e.isPrimaryClient,s,a);return aK(e,t.targetId,o._u),o.snapshot})(e,t,n,r);let s=await s_(e.localStore,t,!0),a=new aA(t,s.qs),o=a.nu(s.documents),l=iT.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==e.onlineState,i),u=a.applyChanges(o,e.isPrimaryClient,l);aK(e,n,u._u);let h=new aD(t,n,a);return e.Pu.set(t,h),e.Tu.has(n)?e.Tu.get(n).push(t):e.Tu.set(n,[t]),u.snapshot}async function aP(e,t,n){let r=e.Pu.get(t),i=e.Tu.get(r.targetId);if(i.length>1)return e.Tu.set(r.targetId,i.filter(e=>!rL(e,t))),void e.Pu.delete(t);e.isPrimaryClient?(e.sharedClientState.removeLocalQueryTarget(r.targetId),e.sharedClientState.isActiveQueryTarget(r.targetId)||await sT(e.localStore,r.targetId,!1).then(()=>{e.sharedClientState.clearQueryState(r.targetId),n&&sJ(e.remoteStore,r.targetId),aH(e,r.targetId)}).catch(ny)):(aH(e,r.targetId),await sT(e.localStore,r.targetId,!0))}async function aF(e,t){let n=e.Pu.get(t),r=e.Tu.get(n.targetId);e.isPrimaryClient&&1===r.length&&(e.sharedClientState.removeLocalQueryTarget(n.targetId),sJ(e.remoteStore,n.targetId))}async function aV(e,t,n){var r,i;let s=((r=e).remoteStore.remoteSyncer.applySuccessfulWrite=a$.bind(null,r),r.remoteStore.remoteSyncer.rejectFailedWrite=aq.bind(null,r),r);try{let e,r=await function(e,t){let n,r,i=nf.now(),s=t.reduce((e,t)=>e.add(t.key),rW());return e.persistence.runTransaction("Locally write mutations","readwrite",a=>{let o=rV,l=rW();return e.Os.getEntries(a,s).next(e=>{(o=e).forEach((e,t)=>{t.isValidDocument()||(l=l.add(e))})}).next(()=>e.localDocuments.getOverlayedDocuments(a,o)).next(r=>{n=r;let s=[];for(let e of t){let t=function(e,t){let n=null;for(let r of e.fieldTransforms){let e=t.data.field(r.field),i=rX(r.transform,e||null);null!=i&&(null===n&&(n=rr.empty()),n.set(r.field,i))}return n||null}(e,n.get(e.key).overlayedDocument);null!=t&&s.push(new ii(e.key,t,function e(t){let n=[];return n_(t.fields,(t,r)=>{let i=new nr([t]);if(n9(r)){let t=e(r.mapValue).fields;if(0===t.length)n.push(i);else for(let e of t)n.push(i.child(e))}else n.push(i)}),new nk(n)}(t.value.mapValue),r4.exists(!0)))}return e.mutationQueue.addMutationBatch(a,i,s,t)}).next(t=>{r=t;let i=t.applyToLocalDocumentSet(n,l);return e.documentOverlayCache.saveOverlays(a,t.batchId,i)})}).then(()=>({batchId:r.batchId,changes:rj(n)}))}(s.localStore,t);s.sharedClientState.addPendingMutation(r.batchId),i=r.batchId,(e=s.Ru[s.currentUser.toKey()])||(e=new nS(t5)),e=e.insert(i,n),s.Ru[s.currentUser.toKey()]=e,await aX(s,r.changes),await ae(s.remoteStore)}catch(t){let e=ad(t,"Failed to persist write");n.reject(e)}}async function aB(e,t){try{let n=await function(e,t){let n=t.snapshotVersion,r=e.Fs;return e.persistence.runTransaction("Apply remote event","readwrite-primary",i=>{var s,a,o;let l,u,h=e.Os.newChangeBuffer({trackRemovals:!0});r=e.Fs;let c=[];t.targetChanges.forEach((s,a)=>{var o;let l=r.get(a);if(!l)return;c.push(e.hi.removeMatchingKeys(i,s.removedDocuments,a).next(()=>e.hi.addMatchingKeys(i,s.addedDocuments,a)));let u=l.withSequenceNumber(i.currentSequenceNumber);null!==t.targetMismatches.get(a)?u=u.withResumeToken(nL.EMPTY_BYTE_STRING,np.min()).withLastLimboFreeSnapshotVersion(np.min()):s.resumeToken.approximateByteSize()>0&&(u=u.withResumeToken(s.resumeToken,n)),r=r.insert(a,u),o=u,(0===l.resumeToken.approximateByteSize()||o.snapshotVersion.toMicroseconds()-l.snapshotVersion.toMicroseconds()>=3e8||s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size>0)&&c.push(e.hi.updateTargetData(i,u))});let d=rV,f=rW();if(t.documentUpdates.forEach(n=>{t.resolvedLimboDocuments.has(n)&&c.push(e.persistence.referenceDelegate.updateLimboDocument(i,n))}),c.push((s=i,a=h,o=t.documentUpdates,l=rW(),u=rW(),o.forEach(e=>l=l.add(e)),a.getEntries(s,l).next(e=>{let t=rV;return o.forEach((n,r)=>{let i=e.get(n);r.isFoundDocument()!==i.isFoundDocument()&&(u=u.add(n)),r.isNoDocument()&&r.version.isEqual(np.min())?(a.removeEntry(n,r.readTime),t=t.insert(n,r)):!i.isValidDocument()||r.version.compareTo(i.version)>0||0===r.version.compareTo(i.version)&&i.hasPendingWrites?(a.addEntry(r),t=t.insert(n,r)):tB(sv,"Ignoring outdated watch update for ",n,". Current version:",i.version," Watch version:",r.version)}),{Ls:t,ks:u}})).next(e=>{d=e.Ls,f=e.ks})),!n.isEqual(np.min())){let t=e.hi.getLastRemoteSnapshotVersion(i).next(t=>e.hi.setTargetsMetadata(i,i.currentSequenceNumber,n));c.push(t)}return nv.waitFor(c).next(()=>h.apply(i)).next(()=>e.localDocuments.getLocalViewOfDocuments(i,d,f)).next(()=>d)}).then(t=>(e.Fs=r,t))}(e.localStore,t);t.targetChanges.forEach((t,n)=>{let r=e.Eu.get(n);r&&(tW(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1,22616),t.addedDocuments.size>0?r.lu=!0:t.modifiedDocuments.size>0?tW(r.lu,14607):t.removedDocuments.size>0&&(tW(r.lu,42227),r.lu=!1))}),await aX(e,n,t)}catch(e){await ny(e)}}function aU(e,t,n){var r;if(e.isPrimaryClient&&0===n||!e.isPrimaryClient&&1===n){let n,i=[];e.Pu.forEach((e,n)=>{let r=n.view.va(t);r.snapshot&&i.push(r.snapshot)}),(r=e.eventManager).onlineState=t,n=!1,r.queries.forEach((e,r)=>{for(let e of r.wa)e.va(t)&&(n=!0)}),n&&a_(r),i.length&&e.hu.J_(i),e.onlineState=t,e.isPrimaryClient&&e.sharedClientState.setOnlineState(t)}}async function aj(e,t,n){e.sharedClientState.updateQueryState(t,"rejected",n);let r=e.Eu.get(t),i=r&&r.key;if(i){let n=new nS(ni.comparator);n=n.insert(i,ri.newNoDocument(i,np.min()));let r=rW().add(i),s=new iE(np.min(),new Map,new nS(t5),n,r);await aB(e,s),e.du=e.du.remove(i),e.Eu.delete(t),aQ(e)}else await sT(e.localStore,t,!1).then(()=>aH(e,t,n)).catch(ny)}async function a$(e,t){var n;let r=t.batch.batchId;try{let i=await (n=e.localStore,n.persistence.runTransaction("Acknowledge batch","readwrite-primary",e=>{let r=t.batch.keys(),i=n.Os.newChangeBuffer({trackRemovals:!0});return(function(e,t,n,r){let i=n.batch,s=i.keys(),a=nv.resolve();return s.forEach(e=>{a=a.next(()=>r.getEntry(t,e)).next(t=>{let s=n.docVersions.get(e);tW(null!==s,48541),0>t.version.compareTo(s)&&(i.applyToRemoteDocument(t,n),t.isValidDocument()&&(t.setReadTime(n.commitVersion),r.addEntry(t)))})}),a.next(()=>e.mutationQueue.removeMutationBatch(t,i))})(n,e,t,i).next(()=>i.apply(e)).next(()=>n.mutationQueue.performConsistencyCheck(e)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(e,r,t.batch.batchId)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(e){let t=rW();for(let n=0;n<e.mutationResults.length;++n)e.mutationResults[n].transformResults.length>0&&(t=t.add(e.batch.mutations[n].key));return t}(t))).next(()=>n.localDocuments.getDocuments(e,r))}));aW(e,r,null),az(e,r),e.sharedClientState.updateMutationState(r,"acknowledged"),await aX(e,i)}catch(e){await ny(e)}}async function aq(e,t,n){var r;try{let i=await (r=e.localStore,r.persistence.runTransaction("Reject batch","readwrite-primary",e=>{let n;return r.mutationQueue.lookupMutationBatch(e,t).next(t=>(tW(null!==t,37113),n=t.keys(),r.mutationQueue.removeMutationBatch(e,t))).next(()=>r.mutationQueue.performConsistencyCheck(e)).next(()=>r.documentOverlayCache.removeOverlaysForBatchId(e,n,t)).next(()=>r.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,n)).next(()=>r.localDocuments.getDocuments(e,n))}));aW(e,t,n),az(e,t),e.sharedClientState.updateMutationState(t,"rejected",n),await aX(e,i)}catch(e){await ny(e)}}function az(e,t){(e.Vu.get(t)||[]).forEach(e=>{e.resolve()}),e.Vu.delete(t)}function aW(e,t,n){let r=e.Ru[e.currentUser.toKey()];if(r){let i=r.get(t);i&&(n?i.reject(n):i.resolve(),r=r.remove(t)),e.Ru[e.currentUser.toKey()]=r}}function aH(e,t,n=null){for(let r of(e.sharedClientState.removeLocalQueryTarget(t),e.Tu.get(t)))e.Pu.delete(r),n&&e.hu.pu(r,n);e.Tu.delete(t),e.isPrimaryClient&&e.Au.zr(t).forEach(t=>{e.Au.containsKey(t)||aG(e,t)})}function aG(e,t){e.Iu.delete(t.path.canonicalString());let n=e.du.get(t);null!==n&&(sJ(e.remoteStore,n),e.du=e.du.remove(t),e.Eu.delete(n),aQ(e))}function aK(e,t,n){for(let r of n)r instanceof aS?(e.Au.addReference(r.key,t),function(e,t){let n=t.key,r=n.path.canonicalString();e.du.get(n)||e.Iu.has(r)||(tB(ax,"New document in limbo: "+n),e.Iu.add(r),aQ(e))}(e,r)):r instanceof aC?(tB(ax,"Document no longer in limbo: "+r.key),e.Au.removeReference(r.key,t),e.Au.containsKey(r.key)||aG(e,r.key)):tq(19791,{yu:r})}function aQ(e){for(;e.Iu.size>0&&e.du.size<e.maxConcurrentLimboResolutions;){let t=e.Iu.values().next().value;e.Iu.delete(t);let n=new ni(nt.fromString(t)),r=e.mu.next();e.Eu.set(r,new ak(n)),e.du=e.du.insert(n,r),sY(e.remoteStore,new iX(rk(new rA(n.path)),r,"TargetPurposeLimboResolution",nb.ue))}}async function aX(e,t,n){let r=[],i=[],s=[];e.Pu.isEmpty()||(e.Pu.forEach((a,o)=>{s.push(e.gu(o,t,n).then(t=>{var s;if((t||n)&&e.isPrimaryClient){let r=t?!t.fromCache:null==(s=null==n?void 0:n.targetChanges.get(o.targetId))?void 0:s.current;e.sharedClientState.updateQueryState(o.targetId,r?"current":"not-current")}if(t){r.push(t);let e=sg.Es(o.targetId,t);i.push(e)}}))}),await Promise.all(s),e.hu.J_(r),await async function(e,t){try{await e.persistence.runTransaction("notifyLocalViewChanges","readwrite",n=>nv.forEach(t,t=>nv.forEach(t.Is,r=>e.persistence.referenceDelegate.addReference(n,t.targetId,r)).next(()=>nv.forEach(t.ds,r=>e.persistence.referenceDelegate.removeReference(n,t.targetId,r)))))}catch(e){if(!nw(e))throw e;tB(sv,"Failed to update sequence numbers: "+e)}for(let n of t){let t=n.targetId;if(!n.fromCache){let n=e.Fs.get(t),r=n.snapshotVersion,i=n.withLastLimboFreeSnapshotVersion(r);e.Fs=e.Fs.insert(t,i)}}}(e.localStore,i))}async function aY(e,t){if(!e.currentUser.isEqual(t)){tB(ax,"User change. New user:",t.toKey());let n=await sb(e.localStore,t);e.currentUser=t,e.Vu.forEach(e=>{e.forEach(e=>{e.reject(new tG(tH.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),e.Vu.clear(),e.sharedClientState.handleUserChange(t,n.removedBatchIds,n.addedBatchIds),await aX(e,n.Bs)}}function aJ(e,t){let n=e.Eu.get(t);if(n&&n.lu)return rW().add(n.key);{let n=rW(),r=e.Tu.get(t);if(!r)return n;for(let t of r){let r=e.Pu.get(t);n=n.unionWith(r.view.tu)}return n}}function aZ(e){return e.remoteStore.remoteSyncer.applyRemoteEvent=aB.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=aJ.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=aj.bind(null,e),e.hu.J_=aE.bind(null,e.eventManager),e.hu.pu=aT.bind(null,e.eventManager),e}class a0{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=sV(e.databaseInfo.databaseId),this.sharedClientState=this.bu(e),this.persistence=this.Du(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Cu(e,this.localStore),this.indexBackfillerScheduler=this.Fu(e,this.localStore)}Cu(e,t){return null}Fu(e,t){return null}vu(e){var t,n;return t=this.persistence,n=new sy,new sw(t,n,e.initialUser,this.serializer)}Du(e){return new sc(sf.Vi,this.serializer)}bu(e){return new sS}async terminate(){var e,t;null==(e=this.gcScheduler)||e.stop(),null==(t=this.indexBackfillerScheduler)||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}a0.provider={build:()=>new a0};class a1 extends a0{constructor(e){super(),this.cacheSizeBytes=e}Cu(e,t){return tW(this.persistence.referenceDelegate instanceof sp,46915),new i8(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}Du(e){let t=void 0!==this.cacheSizeBytes?i2.withCacheSize(this.cacheSizeBytes):i2.DEFAULT;return new sc(e=>sp.Vi(e,t),this.serializer)}}class a2{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>aU(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=aY.bind(null,this.syncEngine),await al(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new ay}createDatastore(e){var t;let n=sV(e.databaseInfo.databaseId),r=new sP(e.databaseInfo);return t=e.authCredentials,new sW(t,e.appCheckCredentials,r,n)}createRemoteStore(e){var t,n;return t=this.localStore,n=this.datastore,new sK(t,n,e.asyncQueue,e=>aU(this.syncEngine,e,0),sx.C()?new sx:new sC)}createSyncEngine(e,t){return function(e,t,n,r,i,s,a){let o=new aN(e,t,n,r,i,s);return a&&(o.fu=!0),o}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await async function(e){tB(sG,"RemoteStore shutting down."),e.Ia.add(5),await sX(e),e.Ea.shutdown(),e.Aa.set("Unknown")}(this.remoteStore),null==(e=this.datastore)||e.terminate(),null==(t=this.eventManager)||t.terminate()}}a2.provider={build:()=>new a2};class a6{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.xu(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.xu(this.observer.error,e):tU("Uncaught Error in snapshot listener:",e.toString()))}Ou(){this.muted=!0}xu(e,t){setTimeout(()=>{this.muted||e(t)},0)}}const a3="FirestoreClient";class a5{constructor(e,t,n,r,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=r,this.user=tM.UNAUTHENTICATED,this.clientId=t3.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(n,async e=>{tB(a3,"Received user=",e.uid),await this.authCredentialListener(e),this.user=e}),this.appCheckCredentials.start(n,e=>(tB(a3,"Received new app check token=",e),this.appCheckCredentialListener(e,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();let e=new tK;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(n){let t=ad(n,"Failed to shutdown persistence");e.reject(t)}}),e.promise}}async function a4(e,t){e.asyncQueue.verifyOperationInProgress(),tB(a3,"Initializing OfflineComponentProvider");let n=e.configuration;await t.initialize(n);let r=n.initialUser;e.setCredentialChangeListener(async e=>{r.isEqual(e)||(await sb(t.localStore,e),r=e)}),t.persistence.setDatabaseDeletedListener(()=>{tj("Terminating Firestore due to IndexedDb database deletion"),e.terminate().then(()=>{tB("Terminating Firestore due to IndexedDb database deletion completed successfully")}).catch(e=>{tj("Terminating Firestore due to IndexedDb database deletion failed",e)})}),e._offlineComponents=t}async function a8(e,t){e.asyncQueue.verifyOperationInProgress();let n=await a7(e);tB(a3,"Initializing OnlineComponentProvider"),await t.initialize(n,e.configuration),e.setCredentialChangeListener(e=>ao(t.remoteStore,e)),e.setAppCheckTokenChangeListener((e,n)=>ao(t.remoteStore,n)),e._onlineComponents=t}async function a7(e){if(!e._offlineComponents)if(e._uninitializedComponentsProvider){tB(a3,"Using user provided OfflineComponentProvider");try{await a4(e,e._uninitializedComponentsProvider._offline)}catch(t){if(!("FirebaseError"===t.name?t.code===tH.FAILED_PRECONDITION||t.code===tH.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code))throw t;tj("Error using user provided cache. Falling back to memory cache: "+t),await a4(e,new a0)}}else tB(a3,"Using default OfflineComponentProvider"),await a4(e,new a1(void 0));return e._offlineComponents}async function a9(e){return e._onlineComponents||(e._uninitializedComponentsProvider?(tB(a3,"Using user provided OnlineComponentProvider"),await a8(e,e._uninitializedComponentsProvider._online)):(tB(a3,"Using default OnlineComponentProvider"),await a8(e,new a2))),e._onlineComponents}async function oe(e){let t=await a9(e),n=t.eventManager;return n.onListen=aL.bind(null,t.syncEngine),n.onUnlisten=aP.bind(null,t.syncEngine),n.onFirstRemoteStoreListen=aR.bind(null,t.syncEngine),n.onLastRemoteStoreUnlisten=aF.bind(null,t.syncEngine),n}function ot(e){let t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t}const on=new Map,or="firestore.googleapis.com";class oi{constructor(e){var t,n;if(void 0===e.host){if(void 0!==e.ssl)throw new tG(tH.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=or,this.ssl=!0}else this.host=e.host,this.ssl=null==(t=e.ssl)||t;if(this.isUsingEmulator=void 0!==e.emulatorOptions,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=0x2800000;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new tG(tH.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}(function(e,t,n,r){if(!0===t&&!0===r)throw new tG(tH.INVALID_ARGUMENT,`${e} and ${n} cannot be used together.`)})("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=ot(null!=(n=e.experimentalLongPollingOptions)?n:{}),function(e){if(void 0!==e.timeoutSeconds){if(isNaN(e.timeoutSeconds))throw new tG(tH.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (must not be NaN)`);if(e.timeoutSeconds<5)throw new tG(tH.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (minimum allowed value is 5)`);if(e.timeoutSeconds>30)throw new tG(tH.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){var t,n;return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(t=this.experimentalLongPollingOptions,n=e.experimentalLongPollingOptions,t.timeoutSeconds===n.timeoutSeconds)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class os{constructor(e,t,n,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new oi({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new tG(tH.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return"notTerminated"!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new tG(tH.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new oi(e),this._emulatorOptions=e.emulatorOptions||{},void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new tX;switch(e.type){case"firstParty":return new t0(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new tG(tH.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return"notTerminated"===this._terminateTask&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){"notTerminated"===this._terminateTask?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){let t=on.get(e);t&&(tB("ComponentProvider","Removing Datastore"),on.delete(e),t.terminate())}(this),Promise.resolve()}}class oa{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new oa(this.firestore,e,this._query)}}class oo{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new ol(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new oo(this.firestore,e,this._key)}toJSON(){return{type:oo._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,n){if(nd(t,oo._jsonSchema))return new oo(e,n||null,new ni(nt.fromString(t.referencePath)))}}oo._jsonSchemaVersion="firestore/documentReference/1.0",oo._jsonSchema={type:nc("string",oo._jsonSchemaVersion),referencePath:nc("string")};class ol extends oa{constructor(e,t,n){super(e,t,new rA(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new oo(this.firestore,null,new ni(e))}withConverter(e){return new ol(this.firestore,e,this._path)}}function ou(e,t,...n){if(e=en(e),1==arguments.length&&(t=t3.newId()),ns("doc","path",t),e instanceof os){let r=nt.fromString(t,...n);return na(r),new oo(e,null,new ni(r))}{if(!(e instanceof oo||e instanceof ol))throw new tG(tH.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=e._path.child(nt.fromString(t,...n));return na(r),new oo(e.firestore,e instanceof ol?e.converter:null,new ni(r))}}const oh="AsyncQueue";class oc{constructor(e=Promise.resolve()){this.Zu=[],this.Xu=!1,this.ec=[],this.tc=null,this.nc=!1,this.rc=!1,this.sc=[],this.F_=new sB(this,"async_queue_retry"),this.oc=()=>{let e=sF();e&&tB(oh,"Visibility state changed to "+e.visibilityState),this.F_.y_()},this._c=e;let t=sF();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.oc)}get isShuttingDown(){return this.Xu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.ac(),this.uc(e)}enterRestrictedMode(e){if(!this.Xu){this.Xu=!0,this.rc=e||!1;let t=sF();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.oc)}}enqueue(e){if(this.ac(),this.Xu)return new Promise(()=>{});let t=new tK;return this.uc(()=>this.Xu&&this.rc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Zu.push(e),this.cc()))}async cc(){if(0!==this.Zu.length){try{await this.Zu[0](),this.Zu.shift(),this.F_.reset()}catch(e){if(!nw(e))throw e;tB(oh,"Operation failed with retryable error: "+e)}this.Zu.length>0&&this.F_.g_(()=>this.cc())}}uc(e){let t=this._c.then(()=>(this.nc=!0,e().catch(e=>{throw this.tc=e,this.nc=!1,tU("INTERNAL UNHANDLED ERROR: ",od(e)),e}).then(e=>(this.nc=!1,e))));return this._c=t,t}enqueueAfterDelay(e,t,n){this.ac(),this.sc.indexOf(e)>-1&&(t=0);let r=ac.createAndSchedule(this,e,t,n,e=>this.lc(e));return this.ec.push(r),r}ac(){this.tc&&tq(47125,{hc:od(this.tc)})}verifyOperationInProgress(){}async Pc(){let e;do e=this._c,await e;while(e!==this._c)}Tc(e){for(let t of this.ec)if(t.timerId===e)return!0;return!1}Ic(e){return this.Pc().then(()=>{for(let t of(this.ec.sort((e,t)=>e.targetTimeMs-t.targetTimeMs),this.ec))if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.Pc()})}dc(e){this.sc.push(e)}lc(e){let t=this.ec.indexOf(e);this.ec.splice(t,1)}}function od(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}class of extends os{constructor(e,t,n,r){super(e,t,n,r),this.type="firestore",this._queue=new oc,this._persistenceKey=(null==r?void 0:r.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){let e=this._firestoreClient.terminate();this._queue=new oc(e),this._firestoreClient=void 0,await e}}}function op(e){if(e._terminated)throw new tG(tH.FAILED_PRECONDITION,"The client has already been terminated.");return e._firestoreClient||function(e){var t,n,r,i,s;let a=e._freezeSettings(),o=(i=e._databaseId,s=(null==(t=e._app)?void 0:t.options.appId)||"",new nz(i,s,e._persistenceKey,a.host,a.ssl,a.experimentalForceLongPolling,a.experimentalAutoDetectLongPolling,ot(a.experimentalLongPollingOptions),a.useFetchStreams,a.isUsingEmulator));e._componentsProvider||(null==(n=a.localCache)?void 0:n._offlineComponentProvider)&&(null==(r=a.localCache)?void 0:r._onlineComponentProvider)&&(e._componentsProvider={_offline:a.localCache._offlineComponentProvider,_online:a.localCache._onlineComponentProvider}),e._firestoreClient=new a5(e._authCredentials,e._appCheckCredentials,e._queue,o,e._componentsProvider&&function(e){let t=null==e?void 0:e._online.build();return{_offline:null==e?void 0:e._offline.build(t),_online:t}}(e._componentsProvider))}(e),e._firestoreClient}class og{constructor(e){this._byteString=e}static fromBase64String(e){try{return new og(nL.fromBase64String(e))}catch(e){throw new tG(tH.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new og(nL.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:og._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(nd(e,og._jsonSchema))return og.fromBase64String(e.bytes)}}og._jsonSchemaVersion="firestore/bytes/1.0",og._jsonSchema={type:nc("string",og._jsonSchemaVersion),bytes:nc("string")};class om{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new tG(tH.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new nr(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class oy{constructor(e){this._methodName=e}}class ov{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new tG(tH.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new tG(tH.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return t5(this._lat,e._lat)||t5(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:ov._jsonSchemaVersion}}static fromJSON(e){if(nd(e,ov._jsonSchema))return new ov(e.latitude,e.longitude)}}ov._jsonSchemaVersion="firestore/geoPoint/1.0",ov._jsonSchema={type:nc("string",ov._jsonSchemaVersion),latitude:nc("number"),longitude:nc("number")};class ow{constructor(e){this._values=(e||[]).map(e=>e)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}(this._values,e._values)}toJSON(){return{type:ow._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(nd(e,ow._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(e=>"number"==typeof e))return new ow(e.vectorValues);throw new tG(tH.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}ow._jsonSchemaVersion="firestore/vectorValue/1.0",ow._jsonSchema={type:nc("string",ow._jsonSchemaVersion),vectorValues:nc("object")};const ob=/^__.*__$/;class oE{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new ii(e,this.data,this.fieldMask,t,this.fieldTransforms):new ir(e,this.data,t,this.fieldTransforms)}}function oT(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw tq(40011,{Ec:e})}}class o_{constructor(e,t,n,r,i,s){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=r,void 0===i&&this.Ac(),this.fieldTransforms=i||[],this.fieldMask=s||[]}get path(){return this.settings.path}get Ec(){return this.settings.Ec}Rc(e){return new o_(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Vc(e){var t;let n=null==(t=this.path)?void 0:t.child(e),r=this.Rc({path:n,mc:!1});return r.fc(e),r}gc(e){var t;let n=null==(t=this.path)?void 0:t.child(e),r=this.Rc({path:n,mc:!1});return r.Ac(),r}yc(e){return this.Rc({path:void 0,mc:!0})}wc(e){return oD(e,this.settings.methodName,this.settings.Sc||!1,this.path,this.settings.bc)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}Ac(){if(this.path)for(let e=0;e<this.path.length;e++)this.fc(this.path.get(e))}fc(e){if(0===e.length)throw this.wc("Document fields must not be empty");if(oT(this.Ec)&&ob.test(e))throw this.wc('Document fields cannot begin and end with "__"')}}class oI{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||sV(e)}Dc(e,t,n,r=!1){return new o_({Ec:e,methodName:t,bc:n,path:nr.emptyPath(),mc:!1,Sc:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function oS(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof nf||e instanceof ov||e instanceof og||e instanceof oo||e instanceof oy||e instanceof ow)}function oC(e,t,n){if(!oS(n)||!nl(n)){let r=nu(n);throw"an object"===r?t.wc(e+" a custom object"):t.wc(e+" "+r)}}const oA=RegExp("[~\\*/\\[\\]]");function ox(e,t,n){if(t.search(oA)>=0)throw oD(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,n);try{return new om(...t.split("."))._internalPath}catch(r){throw oD(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,n)}}function oD(e,t,n,r,i){let s=r&&!r.isEmpty(),a=void 0!==i,o=`Function ${t}() called with invalid data`;n&&(o+=" (via `toFirestore()`)"),o+=". ";let l="";return(s||a)&&(l+=" (found",s&&(l+=` in field ${r}`),a&&(l+=` in document ${i}`),l+=")"),new tG(tH.INVALID_ARGUMENT,o+e+l)}class ok{constructor(e,t,n,r,i){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=r,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new oo(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){let e=new oN(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){let t=this._document.data.field(oL("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class oN extends ok{data(){return super.data()}}function oL(e,t){return"string"==typeof t?ox(e,t):t instanceof om?t._internalPath:t._delegate._internalPath}class oR{convertValue(e,t="none"){switch(nJ(e)){case 0:return null;case 1:return e.booleanValue;case 2:return nM(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(nP(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw tq(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let n={};return n_(e,(e,r)=>{n[e]=this.convertValue(r,t)}),n}convertVectorValue(e){var t,n,r;return new ow(null==(r=null==(n=null==(t=e.fields)?void 0:t[nY].arrayValue)?void 0:n.values)?void 0:r.map(e=>nM(e.doubleValue)))}convertGeoPoint(e){return new ov(nM(e.latitude),nM(e.longitude))}convertArray(e,t){return(e.values||[]).map(e=>this.convertValue(e,t))}convertServerTimestamp(e,t){switch(t){case"previous":let n=n$(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(nq(e));default:return null}}convertTimestamp(e){let t=nO(e);return new nf(t.seconds,t.nanos)}convertDocumentKey(e,t){let n=nt.fromString(e);tW(iQ(n),9688,{name:e});let r=new nH(n.get(1),n.get(3)),i=new ni(n.popFirst(5));return r.isEqual(t)||tU(`Document ${i} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}class oO{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class oM extends ok{constructor(e,t,n,r,i,s){super(e,t,n,r,s),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){let t=new oP(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){let n=this._document.data.field(oL("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new tG(tH.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let e=this._document,t={};return t.type=oM._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),e&&e.isValidDocument()&&e.isFoundDocument()&&(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),this._firestore,this.ref.path,t.bundle="NOT SUPPORTED"),t}}oM._jsonSchemaVersion="firestore/documentSnapshot/1.0",oM._jsonSchema={type:nc("string",oM._jsonSchemaVersion),bundleSource:nc("string","DocumentSnapshot"),bundleName:nc("string"),bundle:nc("string")};class oP extends oM{data(e={}){return super.data(e)}}class oF{constructor(e,t,n,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new oO(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(n=>{e.call(t,new oP(this._firestore,this._userDataWriter,n.key,n,new oO(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new tG(tH.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map(n=>{let r=new oP(e._firestore,e._userDataWriter,n.doc.key,n.doc,new oO(e._snapshot.mutatedKeys.has(n.doc.key),e._snapshot.fromCache),e.query.converter);return n.doc,{type:"added",doc:r,oldIndex:-1,newIndex:t++}})}{let n=e._snapshot.oldDocs;return e._snapshot.docChanges.filter(e=>t||3!==e.type).map(t=>{let r=new oP(e._firestore,e._userDataWriter,t.doc.key,t.doc,new oO(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter),i=-1,s=-1;return 0!==t.type&&(i=n.indexOf(t.doc.key),n=n.delete(t.doc.key)),1!==t.type&&(s=(n=n.add(t.doc)).indexOf(t.doc.key)),{type:function(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return tq(61501,{type:e})}}(t.type),doc:r,oldIndex:i,newIndex:s}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new tG(tH.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let e={};e.type=oF._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=t3.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;let t=[],n=[],r=[];return this.docs.forEach(e=>{null!==e._document&&(t.push(e._document),n.push(this._userDataWriter.convertObjectMap(e._document.data.value.mapValue.fields,"previous")),r.push(e.ref.path))}),this._firestore,this.query._query,e.bundleName,e.bundle="NOT SUPPORTED",e}}oF._jsonSchemaVersion="firestore/querySnapshot/1.0",oF._jsonSchema={type:nc("string",oF._jsonSchemaVersion),bundleSource:nc("string","QuerySnapshot"),bundleName:nc("string"),bundle:nc("string")};class oV extends oR{constructor(e){super(),this.firestore=e}convertBytes(e){return new og(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new oo(this.firestore,null,t)}}function oB(e,t,n){var r;e=nh(e,oo);let i=nh(e.firestore,of),s=(r=e.converter,r?n&&(n.merge||n.mergeFields)?r.toFirestore(t,n):r.toFirestore(t):t);return oj(i,[(function(e,t,n,r,i,s={}){let a,o,l=e.Dc(s.merge||s.mergeFields?2:0,t,n,i);oC("Data must be an object, but it was:",l,r);let u=function e(t,n){let r={};return nI(t)?n.path&&n.path.length>0&&n.fieldMask.push(n.path):n_(t,(t,i)=>{let s=function t(n,r){if(oS(n=en(n)))return oC("Unsupported field value:",r,n),e(n,r);if(n instanceof oy)return function(e,t){if(!oT(t.Ec))throw t.wc(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t.wc(`${e._methodName}() is not currently supported inside arrays`);let n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(n,r),null;if(void 0===n&&r.ignoreUndefinedProperties)return null;if(r.path&&r.fieldMask.push(r.path),n instanceof Array){if(r.settings.mc&&4!==r.Ec)throw r.wc("Nested arrays are not supported");let e=[],i=0;for(let s of n){let n=t(s,r.yc(i));null==n&&(n={nullValue:"NULL_VALUE"}),e.push(n),i++}return{arrayValue:{values:e}}}return function(e,t){var n,r,i;if(null===(e=en(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return n=t.serializer,"number"==typeof(i=r=e)&&Number.isInteger(i)&&!nE(i)&&i<=Number.MAX_SAFE_INTEGER&&i>=Number.MIN_SAFE_INTEGER?rK(r):rG(n,r);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){let n=nf.fromDate(e);return{timestampValue:iM(t.serializer,n)}}if(e instanceof nf){let n=new nf(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:iM(t.serializer,n)}}if(e instanceof ov)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof og)return{bytesValue:iP(t.serializer,e._byteString)};if(e instanceof oo){let n=t.databaseId,r=e.firestore._databaseId;if(!r.isEqual(n))throw t.wc(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:iV(e.firestore._databaseId||t.databaseId,e._key.path)}}if(e instanceof ow)return{mapValue:{fields:{[nG]:{stringValue:nX},[nY]:{arrayValue:{values:e.toArray().map(e=>{if("number"!=typeof e)throw t.wc("VectorValues must only contain numeric values.");return rG(t.serializer,e)})}}}}};throw t.wc(`Unsupported field value: ${nu(e)}`)}(n,r)}(i,n.Vc(t));null!=s&&(r[t]=s)}),{mapValue:{fields:r}}}(r,l);if(s.merge)a=new nk(l.fieldMask),o=l.fieldTransforms;else if(s.mergeFields){let e=[];for(let r of s.mergeFields){let i=function(e,t,n){if((t=en(t))instanceof om)return t._internalPath;if("string"==typeof t)return ox(e,t);throw oD("Field path arguments must be of type string or ",e,!1,void 0,n)}(t,r,n);if(!l.contains(i))throw new tG(tH.INVALID_ARGUMENT,`Field '${i}' is specified in your field mask but missing from your input data.`);(function(e,t){return e.some(e=>e.isEqual(t))})(e,i)||e.push(i)}a=new nk(e),o=l.fieldTransforms.filter(e=>a.covers(e.field))}else a=null,o=l.fieldTransforms;return new oE(new rr(u),a,o)})(function(e){let t=e._freezeSettings(),n=sV(e._databaseId);return new oI(e._databaseId,!!t.ignoreUndefinedProperties,n)}(i),"setDoc",e._key,s,null!==e.converter,n).toMutation(e._key,r4.none())])}function oU(e){return oj(nh(e.firestore,of),[new il(e._key,r4.none())])}function oj(e,t){var n=op(e);let r=new tK;return n.asyncQueue.enqueueAndForget(async()=>aV(await a9(n).then(e=>e.syncEngine),t,r)),r.promise}function o$(e,t){let n=0;return function(...r){let i=Date.now();i-n>=t&&(e.apply(this,r),n=i)}}function oq(e,t=0,n=()=>{}){if(!e)return document.createElement("div");let{id:r,type:i,expression:s,type_expression:a}=e,o=document.createElement("button");o.classList.add("word-button"),o.classList.add("app-button"),o.dataset.id=r;let l=document.createElement("span");l.classList.add("index"),l.innerText=t;let u=document.createElement("span");u.classList.add("expression"),u.innerText=s;let h=document.createElement("span");if(h.classList.add("type"),h.classList.add(i),h.innerText=a,o.appendChild(l),o.appendChild(u),D.dictionary.getById(r).favorite){let e=document.createElement("span");e.classList.add("favorite"),e.innerText="",o.appendChild(e)}return o.appendChild(h),n(o),o}new WeakMap,function(e=!0){tP="11.10.0",eP(new er("firestore",(t,{instanceIdentifier:n,options:r})=>{let i=t.getProvider("app").getImmediate(),s=new of(new tJ(t.getProvider("auth-internal")),new t2(i,t.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new tG(tH.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new nH(e.options.projectId,t)}(i,n),i);return r=Object.assign({useFetchStreams:e},r),s._setSettings(r),s},"PUBLIC").setMultipleInstances(!0)),eU(tR,tO,void 0),eU(tR,tO,"esm2017")}();let oz=0;function oW(e,t=()=>{}){let n=document.createElement("div");n.classList.add("sub-container");let r=document.createElement("button");r.classList.add("filter-open-close-button"),r.innerHTML=`
    <svg
      xmlns="http://www.w3.org/2000/svg"
      xmlns:xlink="http://www.w3.org/1999/xlink"
      fill="var(--color-2)"
      height="15px"
      width="15px"
      version="1.1"
      id="Layer_1"
      viewBox="0 0 330 330"
      xml:space="preserve"
    >
      <path
        id="XMLID_224_"
        d="M325.606,229.393l-150.004-150C172.79,76.58,168.974,75,164.996,75c-3.979,0-7.794,1.581-10.607,4.394  l-149.996,150c-5.858,5.858-5.858,15.355,0,21.213c5.857,5.857,15.355,5.858,21.213,0l139.39-139.393l139.397,139.393  C307.322,253.536,311.161,255,315,255c3.839,0,7.678-1.464,10.607-4.394C331.464,244.748,331.464,235.251,325.606,229.393z"
      />
    </svg>Filters`;let i=document.createElement("div");i.classList.add("filter-list-des-box"),i.classList.add("hidden");let s=document.createElement("div");s.classList.add("sub-container");let a=document.createElement("ul");for(let t in a.classList.add("app-list"),a.classList.add("flex-container"),a.classList.add("filter-list"),e){let n=document.createElement("li"),r=t+oz,i=document.createElement("label");i.classList.add(t),i.classList.add("app-button"),i.setAttribute("for",r),i.innerText+=e[t].expression+" ";let s=document.createElement("input");s.type="checkbox",s.checked=!0,s.id=r,s.name=t,n.appendChild(s),n.appendChild(i),a.appendChild(n)}let o=document.createElement("button");o.classList.add("app-button"),o.innerText="Toggle All";let l=a.querySelectorAll("input[type='checkbox']");l.forEach(n=>{e[n.name].used=n.checked,n.addEventListener("change",n=>{e[n.target.name].used=n.target.checked,t()})});let u=!0;return o.addEventListener("click",()=>{l.forEach(t=>{e[t.name].used=!u,t.checked=!u}),u=!u,t()}),r.addEventListener("click",()=>{i.classList.toggle("hidden"),r.classList.toggle("active")}),n.appendChild(r),n.appendChild(i),s.appendChild(a),s.appendChild(o),i.appendChild(s),oz++,n}function oH(e=""){let t=[...new Set(e.split(",").map(e=>{let t=D.dictionary.getWordsByPart(e.trimLeft()),n=D.dictionary.getWordsByTypes(t,...Object.keys(D.filters.dictionary).map(e=>D.filters.dictionary[e].used&&`${e}`)),r=0!==n.length?n:D.dictionary.getFavorites();return D.filters.dictionary.favorite.used||(r=r.filter(({favorite:e})=>!e)),r}).flat())],n=D.dictionary.getSorted(t);k.dictionary.listElement.innerHTML="",n.map((e,t)=>{let n=document.createElement("li");return n.appendChild(oq(e,t+1)),n}).forEach(e=>k.dictionary.listElement.appendChild(e)),k.wordsCountEl.innerHTML=n.length}function oG(e){return async function(...t){try{return await e(...t)}catch(e){console.error(e)}}}const oK=(e,t,n)=>`
You are a language teacher of ${n}. You have to give examples of the word "${e}" as ${t} in different natural contexts.
Give me 5 sentences using the word "${e}" in different contexts. Tell them without greeting and formatting. An html list ul. Just straight like this:
<ul class="app-list ai-list">
    <li>1. First example</li>
    <li>2. Second example</li>
    <li>3. Third example</li>
</ul>
`,oQ=(e,t)=>`
You are a language teacher of ${t}. You have to review the essay and give me feedback in ${t}.
The essay is: "${e}".Tell them without greeting and formatting. 
Just straight like this but write there everything in ${t}: 
<p>Rate: from 0 to 10</p>
<p>Level of ${t}: from A1 to C2</p>
<p>Review: your review about text</p>
<p>Mistakes: write about my mistakes if such exist</p>
<p>What to improve: what should i improve not to make such mistakes next time.</p>
`,oX=function(e,t){let n=(function(e,t){let n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)})("object"==typeof e?e:function(e=ek){let t=eL.get(e);if(!t&&e===ek&&W())return eB();if(!t)throw eF.create("no-app",{appName:e});return t}(),"firestore").getImmediate({identifier:"string"==typeof e?e:nW});if(!n._initialized){let e=z("firestore");e&&function(e,t,n,r={}){var i;e=nh(e,os);let s=G(t),a=e._getSettings(),o=Object.assign(Object.assign({},a),{emulatorOptions:e._getEmulatorOptions()}),l=`${t}:${n}`;s&&(K(`https://${l}`),function(e,t){if("undefined"==typeof window||"undefined"==typeof document||!G(window.location.host)||Q[e]===t||Q[e]||X)return;function n(e){return`__firebase__banner__${e}`}Q[e]=t;let r="__firebase__banner",i=function(){let e={prod:[],emulator:[]};for(let t of Object.keys(Q))Q[t]?e.emulator.push(t):e.prod.push(t);return e}().prod.length>0;function s(){let e,t,s=(e=document.getElementById(r),t=!1,e||((e=document.createElement("div")).setAttribute("id",r),t=!0),{created:t,element:e}),a=n("text"),o=document.getElementById(a)||document.createElement("span"),l=n("learnmore"),u=document.getElementById(l)||document.createElement("a"),h=n("preprendIcon"),c=document.getElementById(h)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(s.created){let e=s.element;e.style.display="flex",e.style.background="#7faaf0",e.style.position="fixed",e.style.bottom="5px",e.style.left="5px",e.style.padding=".5em",e.style.borderRadius="5px",e.style.alignItems="center",u.setAttribute("id",l),u.innerText="Learn more",u.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",u.setAttribute("target","__blank"),u.style.paddingLeft="5px",u.style.textDecoration="underline";let t=function(){let e=document.createElement("span");return e.style.cursor="pointer",e.style.marginLeft="16px",e.style.fontSize="24px",e.innerHTML=" &times;",e.onclick=()=>{X=!0;let e=document.getElementById(r);e&&e.remove()},e}();c.setAttribute("width","24"),c.setAttribute("id",h),c.setAttribute("height","24"),c.setAttribute("viewBox","0 0 24 24"),c.setAttribute("fill","none"),c.style.marginLeft="-6px",e.append(c,o,u,t),document.body.appendChild(e)}i?(o.innerText="Preview backend disconnected.",c.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(c.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,o.innerText="Preview backend running in this workspace."),o.setAttribute("id",a)}"loading"===document.readyState?window.addEventListener("DOMContentLoaded",s):s()}("Firestore",!0)),a.host!==or&&a.host!==l&&tj("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");let u=Object.assign(Object.assign({},a),{host:l,ssl:s,emulatorOptions:r});if(!ee(u,o)&&(e._setSettings(u),r.mockUserToken)){let t,n;if("string"==typeof r.mockUserToken)t=r.mockUserToken,n=tM.MOCK_USER;else{t=function(e,t){if(e.uid)throw Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');let n=t||"demo-project",r=e.iat||0,i=e.sub||e.user_id;if(!i)throw Error("mockUserToken must contain 'sub' or 'user_id' field!");let s=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:r,exp:r+3600,auth_time:r,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},e);return[F(JSON.stringify({alg:"none",type:"JWT"})),F(JSON.stringify(s)),""].join(".")}(r.mockUserToken,null==(i=e._app)?void 0:i.options.projectId);let s=r.mockUserToken.sub||r.mockUserToken.user_id;if(!s)throw new tG(tH.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new tM(s)}e._authCredentials=new tY(new tQ(t,n))}}(n,...e)}return n}(eB({apiKey:"AIzaSyA5aDGFwVaziMI2WOVx_SuJr2yg7ojnKCk",authDomain:"language-d157c.firebaseapp.com",projectId:"language-d157c",storageBucket:"language-d157c.firebasestorage.app",messagingSenderId:"135792918299",appId:"1:135792918299:web:3c70fe51b0a79645c05dbe"})),oY=oG(async function(e){let t=await function(e){e=nh(e,oa);let t=nh(e.firestore,of),n=op(t),r=new oV(t);return function(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new tG(tH.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}(e._query),(function(e,t,n={}){let r=new tK;return e.asyncQueue.enqueueAndForget(async()=>(function(e,t,n,r,i){let s=new a6({next:n=>{s.Ou(),t.enqueueAndForget(()=>ab(e,a)),n.fromCache&&"server"===r.source?i.reject(new tG(tH.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:e=>i.reject(e)}),a=new aI(n,s,{includeMetadataChanges:!0,ka:!0});return aw(e,a)})(await oe(e),e.asyncQueue,t,n,r)),r.promise})(n,e._query).then(n=>new oF(t,r,e,n))}(function(e,t,...n){if(e=en(e),ns("collection","path",t),e instanceof os){let r=nt.fromString(t,...n);return no(r),new ol(e,null,r)}{if(!(e instanceof oo||e instanceof ol))throw new tG(tH.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=e._path.child(nt.fromString(t,...n));return no(r),new ol(e.firestore,null,r)}}(oX,e)),n=[];return t.forEach(e=>n.push({id:e.id,...e.data()})),n}),oJ=oG(function(e,t){oB(ou(oX,e,t.id),t)}),oZ=oG(async function(e,t){await oU(ou(oX,e,t))}),o0=oG(async function(e){(await oY(e)).forEach(async t=>{await oU(ou(oX,e,t.id))})}),o1=oG(async function(e,t,n){let r=ou(oX,e,t);return await oB(r,n),n});async function o2(e,t){let n=await oY(t);D.storage=new C(e),D.dictionary=new A(n),D.lang=t,D.wordExtraInfoModal=new x(".word-extra-info-modal",".close-button"),D.deleteAllWordsWarningModal=new x(".delete-all-words-warning-modal",".close-button"),D.addNewWordModal=new x(".add-word-modal",".close-button"),D.langs={en:"English",pl:"Polish"},D.filters={dictionary:{},trainWords:{}},D.dictionary.setFavorites(!0,...D.storage.getItem()||[]),D.dictionary.types.forEach((e,t)=>{for(let n in D.filters)D.filters[n][e]={used:!1,expression:D.dictionary.types_expression[t]}})}oG(async function(e,t){let n=ou(oX,e,t),r=await function(e){e=nh(e,oo);let t=nh(e.firestore,of);return(function(e,t,n={}){let r=new tK;return e.asyncQueue.enqueueAndForget(async()=>(function(e,t,n,r,i){let s=new a6({next:o=>{s.Ou(),t.enqueueAndForget(()=>ab(e,a));let l=o.docs.has(n);!l&&o.fromCache?i.reject(new tG(tH.UNAVAILABLE,"Failed to get document because the client is offline.")):l&&o.fromCache&&r&&"server"===r.source?i.reject(new tG(tH.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(o)},error:e=>i.reject(e)}),a=new aI(new rA(n.path),s,{includeMetadataChanges:!0,ka:!0});return aw(e,a)})(await oe(e),e.asyncQueue,t,n,r)),r.promise})(op(t),e._key).then(n=>(function(e,t,n){let r=n.docs.get(t._key),i=new oV(e);return new oM(e,i,t._key,r,new oO(n.hasPendingWrites,n.fromCache),t.converter)})(t,e,n))}(n);return r.exists()?r.data():null}),oG(async function(e){return(await oY(e)).filter(e=>!0===e.favorite)});let o6=[];async function o3(e){k.trainWords.randomWordElement.innerHTML="",k.trainWords.randomWordElement.appendChild(await oq(e))}function o5(){let e=D.dictionary.getWordsByTypes(D.dictionary.d,...Object.keys(D.filters.trainWords).map(e=>D.filters.trainWords[e]&&`${e}`));o6=0!==e.length?e:D.dictionary.getFavorites(),D.filters.dictionary.favorite||(o6=o6.filter(({favorite:e})=>!e)),n=0,o6.length>0?(o6.sort(()=>.5-Math.random()),i=o6[n].translation.toLowerCase(),k.trainWords.wordsElement.innerHTML=o6.length,k.trainWords.currentIndexElement.innerHTML=n+1,o3(o6[n])):(k.trainWords.wordsElement.innerHTML=0,k.trainWords.currentIndexElement.innerHTML=0,k.trainWords.randomWordElement.innerHTML="No words found")}function o4(){k.dictionary.filters.innerHTML="",k.trainWords.filtersElement.innerHTML="",k.dictionary.filters.appendChild(oW(D.filters.dictionary,()=>oH(k.dictionary.searchInput.value))),k.trainWords.filtersElement.appendChild(oW(D.filters.trainWords,()=>o5())),oH();let e=document.querySelector(".train-word-form"),t=document.querySelector(".train-word-input");o5(),t.addEventListener("input",o$(()=>{r=t.value.trim().toLowerCase(),i===r?t.style.border="2px solid green":t.style.border="2px solid red"},50)),e.addEventListener("submit",e=>{e.preventDefault(),r===i&&(o3((n=(n+1)%o6.length,k.trainWords.currentIndexElement.innerHTML=n+1,o6[n])),t.style.border="2px solid",t.value="",i=o6[n].translation.toLowerCase())})}async function o8(){let e=k.wordExtraInfoModal.addFavoriteWordButton.dataset.wordId;D.dictionary.getById(e).favorite?(D.dictionary.setFavoriteById(e,!1),D.storage.setItem(D.storage.getItem().filter(({fId:t})=>e===t)),await o1(D.lang,e,{...D.dictionary.getById(e),favorite:!1}),k.wordExtraInfoModal.addFavoriteWordButton.innerHTML="Add to Favorite"):(D.dictionary.setFavoriteById(e,!0),D.storage.setItem([...D.storage.getItem()||[],e]),await o1(D.lang,e,{...D.dictionary.getById(e),favorite:!0}),k.wordExtraInfoModal.addFavoriteWordButton.innerHTML="Remove from Favorite"),oH()}function o7(e){oH(e.target.value)}function o9(e){e.preventDefault();let t=oQ(k.writingTraining.textForm.train_writing_text_textarea.value,D.langs[D.lang]);k.writingTraining.textAiReview.innerHTML="Loading...",k.writingTraining.textForm.submit.disabled=!0,li(t).then(e=>{k.writingTraining.textAiReview.innerHTML=e.message.content,k.writingTraining.textForm.submit.disabled=!1})}function le(){k.writingTraining.textTotalWords.innerText=k.writingTraining.textTextArea.value.trim().split(" ").length}function lt(){if(this.checked){let e=this.dataset.lang;D.prefLanguage.setItem(e),o2(`favorite${e[0].toUpperCase()+e.split("").splice(1).join("")}Words`,e).then(o4)}}function ln(e){let t=D.dictionary.getById(e.id).favorite;k.wordExtraInfoModal.aiTextGenerationButton.dataset.id=e.id,k.wordExtraInfoModal.addFavoriteWordButton.dataset.wordId=e.id,k.deleteWordButton.dataset.wordId=e.id,k.wordExtraInfoModal.addFavoriteWordButton.innerText=t?"Remove from Favorite":"Add to Favorite",k.wordExtraInfoModal.word.innerText=e.expression,k.wordExtraInfoModal.type.innerText=e.type,k.wordExtraInfoModal.type.classList.add(e.type),k.wordExtraInfoModal.wordId.innerText=e.id,k.wordExtraInfoModal.translation.innerText=e.translation,k.wordExtraInfoModal.description.innerText=e.description,k.wordExtraInfoModal.aiGeneratedText.innerHTML=""}function lr(e){if(e.target.closest(".word-button")){let t=e.target.closest(".word-button").dataset.id,n=D.dictionary.getById(t);D.wordExtraInfoModal.showModalWindow(ln.bind(null,n))}else if(e.target.closest(".link-button")){let t=e.target.closest(".link-button");k.allLinkButtons.forEach(e=>e.classList.remove("active")),t.classList.add("active")}}function li(e){return puter.ai.chat(e)}async function ls(){k.trainWords={wordsElement:document.querySelector(".train-word-allWords"),currentIndexElement:document.querySelector(".train-word-currentIndex"),randomWordElement:document.querySelector(".train-word-random-word"),filtersElement:document.querySelector(".train-words-filters")},k.writingTraining={textForm:document.querySelector(".train-writing-text-form"),textAiReview:document.querySelector(".train-writing-text-ai-review"),textTotalWords:document.querySelector(".train-writing-text-total-words"),textTextArea:document.querySelector(".train-writing-text-textarea")},k.wordExtraInfoModal={addFavoriteWordButton:document.querySelector(".word-extra-info-modal .add-word-favorite"),word:document.querySelector(".word-extra-info-modal .word"),type:document.querySelector(".word-extra-info-modal .type"),wordId:document.querySelector(".word-extra-info-modal .word-id"),translation:document.querySelector(".word-extra-info-modal .translation"),description:document.querySelector(".word-extra-info-modal .description"),aiGeneratedText:document.querySelector(".word-extra-info-modal .ai-generated-text"),aiTextGenerationButton:document.querySelector(".word-extra-info-modal .ai-text-generation-button")},k.dictionary={listElement:document.querySelector(".dictionary-list"),filters:document.querySelector(".dictionary-filters"),searchInput:document.querySelector(".dictionary-input")},k.wordsCountEl=document.querySelector(".words-count"),k.langSwitchers=document.querySelectorAll(".lang-radio-switcher"),k.allLinkButtons=document.querySelectorAll(".link-button"),k.deleteAllWordsModalOpenButton=document.querySelector(".delete-all-words-modal-open-button"),k.deleteAllWordsButton=document.querySelector(".delete-all-words-button"),k.addWordModalButton=document.querySelector(".add-word-modal-open-button"),k.deleteWordButton=document.querySelector(".delete-word-button"),k.formAddNewWord=document.querySelector(".form-add-new-word"),D.prefLanguage=new C("pref-lang");let e=D.prefLanguage.getItem("pl");k.langSwitchers.forEach(t=>{t.dataset.lang===e&&(t.checked=!0)}),await o2(`favorite${e[0].toUpperCase()+e.split("").splice(1).join("")}Words`,e),k.wordExtraInfoModal.addFavoriteWordButton.addEventListener("click",o8),k.dictionary.searchInput.addEventListener("input",o$(o7,100)),k.writingTraining.textForm.addEventListener("submit",o9),window.addEventListener("click",lr),k.langSwitchers.forEach(e=>e.addEventListener("change",lt)),k.writingTraining.textTextArea.addEventListener("input",le),k.wordExtraInfoModal.aiTextGenerationButton.addEventListener("click",({currentTarget:e})=>{let{expression:t,type:n}=D.dictionary.getById(e.dataset.id),r=oK(t,n,D.langs[D.lang]);k.wordExtraInfoModal.aiGeneratedText.innerHTML="Loading...",k.wordExtraInfoModal.aiTextGenerationButton.disabled=!0,li(r).then(e=>{k.wordExtraInfoModal.aiGeneratedText.innerHTML=e.message.content,k.wordExtraInfoModal.aiTextGenerationButton.disabled=!1})}),k.deleteAllWordsModalOpenButton.addEventListener("click",D.deleteAllWordsWarningModal.showModalWindow.bind(D.deleteAllWordsWarningModal,null)),k.addWordModalButton.addEventListener("click",D.addNewWordModal.showModalWindow.bind(D.addNewWordModal,null)),k.formAddNewWord.addEventListener("submit",async e=>{e.preventDefault();let{expressionInput:t,typeInput:n,typeExpressionInput:r,descriptionInput:i,translationInput:s,favoriteInput:a}=k.formAddNewWord,o=String(D.dictionary.d.length),l=t.value.trim(),u=n.value.trim(),h=r.value.trim(),c=i.value.trim(),d=s.value.trim(),f=a.checked,p=D.lang;await oJ(p,{id:o,expression:l,type:u,typeExpression:h,description:c,translation:d,favorite:f}),t.value="",n.value="",r.value="",i.value="",s.value="",a.checked=!1,D.addNewWordModal.hideModalWindow(),D.wordExtraInfoModal.hideModalWindow(),o2(`favorite${p[0].toUpperCase()+p.split("").splice(1).join("")}Words`,p).then(o4)}),k.deleteWordButton.addEventListener("click",async()=>{let e=k.deleteWordButton.dataset.wordId,t=D.lang;await oZ(t,e),D.wordExtraInfoModal.hideModalWindow(),o2(`favorite${t[0].toUpperCase()+t.split("").splice(1).join("")}Words`,t).then(o4)}),k.deleteAllWordsButton.addEventListener("click",async()=>{let e=D.lang;await o0(e),D.deleteAllWordsWarningModal.hideModalWindow(),console.log(`All Words were deleted from ${D.lang} dictionary`),o2(`favorite${e[0].toUpperCase()+e.split("").splice(1).join("")}Words`,e).then(o4)})}window.addEventListener("load",function(){ls().then(o4)});
//# sourceMappingURL=language-app.464b5522.js.map
